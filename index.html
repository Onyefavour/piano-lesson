<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PianoNaija üéπ - Learn Piano the Fun Way!</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800;900&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>
:root {
  --c1:#FF4757; --c2:#FFA502; --c3:#2ED573; --c4:#1E90FF;
  --c5:#A855F7; --c6:#FF6B81; --gold:#FFD700;
  --bg:#0D0B1E; --panel:#161330; --panel2:#1F1B3A;
  --text:#FFFFFF; --text2:rgba(255,255,255,0.6); --text3:rgba(255,255,255,0.35);
  --border:rgba(255,255,255,0.07); --chip-bg:var(--panel);
  --bubble-bg:#ffffff; --bubble-text:#1a1a2e;
  --key-label:#555; --orb-op:0.15;
  --sheet-bg:#12102a;
}
html.light {
  --bg:#F0EEF8; --panel:#FFFFFF; --panel2:#EAE8F5;
  --text:#1a1240; --text2:rgba(26,18,64,0.65); --text3:rgba(26,18,64,0.38);
  --border:rgba(26,18,64,0.09); --chip-bg:#FFFFFF;
  --bubble-bg:#1a1240; --bubble-text:#FFFFFF;
  --key-label:#666; --orb-op:0.07;
  --sheet-bg:#E0DCF5;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  font-family: 'Quicksand', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.4s, color 0.4s;
}

/* THEME TOGGLE */
.theme-toggle {
  position:fixed; top:14px; right:14px; z-index:500;
  width:46px; height:46px; border-radius:50%;
  border:2px solid var(--border); background:var(--panel);
  box-shadow:0 4px 16px rgba(0,0,0,0.2);
  cursor:pointer; font-size:1.3rem;
  display:flex; align-items:center; justify-content:center;
  transition:all 0.3s; user-select:none;
}
.theme-toggle:hover { transform:scale(1.1) rotate(20deg); }

/* ‚îÄ‚îÄ ANIMATED BG ‚îÄ‚îÄ */
.bg-orbs {
  position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden;
}
.orb {
  position: absolute; border-radius: 50%; filter: blur(80px); opacity: var(--orb-op);
  animation: orbDrift 8s ease-in-out infinite alternate;
}
.orb1 { width:400px;height:400px; background:#FF4757; top:-100px;left:-100px; animation-duration:9s; }
.orb2 { width:350px;height:350px; background:#A855F7; bottom:-80px;right:-80px; animation-duration:11s; }
.orb3 { width:300px;height:300px; background:#2ED573; top:40%;left:40%; animation-duration:7s; }
.orb4 { width:250px;height:250px; background:#1E90FF; top:20%;right:10%; animation-duration:13s; }
@keyframes orbDrift {
  from { transform: translate(0,0) scale(1); }
  to   { transform: translate(40px, 30px) scale(1.1); }
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  position: relative; z-index: 10; text-align: center;
  padding: 24px 20px 0;
}
.logo {
  font-family: 'Baloo 2', cursive;
  font-size: clamp(2.8rem, 9vw, 5.5rem);
  font-weight: 900;
  background: linear-gradient(135deg, #FF4757, #FFA502, #FFD700, #2ED573, #1E90FF);
  background-size: 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: logoShimmer 4s linear infinite, logoFloat 3s ease-in-out infinite;
  letter-spacing: -1px;
  line-height: 1;
}
@keyframes logoShimmer { to { background-position: 300% center; } }
@keyframes logoFloat {
  0%,100% { transform: translateY(0) rotate(-0.5deg); }
  50%      { transform: translateY(-8px) rotate(0.5deg); }
}
.logo-sub {
  font-family: 'Baloo 2', cursive;
  font-size: clamp(0.85rem, 2.5vw, 1.1rem);
  color: var(--text2);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-top: 2px;
}

/* ‚îÄ‚îÄ MASCOT ‚îÄ‚îÄ */
.mascot-row {
  position: relative; z-index: 10;
  display: flex; justify-content: center; align-items: center;
  padding: 16px 20px 8px; gap: 16px;
}
.mascot-wrap {
  position: relative; cursor: pointer;
}
.mascot-body {
  font-size: 5.5rem;
  display: block;
  animation: mascotWiggle 2s ease-in-out infinite;
  filter: drop-shadow(0 8px 30px rgba(255,215,0,0.5));
  transition: transform 0.2s;
  user-select: none;
}
.mascot-body:hover { transform: scale(1.15); }
@keyframes mascotWiggle {
  0%,100% { transform: rotate(-5deg) translateY(0); }
  25%      { transform: rotate(5deg) translateY(-12px); }
  75%      { transform: rotate(-3deg) translateY(-6px); }
}
.bubble {
  background: var(--bubble-bg);
  color: var(--bubble-text);
  border-radius: 18px 18px 18px 4px;
  padding: 12px 16px;
  font-size: 0.9rem;
  font-weight: 700;
  max-width: 220px;
  line-height: 1.5;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  position: relative;
  animation: bubbleIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
}
.bubble::before {
  content:''; position:absolute; left:-10px; bottom:16px;
  border:6px solid transparent; border-right-color:white;
}
@keyframes bubbleIn {
  from { transform: scale(0.5) translateX(-20px); opacity: 0; }
  to   { transform: scale(1) translateX(0); opacity: 1; }
}

/* ‚îÄ‚îÄ SCORE BAR ‚îÄ‚îÄ */
.score-bar {
  position: relative; z-index: 10;
  display: flex; justify-content: center; gap: 20px;
  padding: 6px 20px 10px;
  flex-wrap: wrap;
}
.score-chip {
  background: var(--chip-bg);
  color: var(--text2);
  border-radius: 40px;
  padding: 8px 20px;
  font-family: 'Baloo 2', cursive;
  font-size: 1rem;
  border: 2px solid rgba(255,215,0,0.2);
  display: flex; align-items: center; gap: 8px;
}
.score-chip .val { color: var(--gold); font-size: 1.2rem; }

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs {
  position: relative; z-index: 10;
  display: flex; justify-content: center;
  gap: 8px; padding: 8px 20px 16px;
  flex-wrap: wrap;
}
.tab {
  font-family: 'Baloo 2', cursive;
  font-size: 0.95rem;
  padding: 10px 20px;
  border-radius: 50px;
  border: 3px solid transparent;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.175,0.885,0.32,1.275);
  background: var(--panel2);
  color: var(--text2);
  font-weight: 700;
}
.tab:hover, .tab.on {
  transform: translateY(-4px) scale(1.05);
  color: white;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}
.tab.on.t0 { background: linear-gradient(135deg,#FF4757,#FF6B81); border-color:#FF4757; }
.tab.on.t1 { background: linear-gradient(135deg,#FFA502,#FFD700); border-color:#FFA502; color:#1a1a00; }
.tab.on.t2 { background: linear-gradient(135deg,#2ED573,#00C853); border-color:#2ED573; color:#001a00; }
.tab.on.t3 { background: linear-gradient(135deg,#1E90FF,#A855F7); border-color:#1E90FF; }

/* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
.sect { display: none; position: relative; z-index: 10; padding: 10px 16px 40px; }
.sect.on { display: block; }

/* ‚îÄ‚îÄ PIANO ‚îÄ‚îÄ */
.piano-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 16px;
}

/* Song picker */
.song-picker {
  display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
  max-width: 700px;
}
.sp-btn {
  font-family: 'Baloo 2', cursive;
  padding: 9px 18px; border-radius: 40px;
  border: 2px solid var(--border);
  background: var(--panel2);
  color: var(--text2);
  cursor: pointer; font-size: 0.88rem;
  transition: all 0.3s;
}
.sp-btn:hover, .sp-btn.on {
  border-color: var(--gold);
  color: var(--text);
  background: linear-gradient(135deg, rgba(255,165,0,0.25), rgba(255,69,87,0.25));
  transform: translateY(-2px) scale(1.04);
}

/* 3D Piano stage */
.piano-stage {
  perspective: 1000px;
  width: 100%;
  display: flex;
  justify-content: center;
}
.piano-3d {
  transform-style: preserve-3d;
  transform: rotateX(22deg) rotateY(0deg);
  transition: transform 0.3s;
  animation: pianoRock 6s ease-in-out infinite;
}
@keyframes pianoRock {
  0%,100% { transform: rotateX(22deg) rotateY(-1deg); }
  50%      { transform: rotateX(18deg) rotateY(1deg); }
}
.piano-case {
  background: linear-gradient(160deg, #3d1800 0%, #1a0900 40%, #0d0500 100%);
  border-radius: 18px 18px 6px 6px;
  padding: 18px 22px 32px;
  box-shadow:
    0 40px 80px rgba(0,0,0,0.9),
    0 0 0 4px #7a3000,
    0 0 0 6px #3d1800,
    inset 0 2px 6px rgba(255,180,60,0.25),
    inset 0 -4px 10px rgba(0,0,0,0.5);
  position: relative;
}
.piano-case::before {
  content:'';
  position:absolute; top:0;left:0;right:0;height:6px;
  background: linear-gradient(90deg, transparent, rgba(255,180,60,0.4), transparent);
  border-radius: 18px 18px 0 0;
}
.piano-brand {
  font-family: 'Baloo 2', cursive;
  font-size: 0.7rem;
  letter-spacing: 4px;
  color: rgba(255,180,60,0.4);
  text-align: center;
  margin-bottom: 10px;
  text-transform: uppercase;
}
.keys-row {
  display: flex;
  position: relative;
  height: 170px;
  gap: 4px;
}

/* White keys */
.wk {
  width: 56px;
  height: 160px;
  background: linear-gradient(180deg, #FEFEFE 0%, #EDE5D5 55%, #DDD0B8 100%);
  border-radius: 0 0 12px 12px;
  cursor: pointer;
  position: relative;
  border: 1px solid #C8BFAA;
  box-shadow:
    0 10px 0 #B0A090,
    0 12px 25px rgba(0,0,0,0.5),
    inset 0 1px 0 rgba(255,255,255,1),
    inset 0 -2px 4px rgba(0,0,0,0.1);
  transition: transform 0.08s, box-shadow 0.08s, background 0.08s;
  transform-origin: top center;
  transform-style: preserve-3d;
  display: flex; flex-direction: column;
  align-items: center; justify-content: flex-end;
  padding-bottom: 12px;
  user-select: none;
  -webkit-user-select: none;
}
.wk::after {
  content: '';
  position: absolute; bottom: 0; left: 0; right: 0;
  height: 40px;
  background: linear-gradient(180deg, transparent, rgba(0,0,0,0.04));
  border-radius: 0 0 12px 12px;
}
.wk .klabel {
  font-family: 'Baloo 2', cursive;
  font-size: 0.8rem;
  font-weight: 800;
  color: #555;
  pointer-events: none;
  position: relative; z-index: 1;
}
.wk .kemoji {
  font-size: 1.1rem;
  pointer-events: none;
  position: relative; z-index: 1;
  margin-bottom: 2px;
}
.wk:active, .wk.lit {
  transform: rotateX(6deg);
  box-shadow: 0 4px 0 #B0A090, 0 5px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.5);
}
/* Color flash per note */
.wk.lit.n0 { background: linear-gradient(180deg,#FF6B6B,#FF4757); }
.wk.lit.n1 { background: linear-gradient(180deg,#FFB347,#FFA502); }
.wk.lit.n2 { background: linear-gradient(180deg,#FFE040,#FFD700); }
.wk.lit.n3 { background: linear-gradient(180deg,#69F0AE,#2ED573); }
.wk.lit.n4 { background: linear-gradient(180deg,#4FC3F7,#1E90FF); }
.wk.lit.n5 { background: linear-gradient(180deg,#CE93D8,#A855F7); }
.wk.lit.n6 { background: linear-gradient(180deg,#FF80AB,#FF4FA3); }
.wk.lit.n7 { background: linear-gradient(180deg,#FF6B6B,#FF4757); }

/* Black keys */
.bk {
  width: 36px;
  height: 105px;
  background: linear-gradient(180deg, #333 0%, #111 50%, #000 100%);
  border-radius: 0 0 8px 8px;
  cursor: pointer;
  position: absolute;
  z-index: 3;
  box-shadow:
    0 8px 0 #000,
    0 10px 20px rgba(0,0,0,0.8),
    inset 0 1px 0 rgba(255,255,255,0.12),
    inset 1px 0 0 rgba(255,255,255,0.05);
  transition: transform 0.08s, box-shadow 0.08s, background 0.08s;
  transform-origin: top center;
  user-select: none;
  -webkit-user-select: none;
}
.bk:active, .bk.lit {
  transform: rotateX(6deg);
  box-shadow: 0 3px 0 #000, 0 4px 10px rgba(0,0,0,0.7);
  background: linear-gradient(180deg, #FF6B00 0%, #CC4400 100%);
}
/* Glow ring on press */
.key-glow {
  position: absolute; top:50%; left:50%;
  transform: translate(-50%, -50%) scale(0);
  width: 60px; height: 60px;
  border-radius: 50%;
  border: 4px solid rgba(255,215,0,0.8);
  animation: glowRing 0.6s ease-out forwards;
  pointer-events: none; z-index: 10;
}
@keyframes glowRing {
  0%   { transform: translate(-50%,-50%) scale(0); opacity: 1; }
  100% { transform: translate(-50%,-50%) scale(3); opacity: 0; }
}

/* ‚îÄ‚îÄ SHEET / SONG PLAYER ‚îÄ‚îÄ */
.sheet {
  width: 100%; max-width: 680px;
  background: var(--panel);
  border-radius: 20px;
  padding: 18px;
  border: 2px solid rgba(255,215,0,0.15);
}
.sheet-title {
  font-family: 'Baloo 2', cursive;
  font-size: 1.3rem;
  color: var(--gold);
  text-align: center;
  margin-bottom: 12px;
}
.lyric-line {
  font-size: 0.9rem;
  color: var(--text2);
  text-align: center;
  margin-bottom: 14px;
  font-style: italic;
  min-height: 1.4em;
}
.note-track {
  display: flex; flex-wrap: wrap;
  gap: 7px; justify-content: center;
  padding: 6px 0;
}
.nt {
  padding: 8px 14px;
  border-radius: 30px;
  font-family: 'Baloo 2', cursive;
  font-size: 1rem;
  font-weight: 800;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s;
  border: 3px solid transparent;
  user-select: none;
}
.nt:hover { transform: scale(1.12); }
.nt.cur  { animation: ntPop 0.35s cubic-bezier(0.175,0.885,0.32,1.275); border-color: #333; box-shadow: 0 0 20px rgba(0,0,0,0.25); }
.nt.done { opacity: 0.35; }
@keyframes ntPop {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.35) rotate(-3deg); }
  100% { transform: scale(1); }
}
/* Note colors */
.nC,.nC5 { background:#FF4757; color:#fff; }
.nD { background:#FFA502; color:#fff; }
.nE { background:#FFD700; color:#222; }
.nF { background:#2ED573; color:#fff; }
.nG { background:#1E90FF; color:#fff; }
.nA { background:#A855F7; color:#fff; }
.nB { background:#FF4FA3; color:#fff; }
.nCs,.nDs,.nFs,.nGs,.nAs { background:#888; color:#fff; }
.nR { background: var(--panel2); color: var(--text3); }

.play-btns {
  display: flex; gap: 10px; justify-content: center;
  margin-top: 14px; flex-wrap: wrap;
}
.pb {
  font-family: 'Baloo 2', cursive;
  padding: 11px 22px; border-radius: 50px;
  border: none; cursor: pointer; font-size: 0.95rem;
  font-weight: 800; transition: all 0.3s;
}
.pb:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
.pb.pplay { background: linear-gradient(135deg,#2ED573,#00C853); color:#001a00; }
.pb.pslow { background: linear-gradient(135deg,#A855F7,#7B2FBE); color:#fff; }
.pb.pstop { background: linear-gradient(135deg,#FF4757,#CC0022); color:#fff; }
.pb.preset { background: linear-gradient(135deg,#FFA502,#FF6B00); color:#fff; }

/* ‚îÄ‚îÄ ACTIVITIES ‚îÄ‚îÄ */
.act-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 14px; max-width: 900px; margin: 0 auto;
}
.act-card {
  background: var(--panel);
  border-radius: 20px; padding: 22px;
  border: 2px solid rgba(255,255,255,0.06);
  cursor: pointer; transition: all 0.3s;
  position: relative; overflow: hidden;
}
.act-card::before {
  content:''; position:absolute; top:0;left:0;right:0;height:4px;
  background: var(--ac, var(--gold));
}
.act-card:hover {
  transform: translateY(-6px) scale(1.02);
  border-color: rgba(255,215,0,0.3);
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}
.act-icon2 { font-size: 2.8rem; margin-bottom: 10px; display: block; }
.act-name { font-family: 'Baloo 2', cursive; font-size: 1.15rem; color: var(--gold); margin-bottom: 6px; }
.act-desc2 { font-size: 0.82rem; color: var(--text2); line-height: 1.6; }
.act-tag { font-family:'Baloo 2',cursive; font-size:0.75rem; color: var(--gold); margin-top: 10px; display:block; }

/* ‚îÄ‚îÄ ACTIVITY MODAL / GAME OVERLAY ‚îÄ‚îÄ */
.game-overlay {
  position: fixed; inset: 0;
  background: var(--bg);
  z-index: 200;
  display: none; flex-direction: column;
  align-items: center; justify-content: flex-start;
  padding: 20px;
  overflow-y: auto;
}
.game-overlay.on { display: flex; }
.game-close {
  position: absolute; top: 14px; right: 14px;
  font-size: 2rem; cursor: pointer;
  background: var(--panel2); border: none; color: white;
  width: 44px; height: 44px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  transition: transform 0.2s;
}
.game-close:hover { transform: scale(1.2) rotate(90deg); }
.game-title {
  font-family: 'Baloo 2', cursive;
  font-size: clamp(1.8rem, 6vw, 2.8rem);
  text-align: center;
  background: linear-gradient(135deg, var(--gold), #FF4757);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px; margin-top: 30px;
}
.game-instr {
  color: var(--text2); text-align:center;
  font-size: 1rem; margin-bottom: 20px;
  max-width: 500px; line-height: 1.6;
}

/* ‚îÄ‚îÄ FREEZE GAME ‚îÄ‚îÄ */
.freeze-arena {
  width: 100%; max-width: 500px;
  background: var(--panel); border-radius: 24px;
  padding: 24px; text-align: center;
}
.freeze-dancer {
  font-size: 8rem;
  display: block;
  animation: dance 0.4s ease-in-out infinite alternate;
  margin: 10px 0;
}
@keyframes dance {
  from { transform: rotate(-10deg) translateY(0); }
  to   { transform: rotate(10deg) translateY(-15px); }
}
.freeze-dancer.frozen {
  animation: none !important;
  transform: rotate(-15deg);
  filter: hue-rotate(200deg) brightness(0.7);
}
.freeze-status {
  font-family: 'Baloo 2', cursive;
  font-size: 2rem; color: var(--gold);
  margin: 10px 0;
}
.freeze-btn {
  font-family: 'Baloo 2', cursive;
  padding: 14px 36px; border-radius: 50px;
  border: none; cursor: pointer; font-size: 1.1rem;
  font-weight: 800; transition: all 0.3s;
  background: linear-gradient(135deg, #FF4757, #FF6B81);
  color: white; margin-top: 12px;
}
.freeze-btn:hover { transform: scale(1.05); }

/* ‚îÄ‚îÄ COLOUR MATCH ‚îÄ‚îÄ */
.cmatch-arena { width:100%; max-width:500px; text-align:center; }
.cmatch-prompt {
  font-family: 'Baloo 2', cursive;
  font-size: 1.2rem; color: var(--text); margin-bottom: 8px;
}
.cmatch-color-card {
  width: 140px; height: 140px; border-radius: 24px;
  margin: 0 auto 16px;
  display: flex; align-items: center; justify-content: center;
  font-size: 4rem;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  animation: cardPop 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes cardPop {
  from { transform: scale(0.5) rotate(-10deg); opacity: 0; }
  to   { transform: scale(1) rotate(0deg); opacity: 1; }
}
.cmatch-piano { perspective: 600px; display: flex; justify-content: center; }
.cmatch-piano-3d {
  transform: rotateX(15deg);
  background: #1a0900;
  border-radius: 12px;
  padding: 12px 14px 20px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 0 3px #7a3000;
}
.cmatch-keys { display: flex; gap: 3px; position: relative; height: 120px; }
.ck-w {
  width: 44px; height: 110px;
  border-radius: 0 0 8px 8px;
  cursor: pointer;
  border: 1px solid #C8BFAA;
  display: flex; align-items: flex-end; justify-content: center;
  padding-bottom: 8px;
  font-size: 0.85rem; font-family: 'Baloo 2', cursive; font-weight: 800; color: #555;
  box-shadow: 0 6px 0 #B0A090, 0 8px 15px rgba(0,0,0,0.4);
  transition: all 0.1s; transform-origin: top center;
  user-select: none;
}
.ck-w:active, .ck-w.correct { transform: rotateX(5deg); box-shadow: 0 2px 0 #B0A090; }
.cmatch-fb {
  font-family: 'Baloo 2', cursive;
  font-size: 2rem; min-height: 2.5rem;
  margin: 10px 0; animation: fbPop 0.4s ease;
}
@keyframes fbPop { from{transform:scale(2); opacity:0;} to{transform:scale(1); opacity:1;} }
.cmatch-score { font-family:'Baloo 2',cursive; font-size:1.1rem; color:var(--gold); }

/* ‚îÄ‚îÄ ECHO GAME ‚îÄ‚îÄ */
.echo-arena { width:100%; max-width:560px; text-align:center; }

/* Mode selector pills */
.echo-mode-row {
  display: flex; gap: 8px; justify-content: center; margin-bottom: 16px; flex-wrap: wrap;
}
.echo-mode-btn {
  font-family: 'Baloo 2', cursive; font-size: 0.9rem; font-weight: 800;
  padding: 9px 20px; border-radius: 40px; border: 3px solid transparent;
  cursor: pointer; transition: all 0.3s; background: var(--panel2); color: rgba(255,255,255,0.5);
}
.echo-mode-btn:hover { color: white; transform: translateY(-2px); }
.echo-mode-btn.sel-easy   { background: linear-gradient(135deg,#2ED573,#00C853); border-color:#2ED573; color:#001; }
.echo-mode-btn.sel-medium { background: linear-gradient(135deg,#FFA502,#FFD700); border-color:#FFA502; color:#1a0; }
.echo-mode-btn.sel-hard   { background: linear-gradient(135deg,#FF4757,#A855F7); border-color:#FF4757; color:#fff; }

/* Mode badge shown during play */
.echo-mode-badge {
  display: inline-block;
  font-family: 'Baloo 2', cursive; font-size: 0.8rem; font-weight: 800;
  padding: 4px 14px; border-radius: 20px; margin-bottom: 8px; letter-spacing: 1px;
}
.badge-easy   { background: rgba(46,213,115,0.2); color: #2ED573; border: 1px solid #2ED573; }
.badge-medium { background: rgba(255,165,2,0.2);  color: #FFA502; border: 1px solid #FFA502; }
.badge-hard   { background: rgba(255,71,87,0.2);  color: #FF4757; border: 1px solid #FF4757; }

.echo-sequence {
  display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;
  margin: 10px 0; min-height: 58px; align-items: center;
}
.echo-note-dot {
  width: 52px; height: 52px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Baloo 2', cursive; font-size: 1.1rem; font-weight: 800;
  box-shadow: 0 4px 15px rgba(0,0,0,0.4); transition: transform 0.2s;
}
.echo-note-dot.flash { animation: dotFlash 0.4s ease; }
@keyframes dotFlash { 0%,100%{transform:scale(1);} 50%{transform:scale(1.5) rotate(10deg);} }

/* Easy: coloured button pads */
.echo-keys { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 12px; }
.ek {
  width: 62px; height: 62px; border-radius: 16px;
  border: none; cursor: pointer; font-family: 'Baloo 2', cursive;
  font-size: 1rem; font-weight: 800; transition: all 0.15s;
  box-shadow: 0 6px 0 rgba(0,0,0,0.35);
}
.ek:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }

/* Medium: same pads but label hidden ‚Äî show only colour dot */
.ek-med {
  width: 62px; height: 62px; border-radius: 50%;
  border: none; cursor: pointer; transition: all 0.15s;
  box-shadow: 0 6px 0 rgba(0,0,0,0.35);
}
.ek-med:active { transform: translateY(4px) scale(0.92); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }

/* Hard: full piano, no labels */
.echo-hard-stage { perspective: 700px; display: flex; justify-content: center; margin-top: 14px; }
.echo-hard-case {
  transform: rotateX(18deg);
  background: linear-gradient(160deg,#3d1800,#0d0500);
  border-radius: 14px 14px 4px 4px;
  padding: 14px 16px 24px;
  box-shadow: 0 30px 60px rgba(0,0,0,0.9), 0 0 0 4px #7a3000, inset 0 2px 4px rgba(255,180,60,0.2);
}
.echo-hard-keys { display: flex; gap: 4px; position: relative; height: 150px; }
/* White key ‚Äî NO label, NO emoji */
.hk-w {
  width: 50px; height: 140px;
  background: linear-gradient(180deg, #FEFEFE 0%, #EDE5D5 55%, #DDD0B8 100%);
  border-radius: 0 0 10px 10px;
  cursor: pointer; border: 1px solid #C8BFAA;
  box-shadow: 0 8px 0 #B0A090, 0 10px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,1);
  transition: all 0.08s; transform-origin: top center; transform-style: preserve-3d;
  user-select: none; -webkit-user-select: none;
}
.hk-w:active, .hk-w.hlit {
  transform: rotateX(6deg);
  box-shadow: 0 3px 0 #B0A090, 0 4px 10px rgba(0,0,0,0.4);
  background: linear-gradient(180deg,#FFD700,#FFC000);
}
/* Black key ‚Äî NO label */
.hk-b {
  width: 32px; height: 92px;
  background: linear-gradient(180deg,#333,#000);
  border-radius: 0 0 7px 7px; cursor: pointer;
  position: absolute; z-index: 3;
  box-shadow: 0 7px 0 #000, 0 9px 18px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.12);
  transition: all 0.08s; transform-origin: top center;
  user-select: none; -webkit-user-select: none;
}
.hk-b:active, .hk-b.hlit {
  transform: rotateX(6deg);
  box-shadow: 0 3px 0 #000, 0 4px 8px rgba(0,0,0,0.7);
  background: linear-gradient(180deg,#FF6B00,#CC4400);
}

.echo-status {
  font-family:'Baloo 2',cursive; font-size:1.15rem;
  color:var(--gold); margin:10px 0; min-height:1.5rem;
}
.echo-start {
  font-family:'Baloo 2',cursive; padding:12px 28px; border-radius:50px;
  border:none; cursor:pointer; font-size:1rem; font-weight:800;
  background: linear-gradient(135deg,#1E90FF,#A855F7); color:white;
  transition: all 0.3s; margin-top:10px;
}
.echo-start:hover { transform:scale(1.06); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
.echo-replay {
  font-family:'Baloo 2',cursive; padding:8px 20px; border-radius:40px;
  border: 2px solid rgba(255,255,255,0.2); background: transparent; color:rgba(255,255,255,0.6);
  cursor:pointer; font-size:0.85rem; margin-top:6px; transition: all 0.2s;
}
.echo-replay:hover { border-color:var(--gold); color:var(--gold); }

/* ‚îÄ‚îÄ HIGH LOW ‚îÄ‚îÄ */
.highlow-arena { width:100%; max-width:500px; text-align:center; }
.hl-note-vis {
  font-size: 5rem; margin: 10px 0;
  display: block;
  animation: hlFloat 1s ease-in-out infinite alternate;
}
@keyframes hlFloat { from{transform:translateY(-20px);} to{transform:translateY(20px);} }
.hl-btns { display:flex; gap:16px; justify-content:center; margin:16px 0; flex-wrap:wrap; }
.hl-btn {
  font-family:'Baloo 2',cursive; padding:16px 36px; border-radius:50px;
  border:none; cursor:pointer; font-size:1.1rem; font-weight:800;
  transition: all 0.2s;
}
.hl-btn:hover { transform:scale(1.08); }
.hl-high { background:linear-gradient(135deg,#FF4757,#FF6B81); color:white; }
.hl-low  { background:linear-gradient(135deg,#1E90FF,#A855F7); color:white; }
.hl-feedback {
  font-family:'Baloo 2',cursive; font-size:2.5rem;
  min-height:3rem; margin:8px 0;
  animation: fbPop 0.4s ease;
}
.hl-score { font-family:'Baloo 2',cursive; font-size:1rem; color:var(--gold); }
.hl-piano-mini { perspective:400px; display:flex; justify-content:center; margin:10px 0; }

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge-shelf {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(130px,1fr));
  gap: 12px; max-width: 700px; margin: 0 auto 30px;
}
.badge-item {
  background: var(--panel); border-radius: 18px;
  padding: 18px 12px; text-align: center;
  border: 2px solid rgba(255,255,255,0.05);
  transition: all 0.3s;
}
.badge-item.earned {
  border-color: var(--gold);
  box-shadow: 0 0 20px rgba(255,215,0,0.2);
}
.badge-item.locked { opacity: 0.4; filter: grayscale(0.8); }
.badge-item:hover { transform: scale(1.06); }
.bi-icon { font-size: 2.8rem; display:block; margin-bottom:8px; }
.bi-name { font-family:'Baloo 2',cursive; font-size:0.8rem; color:white; }
.prog-wrap {
  max-width: 400px; margin: 0 auto 20px;
  background: rgba(255,255,255,0.08); border-radius:20px; height:18px; overflow:hidden;
}
.prog-fill {
  height:100%; border-radius:20px;
  background: linear-gradient(90deg, #2ED573, #FFD700, #FF4757);
  transition: width 1.2s cubic-bezier(0.23,1,0.32,1);
}

/* ‚îÄ‚îÄ FLOATING NOTES ‚îÄ‚îÄ */
.fnote {
  position: fixed; pointer-events:none;
  font-size: 2rem; z-index:1000;
  animation: fnUp 1.6s ease-out forwards;
}
@keyframes fnUp {
  from { opacity:1; transform:translateY(0) rotate(0) scale(1); }
  to   { opacity:0; transform:translateY(-220px) rotate(25deg) scale(1.6); }
}

/* ‚îÄ‚îÄ BANNER ‚îÄ‚îÄ */
.top-banner {
  position:fixed; top:16px; left:50%;
  transform: translateX(-50%) translateY(-120px);
  background: linear-gradient(135deg,#FFD700,#FF4757);
  color:#1a0000; font-family:'Baloo 2',cursive; font-size:1.2rem;
  padding:14px 28px; border-radius:20px;
  box-shadow:0 12px 40px rgba(0,0,0,0.5);
  transition: transform 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
  z-index:500; white-space:nowrap;
}
.top-banner.show { transform:translateX(-50%) translateY(0); }

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.conf {
  position:fixed; pointer-events:none; z-index:9999;
  animation: confFall 2.5s linear forwards;
  border-radius: 3px;
}
@keyframes confFall {
  from{transform:translateY(-20px) rotate(0); opacity:1;}
  to  {transform:translateY(110vh) rotate(900deg); opacity:0;}
}

/* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
.sec-title {
  font-family:'Baloo 2',cursive;
  font-size:clamp(1.6rem,5vw,2.4rem);
  text-align:center; margin-bottom:18px;
  background:linear-gradient(135deg,var(--gold),#FF4757);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:600px){
  .wk { width:40px; height:140px; }
  .bk { width:26px; height:88px; }
  .wk .klabel { font-size:0.7rem; }
  .wk .kemoji { font-size:0.85rem; }
  .piano-case { padding:12px 14px 24px; }
}
@media(max-width:420px){
  .wk { width:34px; }
  .bk { width:22px; }
}

.hint-bar {
  font-size:0.8rem; color:var(--text3);
  text-align:center; padding:6px;
}

/* ‚îÄ‚îÄ LIGHT MODE OVERRIDES ‚îÄ‚îÄ */
html.light .sp-btn.on,
html.light .sp-btn:hover {
  color: #1a1240;
  background: linear-gradient(135deg, rgba(255,165,0,0.2), rgba(255,69,87,0.15));
}
html.light .nt.done { opacity: 0.3; }
html.light .nt.cur  { border-color: #1a1240; box-shadow: 0 0 14px rgba(26,18,64,0.3); }
html.light .note-track { background: rgba(0,0,0,0.03); border-radius: 12px; padding: 10px; }
html.light .sheet { border-color: rgba(255,165,0,0.3); }
html.light .act-card { border-color: var(--border); box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
html.light .act-card:hover { box-shadow: 0 12px 40px rgba(0,0,0,0.12); }
html.light .level-block { box-shadow: 0 2px 12px rgba(0,0,0,0.07); }
html.light .game-overlay { background: var(--bg); }
html.light .game-title { -webkit-text-fill-color: transparent; }
html.light .freeze-status,
html.light .echo-status,
html.light .hl-score,
html.light .cmatch-score { color: #6B21A8; }
html.light .score-chip { box-shadow: 0 2px 10px rgba(0,0,0,0.08); border: 1px solid var(--border); }
html.light .top-banner { color: #1a0000; }
html.light .logo-sub { color: var(--text2); }
html.light .tab { color: var(--text2); }
html.light .lnav-prev { color: var(--text2); border-color: var(--border); }
html.light .echo-replay { color: var(--text3); border-color: var(--border); }
html.light .echo-replay:hover { color: var(--gold); }
html.light .bubble { box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
html.light .badge-item { box-shadow: 0 2px 12px rgba(0,0,0,0.07); }
html.light .lesson-row { background: rgba(0,0,0,0.03); }
html.light .lesson-row:hover { background: rgba(255,165,0,0.08); }
html.light .step-card { box-shadow: 0 4px 20px rgba(0,0,0,0.07); }

/* ‚ïê‚ïê LESSON SYSTEM CSS ‚ïê‚ïê */
.level-road { display:flex;flex-direction:column;gap:12px;max-width:680px;margin:0 auto;padding:0 4px; }
.level-block { background:var(--panel);border-radius:20px;border:2px solid var(--border);overflow:hidden;transition:all 0.3s; }
.level-block.unlocked { border-color:rgba(255,215,0,0.25); }
.level-block.locked   { opacity:0.55; }
.level-header { display:flex;align-items:center;gap:14px;padding:16px 20px;cursor:pointer;user-select:none; }
.level-badge  { width:52px;height:52px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;flex-shrink:0;box-shadow:0 4px 16px rgba(0,0,0,0.4); }
.level-info   { flex:1;min-width:0; }
.level-title  { font-family:'Baloo 2',cursive;font-size:1.05rem;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis; }
.level-meta   { font-size:0.78rem;color:var(--text2);margin-top:2px; }
.level-arrow  { font-size:1.2rem;color:rgba(255,255,255,0.3);transition:transform 0.3s;flex-shrink:0; }
.level-block.open .level-arrow { transform:rotate(90deg); }
.level-prog   { height:4px;background:rgba(255,255,255,0.07);margin:0 20px 14px;border-radius:4px;overflow:hidden; }
.level-prog-fill { height:100%;border-radius:4px;transition:width 0.8s ease; }
.lesson-list  { display:none;flex-direction:column;gap:6px;padding:0 14px 14px; }
.level-block.open .lesson-list { display:flex; }
.lesson-row   { display:flex;align-items:center;gap:12px;background:var(--panel2);border-radius:14px;padding:12px 16px;cursor:pointer;border:2px solid transparent;transition:all 0.25s; }
.lesson-row:hover { border-color:rgba(255,215,0,0.3);transform:translateX(4px); }
.lesson-row.done  { border-color:rgba(46,213,115,0.3); }
.lesson-row.locked-lesson { opacity:0.4;cursor:not-allowed; }
.lesson-row.locked-lesson:hover { transform:none;border-color:transparent; }
.lesson-dot   { width:36px;height:36px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1rem; }
.lesson-row-info  { flex:1; }
.lesson-row-title { font-family:'Baloo 2',cursive;font-size:0.95rem;color:var(--text); }
.lesson-row-sub   { font-size:0.75rem;color:var(--text3);margin-top:1px; }
.lesson-status    { font-size:1.1rem; }

/* Lesson full-screen overlay */
.lesson-overlay { position:fixed;inset:0;background:var(--bg);z-index:300;display:none;flex-direction:column;overflow-y:auto; }
.lesson-overlay.on { display:flex; }
.lesson-topbar { display:flex;align-items:center;gap:12px;padding:14px 20px;background:var(--panel);border-bottom:2px solid var(--border);position:sticky;top:0;z-index:10;flex-shrink:0; }
.lesson-back { font-family:'Baloo 2',cursive;padding:8px 18px;border-radius:40px;border:2px solid var(--border);background:transparent;color:var(--text);cursor:pointer;font-size:0.9rem;transition:all 0.2s; }
.lesson-back:hover { border-color:var(--gold);color:var(--gold); }
.lesson-topbar-title { font-family:'Baloo 2',cursive;font-size:1.1rem;color:var(--gold);flex:1;text-align:center; }
.lesson-step-ind { font-family:'Baloo 2',cursive;font-size:0.85rem;color:var(--text3); }
.lesson-content { flex:1;padding:20px;max-width:680px;margin:0 auto;width:100%; }
.step-card { background:var(--panel);border-radius:22px;padding:24px;margin-bottom:16px;border:2px solid var(--border);animation:stepIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275); }
@keyframes stepIn { from{transform:translateY(30px) scale(0.97);opacity:0;} to{transform:translateY(0) scale(1);opacity:1;} }
.step-type-badge { display:inline-block;font-family:'Baloo 2',cursive;font-size:0.72rem;letter-spacing:1.5px;text-transform:uppercase;padding:4px 12px;border-radius:20px;margin-bottom:12px; }
.badge-explain { background:rgba(30,144,255,0.2);color:#1E90FF;border:1px solid #1E90FF; }
.badge-try     { background:rgba(46,213,115,0.2);color:#2ED573;border:1px solid #2ED573; }
.badge-quiz    { background:rgba(168,85,247,0.2);color:#A855F7;border:1px solid #A855F7; }
.step-heading  { font-family:'Baloo 2',cursive;font-size:1.45rem;color:var(--text);margin-bottom:10px; }
.step-body     { font-size:0.97rem;color:var(--text2);line-height:1.85; }
.step-body strong { color:var(--gold); }
.step-visual   { text-align:center;margin:18px 0;font-size:clamp(3rem,12vw,5.5rem);animation:mascotWiggle 2s ease-in-out infinite; }
.finger-diagram { display:flex;gap:8px;justify-content:center;margin:16px 0;flex-wrap:wrap; }
.finger-bubble  { width:54px;height:76px;border-radius:28px 28px 14px 14px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;font-family:'Baloo 2',cursive;cursor:pointer;transition:transform 0.2s;box-shadow:0 4px 14px rgba(0,0,0,0.3); }
.finger-bubble:hover { transform:translateY(-10px) scale(1.12); }
.finger-bubble .fnum { font-size:1.4rem;font-weight:900; }
.finger-bubble .fname { font-size:0.6rem;opacity:0.8; }
.note-name-grid  { display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:14px 0; }
.note-name-pill  { padding:10px 18px;border-radius:50px;font-family:'Baloo 2',cursive;font-size:1.1rem;font-weight:800;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,0.3);transition:transform 0.2s; }
.note-name-pill:hover { transform:scale(1.15) rotate(-2deg); }
.staff-wrap   { background:var(--sheet-bg);border-radius:16px;padding:20px;margin:14px 0;text-align:center;overflow-x:auto; }
.rhythm-grid  { display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:14px 0; }
.beat-box     { width:54px;height:54px;border-radius:14px;border:3px solid rgba(255,255,255,0.15);display:flex;align-items:center;justify-content:center;font-family:'Baloo 2',cursive;font-size:1.5rem;cursor:pointer;transition:all 0.15s;user-select:none; }
.beat-box.active { background:var(--gold);border-color:var(--gold);color:#222;transform:scale(1.1); }
.beat-box:hover  { border-color:var(--gold); }
.lesson-piano-wrap { perspective:700px;display:flex;justify-content:center;margin:14px 0; }
.lesson-piano-3d   { transform:rotateX(16deg);background:linear-gradient(160deg,#3d1800,#0d0500);border-radius:14px 14px 4px 4px;padding:14px 16px 24px;box-shadow:0 25px 55px rgba(0,0,0,0.85),0 0 0 3px #7a3000,inset 0 2px 4px rgba(255,180,60,0.2); }
.lp-keys { display:flex;gap:4px;position:relative;height:140px; }
.lp-wk   { width:48px;height:130px;background:linear-gradient(180deg,#FEFEFE 0%,#EDE5D5 55%,#DDD0B8 100%);border-radius:0 0 10px 10px;cursor:pointer;border:1px solid #C8BFAA;box-shadow:0 7px 0 #B0A090,0 9px 18px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,1);transition:all 0.08s;transform-origin:top center;user-select:none;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding-bottom:8px; }
.lp-wk .lp-label { font-family:'Baloo 2',cursive;font-size:0.8rem;font-weight:800;color:var(--key-label);pointer-events:none; }
.lp-wk .lp-emoji { font-size:1rem;pointer-events:none;margin-bottom:2px; }
.lp-wk:active,.lp-wk.lplit { transform:rotateX(6deg);box-shadow:0 3px 0 #B0A090,0 4px 10px rgba(0,0,0,0.3); }
.lp-wk.lplit.ln0 { background:linear-gradient(180deg,#FF6B6B,#FF4757); }
.lp-wk.lplit.ln1 { background:linear-gradient(180deg,#FFB347,#FFA502); }
.lp-wk.lplit.ln2 { background:linear-gradient(180deg,#FFE040,#FFD700); }
.lp-wk.lplit.ln3 { background:linear-gradient(180deg,#69F0AE,#2ED573); }
.lp-wk.lplit.ln4 { background:linear-gradient(180deg,#4FC3F7,#1E90FF); }
.lp-wk.lplit.ln5 { background:linear-gradient(180deg,#CE93D8,#A855F7); }
.lp-wk.lplit.ln6 { background:linear-gradient(180deg,#FF80AB,#FF4FA3); }
.lp-bk { width:30px;height:88px;background:linear-gradient(180deg,#333,#000);border-radius:0 0 7px 7px;cursor:pointer;position:absolute;z-index:3;box-shadow:0 6px 0 #000,0 8px 16px rgba(0,0,0,0.8),inset 0 1px 0 rgba(255,255,255,0.1);transition:all 0.08s;transform-origin:top center;user-select:none; }
.lp-bk:active,.lp-bk.lplit { transform:rotateX(6deg);background:linear-gradient(180deg,#FF6B00,#CC4400); }
.quiz-opts { display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0; }
.quiz-opt  { font-family:'Baloo 2',cursive;font-size:1rem;font-weight:800;padding:14px;border-radius:16px;border:3px solid var(--border);background:var(--panel2);color:var(--text);cursor:pointer;transition:all 0.2s;text-align:center; }
.quiz-opt:hover  { border-color:var(--gold);transform:scale(1.03); }
.quiz-opt.correct { background:rgba(46,213,115,0.25);border-color:#2ED573; }
.quiz-opt.wrong   { background:rgba(255,71,87,0.2);border-color:#FF4757; }
.lesson-nav { display:flex;gap:12px;justify-content:center;padding:16px 20px 30px;flex-wrap:wrap; }
.lnav-btn   { font-family:'Baloo 2',cursive;padding:13px 28px;border-radius:50px;border:none;cursor:pointer;font-size:1rem;font-weight:800;transition:all 0.3s; }
.lnav-btn:hover { transform:translateY(-3px) scale(1.04);box-shadow:0 10px 30px rgba(0,0,0,0.4); }
.lnav-next  { background:linear-gradient(135deg,#2ED573,#00C853);color:#001a00; }
.lnav-prev  { background:var(--panel2);color:rgba(255,255,255,0.6);border:2px solid rgba(255,255,255,0.1); }
.lnav-done  { background:linear-gradient(135deg,var(--gold),#FF4757);color:white; }
.key-instruction { background:rgba(255,215,0,0.1);border:2px solid rgba(255,215,0,0.3);border-radius:14px;padding:14px 18px;margin:12px 0;font-family:'Baloo 2',cursive;font-size:1rem;color:var(--gold);text-align:center; }
.fb-bar { font-family:'Baloo 2',cursive;font-size:1.5rem;min-height:2rem;text-align:center;margin:8px 0; }

/* ‚ïê‚ïê METRONOME ‚ïê‚ïê */
.metronome-bar {
  display:flex; align-items:center; gap:14px; justify-content:center;
  background:var(--panel); border-radius:20px; padding:14px 22px;
  border:2px solid rgba(255,255,255,0.07); max-width:680px; width:100%;
  flex-wrap:wrap;
}
.metro-pendulum-wrap {
  width:54px; height:54px; position:relative; flex-shrink:0;
}
.metro-pendulum {
  position:absolute; bottom:0; left:50%; width:4px; height:48px;
  background:linear-gradient(180deg,var(--gold),#FF4757);
  transform-origin:bottom center; border-radius:4px;
  transform:translateX(-50%) rotate(0deg);
  transition:transform 0s;
}
.metro-pendulum.tick { animation:metroPend var(--metro-dur,0.5s) ease-in-out; }
@keyframes metroPend {
  0%   { transform:translateX(-50%) rotate(-30deg); }
  50%  { transform:translateX(-50%) rotate(30deg); }
  100% { transform:translateX(-50%) rotate(-30deg); }
}
.metro-beat-dot {
  width:14px; height:14px; border-radius:50%;
  background:rgba(255,255,255,0.15); border:2px solid rgba(255,255,255,0.2);
  transition:all 0.08s;
}
.metro-beat-dot.on { background:var(--gold); border-color:var(--gold); transform:scale(1.4); box-shadow:0 0 12px rgba(255,215,0,0.6); }
.metro-beat-dot.accent { background:#FF4757; border-color:#FF4757; }
.metro-beat-dot.accent.on { background:#FF4757; border-color:#FF4757; box-shadow:0 0 14px rgba(255,71,87,0.7); }
.metro-controls { display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:center; }
.metro-bpm-label { font-family:'Baloo 2',cursive;font-size:1rem;color:var(--gold);min-width:72px;text-align:center; }
.metro-slider {
  -webkit-appearance:none; appearance:none;
  width:130px; height:6px; border-radius:4px;
  background:linear-gradient(90deg,var(--gold),#FF4757); cursor:pointer; outline:none;
}
.metro-slider::-webkit-slider-thumb {
  -webkit-appearance:none; width:20px; height:20px; border-radius:50%;
  background:white; box-shadow:0 2px 8px rgba(0,0,0,0.4); cursor:pointer;
}
.metro-btn {
  font-family:'Baloo 2',cursive; padding:9px 20px; border-radius:40px;
  border:none; cursor:pointer; font-size:0.9rem; font-weight:800;
  transition:all 0.25s;
}
.metro-btn:hover { transform:scale(1.07); }
.metro-start { background:linear-gradient(135deg,#2ED573,#00C853); color:#001a00; }
.metro-stop  { background:linear-gradient(135deg,#FF4757,#CC0022); color:white; }
.metro-sig-btn {
  font-family:'Baloo 2',cursive; padding:6px 12px; border-radius:20px;
  border:2px solid var(--border); background:var(--panel2);
  color:var(--text2); cursor:pointer; font-size:0.8rem; transition:all 0.2s;
}
.metro-sig-btn.on { border-color:var(--gold); color:var(--gold); background:rgba(255,215,0,0.1); }
.metro-sig-btn:hover { border-color:rgba(255,215,0,0.5); }

/* ‚ïê‚ïê RECORDER ‚ïê‚ïê */
.recorder-bar {
  display:flex; align-items:center; gap:12px; justify-content:center;
  background:var(--panel); border-radius:20px; padding:13px 22px;
  border:2px solid rgba(255,255,255,0.07); max-width:680px; width:100%;
  flex-wrap:wrap;
}
.rec-indicator {
  width:14px; height:14px; border-radius:50%; background:#444;
  transition:all 0.3s; flex-shrink:0;
}
.rec-indicator.recording { background:#FF4757; box-shadow:0 0 12px #FF4757; animation:recPulse 0.8s ease-in-out infinite; }
@keyframes recPulse { 0%,100%{opacity:1;} 50%{opacity:0.3;} }
.rec-indicator.has-data { background:#2ED573; box-shadow:0 0 8px #2ED573; animation:none; }
.rec-label { font-family:'Baloo 2',cursive; font-size:0.85rem; color:var(--text2); flex:1; min-width:80px; }
.rec-btn {
  font-family:'Baloo 2',cursive; padding:8px 18px; border-radius:40px;
  border:none; cursor:pointer; font-size:0.85rem; font-weight:800; transition:all 0.25s;
}
.rec-btn:hover { transform:scale(1.07); }
.rec-record { background:linear-gradient(135deg,#FF4757,#CC0022); color:white; }
.rec-stop   { background:linear-gradient(135deg,#FFA502,#FF6B00); color:white; }
.rec-play   { background:linear-gradient(135deg,#2ED573,#00C853); color:#001a00; }
.rec-clear  { background:var(--panel2); color:var(--text2); border:2px solid var(--border); }
.rec-time   { font-family:'Baloo 2',cursive; font-size:0.85rem; color:var(--text3); min-width:40px; text-align:center; }

/* Waveform mini visualiser */
.rec-wave { display:flex; align-items:flex-end; gap:2px; height:28px; }
.rec-wave-bar {
  width:3px; border-radius:2px; background:var(--gold);
  animation:waveAnim var(--d,0.5s) ease-in-out infinite alternate;
  opacity:0.7;
}
@keyframes waveAnim { from{height:4px;} to{height:100%;} }

/* ‚ïê‚ïê SCROLLING NOTE WATERFALL ‚ïê‚ïê */
.waterfall-wrap {
  width:100%; max-width:680px; height:60px; position:relative;
  overflow:hidden; border-radius:12px;
  background:rgba(255,255,255,0.04); border:1px solid var(--border);
}
.waterfall-note {
  position:absolute; bottom:4px; width:32px; height:52px; border-radius:8px;
  font-family:'Baloo 2',cursive; font-size:0.75rem; font-weight:800;
  display:flex; align-items:center; justify-content:center; color:white;
  animation:waterFall 0.8s ease-out forwards;
  pointer-events:none;
}
@keyframes waterFall {
  from { opacity:1; bottom:4px; }
  to   { opacity:0; bottom:58px; }
}

/* ‚ïê‚ïê UI POLISH ‚Äî Piano glow aura ‚ïê‚ïê */
.piano-glow-aura {
  position:absolute; inset:-20px; border-radius:30px;
  background:radial-gradient(ellipse at center, rgba(255,165,0,0.12) 0%, transparent 70%);
  pointer-events:none; z-index:0;
  animation:auraPulse 3s ease-in-out infinite alternate;
}
@keyframes auraPulse { from{opacity:0.5;} to{opacity:1;} }
.piano-stage { position:relative; }

/* ‚ïê‚ïê TEMPO CHIP on song picker ‚ïê‚ïê */
.bpm-chip {
  font-family:'Baloo 2',cursive; font-size:0.7rem;
  padding:2px 8px; border-radius:20px;
  background:rgba(255,165,0,0.15); color:var(--gold);
  border:1px solid rgba(255,165,0,0.3); margin-left:4px; vertical-align:middle;
}

/* ‚ïê‚ïê KEY GLOW UPGRADE ‚ïê‚ïê */
.wk:hover:not(.lit) { background:linear-gradient(180deg,#fffdf0 0%,#f5ecd8 55%,#e8d9c0 100%); }

/* ‚ïê‚ïê PILL RIPPLE ‚ïê‚ïê */
.nt { position:relative; overflow:hidden; }
.nt::after {
  content:''; position:absolute; inset:0; border-radius:inherit;
  background:rgba(255,255,255,0.3); transform:scale(0); opacity:0;
  transition:transform 0.35s, opacity 0.35s;
}
.nt.cur::after { transform:scale(1); opacity:0; transition:none; }

/* ‚ïê‚ïê AGE GROUP PICKER ‚ïê‚ïê */
.age-pick-card {
  background:var(--panel); border-radius:22px; padding:24px 20px;
  text-align:center; cursor:pointer; border:3px solid var(--border);
  transition:all 0.3s cubic-bezier(0.175,0.885,0.32,1.275);
  min-width:160px; flex:1; max-width:200px;
}
.age-pick-card:hover { transform:translateY(-8px) scale(1.04); border-color:var(--gold); box-shadow:0 16px 40px rgba(0,0,0,0.4); }
.age-pick-card.selected { border-color:var(--gold); background:rgba(255,215,0,0.08); box-shadow:0 0 24px rgba(255,215,0,0.2); }
.age-pick-emoji { font-size:3rem; margin-bottom:10px; }
.age-pick-label { font-family:'Baloo 2',cursive; font-size:1.2rem; color:var(--text); font-weight:800; margin-bottom:4px; }
.age-pick-sub   { font-size:0.78rem; color:var(--text2); }

/* ‚ïê‚ïê LIGHT MODE ‚ïê‚ïê */
html.light .age-pick-card { box-shadow:0 2px 12px rgba(0,0,0,0.07); }

html.light .rec-clear { color:var(--text2); }
html.light .metronome-bar, html.light .recorder-bar { border-color:var(--border); }
</style>
</head>
<body>

<button class="theme-toggle" id="themeToggle" title="Switch theme">üåô</button>
<div class="bg-orbs">
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>
  <div class="orb orb3"></div>
  <div class="orb orb4"></div>
</div>

<div class="top-banner" id="banner">üéâ Amazing!</div>

<!-- HEADER -->
<header>
  <div class="logo">üéπ PianoNaija!</div>
  <div class="logo-sub">üá≥üá¨ Learn ¬∑ Play ¬∑ Shine ¬∑ Naija Style</div>
</header>

<!-- MASCOT -->
<div class="mascot-row">
  <div class="mascot-wrap" onclick="cycleMascot()">
    <span class="mascot-body" id="mascot">ü¶Å</span>
  </div>
  <div class="bubble" id="bubble">·∫∏ k√°√†b·ªçÃÄ! I am Kwame! Touch the piano and make music! üéµ</div>
</div>

<!-- SCORE BAR -->
<div class="score-bar">
  <div class="score-chip">‚≠ê Stars: <span class="val" id="starsVal">0</span></div>
  <div class="score-chip">üèÜ Score: <span class="val" id="scoreVal">0</span></div>
  <div class="score-chip">üéµ Songs: <span class="val" id="songsVal">0</span></div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab t0 on" onclick="showTab('piano',0)">üéπ Piano</button>
  <button class="tab t1" onclick="showTab('lessons',1)">üìö Lessons</button>
  <button class="tab t2" onclick="showTab('activities',2)">üéÆ Activities</button>
  <button class="tab t3" onclick="showTab('badges',3)">üèÜ Badges</button>
</div>

<!-- ===== PIANO SECTION ===== -->
<div class="sect on" id="s-piano">
  <div class="piano-wrap">

    <!-- Song picker -->
    <div class="song-picker" id="songPicker"></div>

    <!-- 3D Piano -->
    <div class="piano-stage">
      <div class="piano-glow-aura"></div>
      <div class="piano-3d">
        <div class="piano-case">
          <div class="piano-brand">‚ú¶ PianoNaija ‚ú¶</div>
          <div class="keys-row" id="keysRow"></div>
        </div>
      </div>
    </div>
    <div class="hint-bar">üí° Keyboard: A S D F G H J K &nbsp;|&nbsp; Black keys: W E T Y U</div>

    <!-- Waterfall note trail -->
    <div class="waterfall-wrap" id="waterfall"></div>

    <!-- METRONOME BAR -->
    <div class="metronome-bar" id="metronomeBar">
      <div class="metro-pendulum-wrap">
        <div class="metro-pendulum" id="metroPendulum"></div>
      </div>
      <div style="display:flex;gap:6px;align-items:center;" id="metroDots"></div>
      <div class="metro-controls">
        <span class="metro-bpm-label" id="metroBpmLabel">‚ô© 90 BPM</span>
        <input type="range" class="metro-slider" id="metroSlider" min="40" max="220" value="90"
          oninput="metroBpmChange(this.value)">
        <button class="metro-sig-btn on" onclick="metroSetSig(4)" id="msig4">4/4</button>
        <button class="metro-sig-btn"    onclick="metroSetSig(3)" id="msig3">3/4</button>
        <button class="metro-sig-btn"    onclick="metroSetSig(2)" id="msig2">2/4</button>
        <button class="metro-btn metro-start" id="metroToggleBtn" onclick="metroToggle()">‚ñ∂ Metronome</button>
      </div>
    </div>

    <!-- RECORDER BAR -->
    <div class="recorder-bar">
      <div class="rec-indicator" id="recIndicator"></div>
      <span class="rec-label" id="recLabel">Ready to record</span>
      <div class="rec-wave" id="recWave" style="display:none"></div>
      <span class="rec-time" id="recTime"></span>
      <button class="rec-btn rec-record" id="recRecordBtn" onclick="recStart()">‚è∫ Record</button>
      <button class="rec-btn rec-stop"   id="recStopBtn"  onclick="recStop()"  style="display:none">‚èπ Stop</button>
      <button class="rec-btn rec-play"   id="recPlayBtn"  onclick="recPlay()"  style="display:none">‚ñ∂ Play</button>
      <button class="rec-btn rec-clear"  id="recClearBtn" onclick="recClear()" style="display:none">‚úï Clear</button>
    </div>

    <!-- Sheet -->
    <div class="sheet">
      <div class="sheet-title" id="sheetTitle">üêë Baa Baa Black Sheep</div>
      <div class="lyric-line" id="lyricLine">"Baa baa black sheep, have you any wool?"</div>
      <div class="note-track" id="noteTrack"></div>
      <div class="play-btns">
        <button class="pb pplay" onclick="autoPlay(false)">‚ñ∂ Play Song</button>
        <button class="pb pslow" onclick="autoPlay(true)">üê¢ Slow</button>
        <button class="pb preset" onclick="startPlayAlong()">üéØ Play Along!</button>
        <button class="pb pstop" onclick="stopAll()">‚èπ Stop</button>
      </div>
    </div>

  </div>
</div>

<!-- ===== LESSONS SECTION ===== -->
<div class="sect" id="s-lessons">
  <div class="sec-title">üìö Piano Lessons</div>

  <!-- AGE GROUP PICKER -->
  <div id="agePickerWrap" style="display:none">
    <div style="text-align:center;font-family:'Baloo 2',cursive;font-size:1rem;color:var(--text2);margin-bottom:18px;">
      üëã Welcome! First, tell us how old the student is so we can pick the right lessons!
    </div>
    <div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap;max-width:700px;margin:0 auto 24px;">
      <div class="age-pick-card" onclick="selectAgeGroup('3-5')">
        <div class="age-pick-emoji">üê£</div>
        <div class="age-pick-label">Ages 3‚Äì5</div>
        <div class="age-pick-sub">Beginners ¬∑ Simple & fun</div>
      </div>
      <div class="age-pick-card" onclick="selectAgeGroup('5-8')">
        <div class="age-pick-emoji">üå±</div>
        <div class="age-pick-label">Ages 5‚Äì8</div>
        <div class="age-pick-sub">Intermediate ¬∑ Growing skills</div>
      </div>
      <div class="age-pick-card" onclick="selectAgeGroup('8-10')">
        <div class="age-pick-emoji">üåü</div>
        <div class="age-pick-label">Ages 8‚Äì10</div>
        <div class="age-pick-sub">Advanced ¬∑ More theory</div>
      </div>
    </div>
  </div>

  <!-- AGE GROUP BANNER (shown after selection) -->
  <div id="ageGroupBanner" style="display:none;text-align:center;margin-bottom:16px;">
    <span id="ageGroupLabel" style="font-family:'Baloo 2',cursive;font-size:0.95rem;padding:8px 20px;border-radius:40px;background:var(--panel2);color:var(--gold);border:2px solid rgba(255,215,0,0.25);"></span>
    <button onclick="changeAgeGroup()" style="font-family:'Baloo 2',cursive;margin-left:10px;padding:6px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;color:var(--text2);cursor:pointer;font-size:0.8rem;">‚úèÔ∏è Change</button>
  </div>

  <div style="text-align:center;color:rgba(255,255,255,0.5);font-size:0.9rem;margin-bottom:20px;" id="lessonSubtitle" style="display:none">
    Complete levels in order to unlock the next! üîì
  </div>
  <div class="level-road" id="levelRoad"></div>
</div>

<!-- LESSON FULL-SCREEN VIEWER -->
<div class="lesson-overlay" id="lessonOverlay">
  <div class="lesson-topbar">
    <button class="lesson-back" onclick="closeLessonViewer()">‚Üê Back</button>
    <div class="lesson-topbar-title" id="lessonOverlayTitle">Lesson</div>
    <div class="lesson-step-ind" id="lessonStepInd">1/1</div>
  </div>
  <div class="lesson-content" id="lessonContent"></div>
  <div class="lesson-nav" id="lessonNav"></div>
</div>

<!-- ===== ACTIVITIES SECTION ===== -->
<div class="sect" id="s-activities">
  <div class="sec-title">üéÆ Fun Class Activities!</div>
  <div class="act-grid">
    <div class="act-card" style="--ac:#FF4757" onclick="openGame('nametune')">
      <span class="act-icon2">üéµü§î</span>
      <div class="act-name">Name That Tune!</div>
      <div class="act-desc2">Listen to a few notes of a nursery rhyme and guess which song it is! Can you recognise Baa Baa Black Sheep from just 3 notes?</div>
      <span class="act-tag">üë¶üëß Solo or class ¬∑ Ages 4‚Äì6</span>
    </div>
    <div class="act-card" style="--ac:#FFD700" onclick="openGame('colour')">
      <span class="act-icon2">üåàüéπ</span>
      <div class="act-name">Colour Note Match!</div>
      <div class="act-desc2">See the colour card and tap the matching piano key! Red = C, Orange = D... How fast can you go?</div>
      <span class="act-tag">üë¶ Solo or pairs ¬∑ Ages 3‚Äì5</span>
    </div>
    <div class="act-card" style="--ac:#1E90FF" onclick="openGame('echo')">
      <span class="act-icon2">üé§üéπ</span>
      <div class="act-name">Echo Echo!</div>
      <div class="act-desc2">Listen to the pattern and echo it back on the piano! Builds ear training and memory. Can you remember 5 notes?</div>
      <span class="act-tag">üë¶ 1‚Äì2 players ¬∑ All ages</span>
    </div>
    <div class="act-card" style="--ac:#A855F7" onclick="openGame('highlow')">
      <span class="act-icon2">‚¨ÜÔ∏è‚¨áÔ∏èüéµ</span>
      <div class="act-name">High or Low?</div>
      <div class="act-desc2">Listen to the note ‚Äî is it HIGH or LOW? Jump up for high, crouch down for low! Gets tricky fast!</div>
      <span class="act-tag">üë¶üëß Any number ¬∑ Ages 3‚Äì6</span>
    </div>
  </div>
</div>

<!-- ===== BADGES SECTION ===== -->
<div class="sect" id="s-badges">
  <div class="sec-title">üèÜ My Trophy Shelf</div>
  <div style="text-align:center;margin-bottom:12px;font-family:'Baloo 2',cursive;color:rgba(255,255,255,0.6)">
    Keep playing to unlock all badges!
  </div>
  <div class="prog-wrap"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
  <div class="badge-shelf" id="badgeShelf"></div>
</div>

<!-- ===== GAME OVERLAYS ===== -->

<!-- NAME THAT TUNE -->
<div class="game-overlay" id="g-nametune">
  <button class="game-close" onclick="closeGame()">‚úï</button>
  <div class="game-title">üéµ Name That Tune!</div>
  <div class="game-instr">Listen to the notes playing ‚Äî then pick the right song! Fewer clues = more points! üèÜ</div>

  <div style="width:100%;max-width:520px;text-align:center;">

    <!-- Clue counter + score -->
    <div style="display:flex;gap:16px;justify-content:center;margin-bottom:12px;flex-wrap:wrap;">
      <div class="score-chip">üéµ Clues used: <span class="val" id="nttClues">0</span></div>
      <div class="score-chip">üèÜ Score: <span class="val" id="nttScore">0</span></div>
      <div class="score-chip">‚úÖ Round: <span class="val" id="nttRound">1</span> / 5</div>
    </div>

    <!-- Big visual display -->
    <div id="nttVisual" style="font-size:5rem;margin:10px 0;animation:mascotWiggle 2s ease-in-out infinite;">üéπ</div>
    <div id="nttStatus" style="font-family:'Baloo 2',cursive;font-size:1.2rem;color:var(--gold);min-height:1.6rem;margin-bottom:12px;">
      Press PLAY to hear the clue!
    </div>

    <!-- Play buttons -->
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:16px;">
      <button class="pb pplay" onclick="nttPlayClue(3)" id="nttBtn3">üéµ 3 Notes <span style="font-size:0.75rem;opacity:0.8">(+30 pts)</span></button>
      <button class="pb pslow" onclick="nttPlayClue(5)" id="nttBtn5">üéµüéµ 5 Notes <span style="font-size:0.75rem;opacity:0.8">(+20 pts)</span></button>
      <button class="pb preset" onclick="nttPlayClue(8)" id="nttBtn8">üéµüéµüéµ Full Intro <span style="font-size:0.75rem;opacity:0.8">(+10 pts)</span></button>
    </div>

    <!-- Answer choices -->
    <div id="nttChoices" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:4px;"></div>

    <!-- Feedback -->
    <div id="nttFeedback" style="font-family:'Baloo 2',cursive;font-size:1.8rem;min-height:2.2rem;margin:12px 0;"></div>
    <button class="echo-start" id="nttNextBtn" onclick="nttNextRound()" style="display:none;">‚ñ∂ Next Song!</button>
  </div>
</div>

<!-- COLOUR MATCH -->
<div class="game-overlay" id="g-colour">
  <button class="game-close" onclick="closeGame()">‚úï</button>
  <div class="game-title">üåà Colour Note Match!</div>
  <div class="game-instr">Look at the colour card ‚Äî tap the matching key on the piano!</div>
  <div class="cmatch-arena">
    <div class="cmatch-prompt" id="cmPrompt">Tap the key that matches this colour!</div>
    <div class="cmatch-color-card" id="cmCard" style="background:#FF4757">üéπ</div>
    <div class="cmatch-fb" id="cmFb"></div>
    <div class="cmatch-score" id="cmScore">Score: 0 | Streak: 0</div>
    <div class="cmatch-piano">
      <div class="cmatch-piano-3d">
        <div class="cmatch-keys" id="cmKeys"></div>
      </div>
    </div>
  </div>
</div>

<!-- ECHO -->
<div class="game-overlay" id="g-echo">
  <button class="game-close" onclick="closeGame()">‚úï</button>
  <div class="game-title">üé§ Echo Echo!</div>
  <div class="game-instr">Listen to the pattern ‚Äî then repeat it back! Each round gets longer.</div>

  <!-- Mode selector (shown before game starts) -->
  <div id="echoModeScreen" style="width:100%;max-width:500px;text-align:center;">
    <div style="font-family:'Baloo 2',cursive;font-size:1.1rem;color:rgba(255,255,255,0.7);margin-bottom:14px;">
      Choose your difficulty:
    </div>
    <div class="echo-mode-row">
      <button class="echo-mode-btn" onclick="startEchoMode('easy')">
        ‚≠ê Easy<br><span style="font-size:0.75rem;font-weight:500">See notes + coloured buttons</span>
      </button>
      <button class="echo-mode-btn" onclick="startEchoMode('medium')">
        üî• Medium<br><span style="font-size:0.75rem;font-weight:500">No sound hints ‚Äî just colours</span>
      </button>
      <button class="echo-mode-btn" onclick="startEchoMode('hard')">
        üíÄ Hard<br><span style="font-size:0.75rem;font-weight:500">Real piano ‚Äî no labels!</span>
      </button>
    </div>
    <div style="font-size:0.8rem;color:rgba(255,255,255,0.35);margin-top:10px;font-style:italic;">
      Easy: notes play + flash ¬∑ Medium: only notes play, no visuals ¬∑ Hard: you find them yourself on the piano!
    </div>
  </div>

  <!-- Game arena (shown during play) -->
  <div class="echo-arena" id="echoGameArena" style="display:none;">
    <div id="echoModeBadge" class="echo-mode-badge badge-easy">‚≠ê EASY</div>
    <div class="echo-status" id="echoStatus">Get ready...</div>

    <!-- Sequence dots (Easy shows labels, Medium shows colours only, Hard hidden) -->
    <div class="echo-sequence" id="echoSeq"></div>

    <div style="font-family:'Baloo 2',cursive;color:rgba(255,255,255,0.45);font-size:0.9rem;margin-bottom:6px;">
      Level: <span id="echoLevel">1</span> &nbsp;|&nbsp; Score: <span id="echoScore" style="color:var(--gold)">0</span>
    </div>

    <!-- EASY: labelled colour pads -->
    <div class="echo-keys" id="echoKeysEasy" style="display:none;"></div>

    <!-- MEDIUM: colour dots only (no text) -->
    <div class="echo-keys" id="echoKeysMedium" style="display:none;flex-wrap:wrap;gap:10px;justify-content:center;"></div>

    <!-- HARD: full unlabelled piano -->
    <div class="echo-hard-stage" id="echoKeysHard" style="display:none;">
      <div class="echo-hard-case">
        <div class="echo-hard-keys" id="echoHardRow"></div>
      </div>
    </div>

    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px;">
      <button class="echo-replay" id="echoReplayBtn" onclick="replayEchoSequence()" style="display:none;">üîÅ Replay</button>
      <button class="echo-start" id="echoBackBtn" onclick="resetEchoToMenu()" style="background:linear-gradient(135deg,#555,#333)">‚Üê Back</button>
    </div>
  </div>
</div>

<!-- HIGH LOW -->
<div class="game-overlay" id="g-highlow">
  <button class="game-close" onclick="closeGame()">‚úï</button>
  <div class="game-title">‚¨ÜÔ∏è‚¨áÔ∏è High or Low?</div>
  <div class="game-instr">Listen to the note carefully ‚Äî is it a HIGH note or a LOW note?</div>
  <div class="highlow-arena">
    <span class="hl-note-vis" id="hlEmoji">üéµ</span>
    <div class="hl-feedback" id="hlFb"></div>
    <div class="hl-score" id="hlScore">Score: 0 | Streak: 0</div>
    <div class="hl-piano-mini">
      <div style="background:#1a0900;padding:10px 12px 16px;border-radius:10px;box-shadow:0 15px 40px rgba(0,0,0,0.8),0 0 0 3px #7a3000">
        <div id="hlKeys" style="display:flex;gap:3px;position:relative;height:90px;"></div>
      </div>
    </div>
    <div class="hl-btns">
      <button class="hl-btn hl-high" onclick="hlGuess('high')">‚¨ÜÔ∏è HIGH!</button>
      <button class="hl-btn hl-low"  onclick="hlGuess('low')">‚¨áÔ∏è LOW!</button>
    </div>
    <button class="echo-start" onclick="hlStart()" id="hlStartBtn">üéµ START!</button>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUDIO ENGINE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let ctx = null;
function getCtx() {
  if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
  return ctx;
}

const FREQS = {
  C3:130.81, D3:146.83, E3:164.81, F3:174.61, G3:196, A3:220, B3:246.94,
  C4:261.63, D4:293.66, E4:329.63, F4:349.23, G4:392, A4:440, B4:493.88,
  C5:523.25, D5:587.33, E5:659.26, F5:698.46, G5:783.99,
  Cs4:277.18, Ds4:311.13, Fs4:369.99, Gs4:415.30, As4:466.16,
  Cs5:554.37, Ds5:622.25
};

const FNOTES = ['üéµ','üé∂','‚≠ê','‚ú®','üåü','üí´','üéπ','üéº'];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NURSERY RHYME SONGS
   Each note entry: [noteName, durationBeats]
   noteName 'R' = rest  |  BPM set per song
   durations: 1=quarter, 0.5=eighth, 1.5=dotted-quarter, 2=half, 0.25=sixteenth
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ Improved audio engine: schedules notes ahead of time using Web Audio clock ‚îÄ‚îÄ */
let audioScheduler = null;

let trackOscs = false; // only track during autoplay, not interactive taps

function playFreq(freq, durSec, startTime, vol=0.5) {
  const a = getCtx();
  if (!freq || freq <= 0) return; // rest ‚Äî silence
  const osc = a.createOscillator();
  const gain = a.createGain();
  osc.connect(gain); gain.connect(a.destination);
  osc.type = 'triangle';
  osc.frequency.value = freq;
  gain.gain.setValueAtTime(0, startTime);
  gain.gain.linearRampToValueAtTime(vol, startTime + 0.015);
  gain.gain.setValueAtTime(vol, startTime + durSec * 0.6);
  gain.gain.exponentialRampToValueAtTime(0.001, startTime + durSec * 0.92);
  osc.start(startTime);
  osc.stop(startTime + durSec);
  if (trackOscs) scheduledOscs.push({ osc, gain });
}

let isInteractiveTap = false; // flag to distinguish human tap from scheduled playback

function playNote(name, dur) {
  // Immediate play for interactive taps
  const a = getCtx();
  if (name === 'R') return;
  playFreq(FREQS[name], dur || 0.5, a.currentTime, 0.5);
  if (isInteractiveTap) {
    recNoteEvent(name);       // recorder hook
    spawnWaterfallNote(name); // waterfall hook
  }
}

/*
  Song format: { name, bpm, lyrics, beats }
  beats: array of { n: noteName, d: durationInBeats, ly: lyricIndex (optional) }
  'R' = rest note (silence)
  bpm controls overall tempo
*/
const SONGS = [
  {
    name: 'üêë Baa Baa Black Sheep',
    bpm: 112,
    lyrics: [
      '"Baa baa black sheep, have you any wool?"',
      '"Yes sir, yes sir, three bags full!"',
      '"One for the master, one for the dame,"',
      '"And one for the little boy who lives down the lane!"'
    ],
    beats: [
      // "Baa  baa  black sheep, have  you  a-  ny   wool?"
      {n:'C4',d:1,ly:0},{n:'C4',d:1},{n:'G4',d:1},{n:'G4',d:1},
      {n:'A4',d:1},{n:'A4',d:1},{n:'G4',d:2},
      {n:'R',d:0.5},
      // "Yes  sir, yes  sir, three bags  full!"
      {n:'F4',d:1,ly:1},{n:'F4',d:1},{n:'E4',d:1},{n:'E4',d:1},
      {n:'D4',d:1},{n:'D4',d:1},{n:'C4',d:2},
      {n:'R',d:0.5},
      // "One  for  the mas- ter, one  for  the dame,"
      {n:'G4',d:1,ly:2},{n:'G4',d:1},{n:'F4',d:1},{n:'F4',d:1},
      {n:'E4',d:1},{n:'E4',d:1},{n:'D4',d:2},
      {n:'R',d:0.25},
      // "One  for  the lit- tle  boy  who  lives down the lane!"
      {n:'G4',d:1,ly:3},{n:'G4',d:1},{n:'F4',d:1},{n:'F4',d:1},
      {n:'E4',d:1},{n:'E4',d:1},{n:'D4',d:2},
      {n:'R',d:0.5},
      // Repeat verse
      {n:'C4',d:1,ly:0},{n:'C4',d:1},{n:'G4',d:1},{n:'G4',d:1},
      {n:'A4',d:1},{n:'A4',d:1},{n:'G4',d:2},
      {n:'R',d:0.5},
      {n:'F4',d:1,ly:1},{n:'F4',d:1},{n:'E4',d:1},{n:'E4',d:1},
      {n:'D4',d:1},{n:'D4',d:1},{n:'C4',d:2},
    ]
  },
  {
    name: 'üåü Twinkle Twinkle',
    bpm: 108,
    lyrics: [
      '"Twinkle twinkle little star,"',
      '"How I wonder what you are!"',
      '"Up above the world so high,"',
      '"Like a diamond in the sky!"'
    ],
    beats: [
      // Twin-kle twin-kle lit-tle star,
      {n:'C4',d:1,ly:0},{n:'C4',d:1},{n:'G4',d:1},{n:'G4',d:1},
      {n:'A4',d:1},{n:'A4',d:1},{n:'G4',d:2},
      {n:'R',d:0.5},
      // How I won-der what you are!
      {n:'F4',d:1,ly:1},{n:'F4',d:1},{n:'E4',d:1},{n:'E4',d:1},
      {n:'D4',d:1},{n:'D4',d:1},{n:'C4',d:2},
      {n:'R',d:0.5},
      // Up a-bove the world so high,
      {n:'G4',d:1,ly:2},{n:'G4',d:1},{n:'F4',d:1},{n:'F4',d:1},
      {n:'E4',d:1},{n:'E4',d:1},{n:'D4',d:2},
      {n:'R',d:0.25},
      // Like a dia-mond in the sky!
      {n:'G4',d:1,ly:3},{n:'G4',d:1},{n:'F4',d:1},{n:'F4',d:1},
      {n:'E4',d:1},{n:'E4',d:1},{n:'D4',d:2},
      {n:'R',d:0.5},
      // Repeat opening
      {n:'C4',d:1,ly:0},{n:'C4',d:1},{n:'G4',d:1},{n:'G4',d:1},
      {n:'A4',d:1},{n:'A4',d:1},{n:'G4',d:2},
      {n:'R',d:0.5},
      {n:'F4',d:1,ly:1},{n:'F4',d:1},{n:'E4',d:1},{n:'E4',d:1},
      {n:'D4',d:1},{n:'D4',d:1},{n:'C4',d:2},
    ]
  },
  {
    name: 'üá≥üá¨ I Just Want to Say',
    bpm: 80,
    lyrics: [
      '"I just want to say..."',
      '"Baba oh..."',
      '"Ese... eh eh eh eh..."',
      '"I just want to say... baba oh... ese!"'
    ],
    beats: [
      // I    just  want  to   say.....
      // m    r     d     t    l
      {n:'E4',d:1,ly:0},{n:'D4',d:1},{n:'C4',d:1},{n:'B3',d:1},{n:'A3',d:2},
      {n:'R',d:2},
      // ba-  ba    oh......
      // d    m     r
      {n:'C4',d:1,ly:1},{n:'E4',d:1},{n:'D4',d:2},
      {n:'R',d:2},
      // e-   se....
      // d    m
      {n:'C4',d:1,ly:2},{n:'E4',d:2},
      {n:'R',d:1},
      // eh   eh    eh    eh......
      // r    m     r     d
      {n:'D4',d:0.5},{n:'E4',d:0.5},{n:'D4',d:0.5},{n:'C4',d:2},
      {n:'R',d:2},
      // I    just  want  to   say.......
      // m    r     d     t    l
      {n:'E4',d:1,ly:3},{n:'D4',d:1},{n:'C4',d:1},{n:'B3',d:1},{n:'A3',d:2},
      {n:'R',d:2},
      // ba-  ba    oh.......
      // d    m     r
      {n:'C4',d:1},{n:'E4',d:1},{n:'D4',d:2},
      {n:'R',d:2},
      // e-   se
      // t    d
      {n:'B3',d:1},{n:'C4',d:3},
    ]
  },
  {
    name: 'üôè Amazing Grace',
    bpm: 72,
    lyrics: [
      '"Amazing grace, how sweet the sound,"',
      '"That saved a wretch like me!"',
      '"I once was lost, but now am found,"',
      '"Was blind, but now I see!"'
    ],
    beats: [
      // A-    maz-  ing   grace,  how   sweet  the   sound,
      // C4    F4    A4    A4      G4    F4     D4    C4
      {n:'C4',d:1,ly:0},{n:'F4',d:2},
      {n:'A4',d:1},{n:'A4',d:2},
      {n:'G4',d:1},{n:'F4',d:2},
      {n:'D4',d:1},{n:'C4',d:2},
      {n:'R',d:0.5},
      // That   saved   a     wretch   like   me!
      // C4     F4      A4    A4       G4     C5
      {n:'C4',d:1,ly:1},{n:'F4',d:2},
      {n:'A4',d:1},{n:'A4',d:2},
      {n:'G4',d:1},{n:'C5',d:3},
      {n:'R',d:0.5},
      // I      once    was   lost,    but    now    am     found,
      // A4     C5      A4    A4       G4     F4     D4     C4
      {n:'A4',d:1,ly:2},{n:'C5',d:2},
      {n:'A4',d:1},{n:'A4',d:2},
      {n:'G4',d:1},{n:'F4',d:2},
      {n:'D4',d:1},{n:'C4',d:2},
      {n:'R',d:0.5},
      // Was    blind   but   now      I      see!
      // C4     F4      A4    A4       G4     F4
      {n:'C4',d:1,ly:3},{n:'F4',d:2},
      {n:'A4',d:1},{n:'A4',d:2},
      {n:'G4',d:1},{n:'F4',d:3},
    ]
  },
  {
    name: 'üö£ Row Your Boat',
    bpm: 100,
    lyrics: [
      '"Row, row, row your boat,"',
      '"Gently down the stream!"',
      '"Merrily, merrily, merrily, merrily,"',
      '"Life is but a dream!"'
    ],
    beats: [
      // Row   row   row   your  boat,
      // d     d     d     r     m
      {n:'C4',d:1,ly:0},{n:'C4',d:1},{n:'C4',d:0.75},{n:'D4',d:0.25},{n:'E4',d:2},
      {n:'R',d:0.5},
      // Gen-  tly   down  the   stream!
      // m     r     m     f     s
      {n:'E4',d:0.75,ly:1},{n:'D4',d:0.25},{n:'E4',d:0.75},{n:'F4',d:0.25},{n:'G4',d:2},
      {n:'R',d:0.5},
      // Mer-  ri-   ly    mer-  ri-   ly    mer-  ri-   ly    mer-  ri-   ly
      // d5    d5    d5    s     s     s     m     m     m     d     d     d
      {n:'C5',d:0.5,ly:2},{n:'C5',d:0.5},{n:'C5',d:0.5},
      {n:'G4',d:0.5},{n:'G4',d:0.5},{n:'G4',d:0.5},
      {n:'E4',d:0.5},{n:'E4',d:0.5},{n:'E4',d:0.5},
      {n:'C4',d:0.5},{n:'C4',d:0.5},{n:'C4',d:0.5},
      // Life  is    but   a     dream!
      // s5    f     m     r     d
      {n:'G4',d:0.75,ly:3},{n:'F4',d:0.25},{n:'E4',d:0.75},{n:'D4',d:0.25},{n:'C4',d:2},
    ]
  }
];


let curSong = 0, songStep = 0, playAlong = false;
let scheduledSources = []; // setTimeout IDs for visuals
let scheduledOscs = [];    // AudioNode oscillators for audio

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SONG PICKER UI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function buildSongPicker() {
  const p = document.getElementById('songPicker');
  p.innerHTML = '';
  SONGS.forEach((s,i) => {
    const b = document.createElement('button');
    b.className = 'sp-btn' + (i===curSong?' on':'');
    b.innerHTML = s.name + `<span class="bpm-chip">‚ô©${s.bpm}</span>`;
    b.onclick = () => {
      curSong = i; songStep = 0; stopAll(); buildSongPicker(); renderSheet();
      // Sync metronome BPM to song
      document.getElementById('metroSlider').value = s.bpm;
      metroBpmChange(s.bpm);
      setBubble(`Let's play ${s.name}! ‚ô©${s.bpm} BPM üéµ`);
    };
    p.appendChild(b);
  });
}

/* ‚îÄ‚îÄ Build note pills from beats array ‚îÄ‚îÄ */
function renderSheet() {
  const s = SONGS[curSong];
  document.getElementById('sheetTitle').textContent = s.name;
  document.getElementById('lyricLine').textContent = s.lyrics[0];
  const track = document.getElementById('noteTrack');
  track.innerHTML = '';
  s.beats.forEach((beat, i) => {
    const d = document.createElement('div');
    if (beat.n === 'R') {
      d.className = 'nt nR';
      d.textContent = '¬∑';
      d.style.opacity = '0.35';
      d.style.minWidth = Math.round(beat.d * 20) + 'px';
    } else {
      const base = beat.n[0];
      const is5  = beat.n.includes('5');
      const isSharp = beat.n.includes('s');
      const cls  = isSharp ? 'nCs' : 'n' + base + (is5 ? '5' : '');
      d.className = `nt ${cls}`;
      d.textContent = base + (isSharp ? '#' : '');
      // Widen pill for longer notes
      if (beat.d >= 2) d.style.padding = '8px 22px';
    }
    d.dataset.idx = i;
    if (beat.n !== 'R') d.onclick = () => { playNote(beat.n, 0.5); highlightNote(i); };
    track.appendChild(d);
  });
}

function highlightNote(idx) {
  const pills = document.querySelectorAll('#noteTrack .nt');
  const s = SONGS[curSong];
  const beat = s.beats[idx];
  pills.forEach((p, i) => {
    p.classList.remove('cur','done');
    if (i < idx) p.classList.add('done');
    if (i === idx) p.classList.add('cur');
  });
  // Scroll pill into view
  if (pills[idx]) pills[idx].scrollIntoView({block:'nearest',inline:'center',behavior:'smooth'});
  // Light up piano key
  if (beat && beat.n !== 'R') {
    const kEl = document.querySelector(`#keysRow [data-note="${beat.n}"]`);
    if (kEl) { kEl.classList.add('lit'); setTimeout(() => kEl.classList.remove('lit'), 280); }
  }
  // Update lyric
  if (beat && beat.ly !== undefined) {
    document.getElementById('lyricLine').textContent = s.lyrics[beat.ly];
  }
}

/* ‚îÄ‚îÄ‚îÄ Scheduled autoplay using Web Audio clock ‚îÄ‚îÄ‚îÄ */
function autoPlay(slow) {
  stopAll();
  playAlong = false;
  trackOscs = true;  // start tracking oscillators
  const s = SONGS[curSong];
  const a = getCtx();
  const secPerBeat = 60 / (slow ? s.bpm * 0.55 : s.bpm);
  let t = a.currentTime + 0.1;

  s.beats.forEach((beat, i) => {
    const durSec = beat.d * secPerBeat;
    // Schedule audio
    if (beat.n !== 'R') {
      playFreq(FREQS[beat.n], durSec * 0.88, t, 0.5);
    }
    // Schedule visual highlight via setTimeout
    const delay = (t - a.currentTime) * 1000;
    const capturedI = i;
    const tid = setTimeout(() => highlightNote(capturedI), delay);
    scheduledSources.push(tid);
    t += durSec;
  });
  // Clear highlights after song ends
  const endDelay = (t - a.currentTime) * 1000;
  const tid = setTimeout(() => {
    document.querySelectorAll('#noteTrack .nt').forEach(p => p.classList.remove('cur','done'));
    document.getElementById('lyricLine').textContent = s.lyrics[0];
  }, endDelay + 200);
  scheduledSources.push(tid);
  trackOscs = false; // done scheduling
}

function startPlayAlong() {
  stopAll();
  playAlong = true;
  songStep = 0;
  renderSheet();
  // Skip any leading rests and highlight the first real note
  const s = SONGS[curSong];
  while (songStep < s.beats.length && s.beats[songStep].n === 'R') songStep++;
  if (songStep < s.beats.length) highlightNote(songStep);
  setBubble("Now YOU play! Follow the coloured notes! üéØ");
  showBanner("üéØ Play Along Mode! Follow the notes!");
}

function checkAlong(note) {
  const s = SONGS[curSong];
  // Skip rests
  while (songStep < s.beats.length && s.beats[songStep].n === 'R') songStep++;
  if (songStep >= s.beats.length) return;
  if (note === s.beats[songStep].n) {
    highlightNote(songStep);
    songStep++;
    addScore(15);
    // Advance past rests
    while (songStep < s.beats.length && s.beats[songStep].n === 'R') songStep++;
    if (songStep >= s.beats.length) {
      playAlong = false;
      addScore(200); addSong(); confetti();
      showBanner("üéâ You finished the whole song! Amazing! +200 pts!");
      setBubble("E go better! You too good! ü¶Åüåüüéâ");
      unlockBadge(1);
    } else {
      highlightNote(songStep);
    }
  }
}

function stopAll() {
  // Cancel all scheduled visual timeouts
  scheduledSources.forEach(tid => clearTimeout(tid));
  scheduledSources = [];
  // Stop all scheduled audio oscillators immediately
  const now = getCtx().currentTime;
  scheduledOscs.forEach(({ osc, gain }) => {
    try {
      gain.gain.cancelScheduledValues(now);
      gain.gain.setValueAtTime(0, now);
      osc.stop(now);
    } catch(e) {} // ignore if already stopped
  });
  scheduledOscs = [];
  playAlong = false;
  songStep = 0;
  renderSheet();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCORE & MASCOT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let totalScore = 0, totalStars = 0, totalSongs = 0;
function addScore(n) {
  totalScore += n;
  totalStars = Math.floor(totalScore / 50);
  document.getElementById('scoreVal').textContent = totalScore;
  document.getElementById('starsVal').textContent = totalStars;
  document.getElementById('progFill').style.width = Math.min(100, totalScore/10) + '%';
  if (totalScore >= 100) unlockBadge(2);
  if (totalScore >= 300) unlockBadge(3);
  if (totalScore >= 600) unlockBadge(4);
  saveProgress();
}
function addSong() {
  totalSongs++;
  document.getElementById('songsVal').textContent = totalSongs;
  if (totalSongs >= 2) unlockBadge(5);
  if (totalSongs >= 4) unlockBadge(6);
}

const MASCOTS = ['ü¶Å','üêò','ü¶í','ü¶Ö','üêä','ü¶ì','üêÜ','ü¶ç'];
const bubblePhrases = [
  'Well done! You too good! üåü','Keep going! E go sweet! üéµ','Correct! Oya continue! üëè',
  'See this genius! ü¶Å','You dey do well! No stop! üî•','Ahh! Beautiful sound! üéπ',
  'Na so talent dey look! ‚≠ê','Amazing! Your mama go proud! üí´'
];
let mascotIdx = 0;
function cycleMascot() {
  mascotIdx = (mascotIdx+1) % MASCOTS.length;
  document.getElementById('mascot').textContent = MASCOTS[mascotIdx];
}
function setBubble(msg) {
  const b = document.getElementById('bubble');
  b.style.animation = 'none';
  b.textContent = msg;
  b.offsetWidth;
  b.style.animation = 'bubbleIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275)';
}

function showBanner(msg, dur=3000) {
  const b = document.getElementById('banner');
  b.textContent = msg;
  b.classList.add('show');
  setTimeout(() => b.classList.remove('show'), dur);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFETTI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function confetti() {
  const colors = ['#FF4757','#FFA502','#FFD700','#2ED573','#1E90FF','#A855F7','#FF4FA3','#FFFFFF'];
  for (let i = 0; i < 70; i++) {
    setTimeout(() => {
      const c = document.createElement('div');
      c.className = 'conf';
      c.style.cssText = `left:${Math.random()*100}vw;top:-10px;width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;background:${colors[Math.floor(Math.random()*colors.length)]};animation-duration:${1.8+Math.random()*1.2}s;animation-delay:${Math.random()*0.5}s;border-radius:${Math.random()>0.5?'50%':'3px'};`;
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 3500);
    }, i * 20);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BADGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const BADGES = [
  {id:'b0', icon:'üéπ', name:'First Note!',  earned:true},
  {id:'b1', icon:'üèÖ', name:'Song Hero',    earned:false},
  {id:'b2', icon:'‚≠ê', name:'Star Player',  earned:false},
  {id:'b3', icon:'üî•', name:'On Fire!',     earned:false},
  {id:'b4', icon:'üëë', name:'Piano King',   earned:false},
  {id:'b5', icon:'üéµ', name:'2 Songs Done', earned:false},
  {id:'b6', icon:'üá≥üá¨', name:'Naija Maestro',earned:false},
  {id:'b7', icon:'ü¶Å', name:'Lion Heart',   earned:false},
];
let badgeState = [...BADGES];

function buildBadges() {
  const shelf = document.getElementById('badgeShelf');
  shelf.innerHTML = '';
  badgeState.forEach(b => {
    const el = document.createElement('div');
    el.className = 'badge-item' + (b.earned ? ' earned' : ' locked');
    el.id = b.id;
    el.innerHTML = `<span class="bi-icon">${b.icon}${!b.earned?'üîí':''}</span><div class="bi-name">${b.name}</div>`;
    shelf.appendChild(el);
  });
}

function unlockBadge(idx) {
  if (badgeState[idx].earned) return;
  badgeState[idx].earned = true;
  buildBadges();
  confetti();
  showBanner(`üèÖ New Badge: "${badgeState[idx].name}"!`);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TABS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showTab(name, ti) {
  document.querySelectorAll('.sect').forEach(s => s.classList.remove('on'));
  document.querySelectorAll('.tab').forEach((t,i) => { t.classList.remove('on','t0','t1','t2','t3'); });
  document.getElementById('s-'+name).classList.add('on');
  const tabEl = document.querySelectorAll('.tab')[ti];
  tabEl.classList.add('on','t'+ti);
  if (name==='badges') buildBadges();
  if (name==='lessons') initLessonsSection();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GAME OVERLAY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openGame(name) {
  document.querySelectorAll('.game-overlay').forEach(o => o.classList.remove('on'));
  document.getElementById('g-'+name).classList.add('on');
  if (name==='colour')   initColourMatch();
  if (name==='echo')     initEcho();
  if (name==='highlow')  initHighLow();
  if (name==='nametune') initNameTune();
}
function closeGame() {
  document.querySelectorAll('.game-overlay').forEach(o => o.classList.remove('on'));
  if (nttPlayTimer) clearTimeout(nttPlayTimer);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üéµ NAME THAT TUNE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
/* NTT_SONGS mirrors the main SONGS array but only needs name/emoji/bpm/beats */
const NTT_SONGS = [
  { name:'üêë Baa Baa Black Sheep', emoji:'üêë', bpm:112,
    beats:[{n:'C4',d:1},{n:'C4',d:1},{n:'G4',d:1},{n:'G4',d:1},{n:'A4',d:1},{n:'A4',d:1},{n:'G4',d:2},
           {n:'R',d:0.5},{n:'F4',d:1},{n:'F4',d:1},{n:'E4',d:1},{n:'E4',d:1},{n:'D4',d:1},{n:'D4',d:1},{n:'C4',d:2}] },
  { name:'üåü Twinkle Twinkle',     emoji:'‚≠ê', bpm:108,
    beats:[{n:'C4',d:1},{n:'C4',d:1},{n:'G4',d:1},{n:'G4',d:1},{n:'A4',d:1},{n:'A4',d:1},{n:'G4',d:2},
           {n:'R',d:0.5},{n:'F4',d:1},{n:'F4',d:1},{n:'E4',d:1},{n:'E4',d:1},{n:'D4',d:1},{n:'D4',d:1},{n:'C4',d:2}] },
  { name:'üá≥üá¨ I Just Want to Say',  emoji:'üá≥üá¨', bpm:80,
    beats:[
      {n:'E4',d:1},{n:'D4',d:1},{n:'C4',d:1},{n:'B3',d:1},{n:'A3',d:2},{n:'R',d:2},
      {n:'C4',d:1},{n:'E4',d:1},{n:'D4',d:2},{n:'R',d:2},
      {n:'C4',d:1},{n:'E4',d:2},{n:'R',d:1},
      {n:'D4',d:0.5},{n:'E4',d:0.5},{n:'D4',d:0.5},{n:'C4',d:2}] },
  { name:'üôè Amazing Grace',        emoji:'üôè', bpm:72,
    beats:[
      {n:'C4',d:1},{n:'F4',d:2},{n:'A4',d:1},{n:'A4',d:2},
      {n:'G4',d:1},{n:'F4',d:2},{n:'E4',d:1},{n:'C4',d:2},{n:'R',d:0.5},
      {n:'C4',d:1},{n:'F4',d:2},{n:'A4',d:1},{n:'A4',d:2},
      {n:'G4',d:1},{n:'C5',d:3}] },
  { name:'üö£ Row Your Boat',        emoji:'üö£', bpm:100,
    beats:[
      {n:'C4',d:1},{n:'C4',d:1},{n:'C4',d:0.75},{n:'D4',d:0.25},{n:'E4',d:2},{n:'R',d:0.5},
      {n:'E4',d:0.75},{n:'D4',d:0.25},{n:'E4',d:0.75},{n:'F4',d:0.25},{n:'G4',d:2},{n:'R',d:0.5},
      {n:'C5',d:0.5},{n:'C5',d:0.5},{n:'C5',d:0.5},
      {n:'G4',d:0.5},{n:'G4',d:0.5},{n:'G4',d:0.5},
      {n:'E4',d:0.5},{n:'E4',d:0.5},{n:'E4',d:0.5},
      {n:'C4',d:0.5},{n:'C4',d:0.5},{n:'C4',d:0.5}] },
];

let nttRound=0, nttScore=0, nttCurrent=null, nttCluesUsed=0, nttAnswered=false;
let nttPlayTimer=null;

function initNameTune() {
  nttRound=0; nttScore=0;
  document.getElementById('nttScore').textContent=0;
  document.getElementById('nttRound').textContent=1;
  document.getElementById('nttFeedback').textContent='';
  document.getElementById('nttNextBtn').style.display='none';
  nttNextRound();
}

function nttNextRound() {
  nttRound++;
  if (nttRound > 5) { nttFinish(); return; }
  nttAnswered = false;
  nttCluesUsed=0; nttAnswered=false;

  // Pick a song + 3 wrong options
  const shuffled = [...NTT_SONGS].sort(()=>Math.random()-0.5);
  nttCurrent = shuffled[0];
  const wrongs = shuffled.slice(1,4);
  const options = [...wrongs, nttCurrent].sort(()=>Math.random()-0.5);

  document.getElementById('nttRound').textContent=nttRound;
  document.getElementById('nttClues').textContent=0;
  document.getElementById('nttStatus').textContent='Press PLAY to hear the clue!';
  document.getElementById('nttVisual').textContent='üéπ';
  document.getElementById('nttFeedback').textContent='';
  document.getElementById('nttNextBtn').style.display='none';

  // Re-enable play buttons
  ['nttBtn3','nttBtn5','nttBtn8'].forEach(id => {
    document.getElementById(id).disabled=false;
    document.getElementById(id).style.opacity='1';
  });

  // Build answer choices
  const grid = document.getElementById('nttChoices');
  grid.innerHTML='';
  options.forEach(song => {
    const btn = document.createElement('button');
    btn.style.cssText=`font-family:'Baloo 2',cursive;font-size:0.95rem;font-weight:800;
      padding:14px 10px;border-radius:16px;border:3px solid rgba(255,255,255,0.1);
      background:var(--panel2);color:white;cursor:pointer;transition:all 0.25s;
      display:flex;align-items:center;gap:8px;justify-content:center;`;
    btn.innerHTML=`<span style="font-size:1.5rem">${song.emoji}</span> ${song.name.replace(/^.\s/,'')}`;
    btn.addEventListener('pointerdown', ()=>nttGuess(song, btn, options, grid));
    btn.addEventListener('mouseenter', ()=>{ if(!nttAnswered) btn.style.transform='scale(1.04)'; });
    btn.addEventListener('mouseleave', ()=>{ btn.style.transform=''; });
    grid.appendChild(btn);
  });
}

function nttPlayClue(count) {
  if (nttAnswered) return;
  if (nttPlayTimer) { clearTimeout(nttPlayTimer); }
  nttCluesUsed = Math.max(nttCluesUsed, count);
  document.getElementById('nttClues').textContent = count;

  // Disable the button used (but leave harder ones available)
  if (count===3) document.getElementById('nttBtn3').disabled=true, document.getElementById('nttBtn3').style.opacity='0.4';
  if (count===5) { ['nttBtn3','nttBtn5'].forEach(id=>{ document.getElementById(id).disabled=true; document.getElementById(id).style.opacity='0.4'; }); }
  if (count===8) { ['nttBtn3','nttBtn5','nttBtn8'].forEach(id=>{ document.getElementById(id).disabled=true; document.getElementById(id).style.opacity='0.4'; }); }

  document.getElementById('nttStatus').textContent='üéµ Listen...';
  document.getElementById('nttVisual').textContent=nttCurrent.emoji;

  // Pull only non-rest beats up to count
  const allBeats = nttCurrent.beats.filter(b => b.n !== 'R');
  const notesToPlay = allBeats.slice(0, count);
  const a = getCtx();
  const secPerBeat = 60 / nttCurrent.bpm;
  let t = a.currentTime + 0.1;
  notesToPlay.forEach(beat => {
    const dur = beat.d * secPerBeat;
    playFreq(FREQS[beat.n], dur * 0.85, t, 0.5);
    t += dur;
  });
  const totalMs = (t - a.currentTime) * 1000;
  nttPlayTimer = setTimeout(() => {
    document.getElementById('nttStatus').textContent='Now pick the song!';
  }, totalMs);
}

function nttGuess(song, btn, options, grid) {
  if (nttAnswered) return;
  nttAnswered = true;
  if (nttPlayTimer) clearTimeout(nttPlayTimer);

  const correct = song.name === nttCurrent.name;
  const pts = correct ? (nttCluesUsed<=3 ? 30 : nttCluesUsed<=5 ? 20 : 10) : 0;

  // Colour all buttons
  Array.from(grid.children).forEach(b => {
    const bName = b.textContent.trim();
    const isCorrect = bName.includes(nttCurrent.name.replace(/^.\s/,''));
    b.style.border = isCorrect ? '3px solid #2ED573' : '3px solid #FF4757';
    b.style.background = isCorrect ? 'rgba(46,213,115,0.2)' : 'rgba(255,71,87,0.1)';
    b.style.cursor='default';
  });

  const fb = document.getElementById('nttFeedback');
  if (correct) {
    nttScore += pts;
    addScore(pts);
    document.getElementById('nttScore').textContent=nttScore;
    fb.textContent=`‚úÖ Correct! +${pts} pts! ${['Amazing!','E go better!','You too sharp!','Superstar!'][Math.floor(Math.random()*4)]}`;
    fb.style.color='#2ED573';
    if (nttRound===5) unlockBadge(1);
    confetti();
  } else {
    fb.textContent=`‚ùå It was ${nttCurrent.name}! Better luck next time!`;
    fb.style.color='#FF4757';
  }
  fb.style.animation='none'; fb.offsetWidth; fb.style.animation='fbPop 0.4s ease';

  document.getElementById('nttVisual').textContent=nttCurrent.emoji;
  document.getElementById('nttStatus').textContent= nttRound<5 ? `Round ${nttRound}/5 done!` : 'Last round!';

  setTimeout(()=>{
    document.getElementById('nttNextBtn').style.display = nttRound<5 ? 'inline-block' : 'none';
    if (nttRound>=5) nttFinish();
  }, 1200);
}

function nttFinish() {
  document.getElementById('nttStatus').textContent=`üéâ Game Over! Final score: ${nttScore}`;
  document.getElementById('nttVisual').textContent='üèÜ';
  document.getElementById('nttChoices').innerHTML='';
  showBanner(`üéµ Name That Tune done! You scored ${nttScore} pts!`, 4000);
  confetti();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üåà COLOUR MATCH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CM_NOTES = [
  {note:'C4', color:'#FF4757', emoji:'‚ù§Ô∏è', name:'Red = C'},
  {note:'D4', color:'#FF8C00', emoji:'üß°', name:'Orange = D'},
  {note:'E4', color:'#FFD700', emoji:'üíõ', name:'Yellow = E'},
  {note:'F4', color:'#2ED573', emoji:'üíö', name:'Green = F'},
  {note:'G4', color:'#1E90FF', emoji:'üíô', name:'Blue = G'},
  {note:'A4', color:'#A855F7', emoji:'üíú', name:'Purple = A'},
  {note:'B4', color:'#FF4FA3', emoji:'ü©∑', name:'Pink = B'},
];
let cmCurrent=null, cmScore=0, cmStreak=0;

function initColourMatch() {
  cmScore=0; cmStreak=0;
  document.getElementById('cmScore').textContent = 'Score: 0 | Streak: 0';
  document.getElementById('cmFb').textContent = '';

  // Build mini piano keys
  const row = document.getElementById('cmKeys');
  row.innerHTML='';
  CM_NOTES.forEach(def => {
    const k = document.createElement('div');
    k.className = 'ck-w';
    k.dataset.note = def.note;
    k.style.background = `linear-gradient(180deg, #FEFEFE 0%, #EDE5D5 55%, #DDD0B8 100%)`;
    k.textContent = def.note[0];
    k.addEventListener('pointerdown', e => { e.preventDefault(); cmGuess(def); });
    row.appendChild(k);
  });

  nextColour();
}

function nextColour() {
  cmCurrent = CM_NOTES[Math.floor(Math.random() * CM_NOTES.length)];
  const card = document.getElementById('cmCard');
  card.style.background = cmCurrent.color;
  card.textContent = cmCurrent.emoji;
  card.style.animation = 'none'; card.offsetWidth;
  card.style.animation = 'cardPop 0.4s cubic-bezier(0.175,0.885,0.32,1.275)';
  document.getElementById('cmPrompt').textContent = `Tap the key for this colour! (${cmCurrent.name})`;
}

function cmGuess(def) {
  if (!cmCurrent) return;
  playNote(def.note, 0.7);
  const fb = document.getElementById('cmFb');
  const kEl = document.querySelector(`#cmKeys [data-note="${def.note}"]`);
  if (def.note === cmCurrent.note) {
    cmScore += 10 + cmStreak*2;
    cmStreak++;
    fb.textContent = '‚úÖ Correct! ' + ['Well done!','Amazing!','Superstar!','E go better!','Oya!'][Math.min(cmStreak-1,4)];
    fb.style.animation='none'; fb.offsetWidth; fb.style.animation='fbPop 0.4s ease';
    if (kEl) { kEl.style.background = cmCurrent.color; setTimeout(()=> kEl.style.background='', 400); }
    addScore(10);
    if (cmStreak===5) unlockBadge(7);
    setTimeout(nextColour, 700);
  } else {
    cmStreak = 0;
    fb.textContent = '‚ùå Try again! Look at the colour!';
    fb.style.animation='none'; fb.offsetWidth; fb.style.animation='fbPop 0.4s ease';
  }
  document.getElementById('cmScore').textContent = `Score: ${cmScore} | Streak: ${cmStreak}`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üé§ ECHO ECHO ‚Äî 3 MODES
   EASY   : notes play + dots show + coloured labelled pads
   MEDIUM : notes play only (no dot flash, no labels on pads ‚Äî just colours)
   HARD   : notes play once (no dots, no pads) ‚Äî full unlabelled piano to respond on
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ECHO_NOTES  = ['C4','D4','E4','F4','G4','A4','B4'];
const ECHO_COLORS = ['#FF4757','#FFA502','#FFD700','#2ED573','#1E90FF','#A855F7','#FF4FA3'];

// Hard-mode piano layout (white + black keys, no labels)
const HARD_WHITE = ['C4','D4','E4','F4','G4','A4','B4','C5'];
const HARD_BLACK = [
  {note:'Cs4', left:34}, {note:'Ds4', left:90},
  {note:'Fs4', left:202},{note:'Gs4', left:258},{note:'As4', left:314}
];

let echoSeq=[], echoInput=[], echoLevel=1, echoScore=0;
let echoPlaying=false, echoMode='easy';

/* ‚îÄ‚îÄ Open game ‚Üí show mode menu ‚îÄ‚îÄ */
function initEcho() {
  resetEchoToMenu();
}

function resetEchoToMenu() {
  echoSeq=[]; echoInput=[]; echoLevel=1; echoScore=0; echoPlaying=false;
  document.getElementById('echoModeScreen').style.display='block';
  document.getElementById('echoGameArena').style.display='none';
}

/* ‚îÄ‚îÄ Player picks mode ‚îÄ‚îÄ */
function startEchoMode(mode) {
  echoMode = mode;
  echoSeq=[]; echoInput=[]; echoLevel=1; echoScore=0; echoPlaying=false;

  // Show arena, hide menu
  document.getElementById('echoModeScreen').style.display='none';
  document.getElementById('echoGameArena').style.display='block';

  // Mode badge
  const badge = document.getElementById('echoModeBadge');
  badge.className = 'echo-mode-badge badge-' + mode;
  badge.textContent = mode==='easy' ? '‚≠ê EASY' : mode==='medium' ? 'üî• MEDIUM' : 'üíÄ HARD';

  // Update stats display
  document.getElementById('echoLevel').textContent = 1;
  document.getElementById('echoScore').textContent = 0;

  // Show correct input section
  document.getElementById('echoKeysEasy').style.display   = mode==='easy'   ? 'flex' : 'none';
  document.getElementById('echoKeysMedium').style.display = mode==='medium' ? 'flex' : 'none';
  document.getElementById('echoKeysHard').style.display   = mode==='hard'   ? 'flex' : 'none';

  // Replay button: available in medium & hard
  document.getElementById('echoReplayBtn').style.display = (mode==='medium'||mode==='hard') ? 'inline-block' : 'none';

  // Build inputs
  if (mode==='easy')   buildEasyPads();
  if (mode==='medium') buildMediumPads();
  if (mode==='hard')   buildHardPiano();

  // Kick off first round
  echoNextRound();
}

/* ‚îÄ‚îÄ Build easy pads (coloured squares with note letter) ‚îÄ‚îÄ */
function buildEasyPads() {
  const row = document.getElementById('echoKeysEasy');
  row.innerHTML='';
  ECHO_NOTES.forEach((note,i) => {
    const k = document.createElement('button');
    k.className='ek'; k.dataset.note=note;
    k.textContent=note[0];
    k.style.background=ECHO_COLORS[i]; k.style.color='white';
    k.addEventListener('pointerdown', e => { e.preventDefault(); if(!echoPlaying) echoTap(note,k); });
    row.appendChild(k);
  });
}

/* ‚îÄ‚îÄ Build medium pads (colour circles, no letter) ‚îÄ‚îÄ */
function buildMediumPads() {
  const row = document.getElementById('echoKeysMedium');
  row.innerHTML='';
  ECHO_NOTES.forEach((note,i) => {
    const k = document.createElement('button');
    k.className='ek-med'; k.dataset.note=note;
    k.style.background=ECHO_COLORS[i];
    k.addEventListener('pointerdown', e => { e.preventDefault(); if(!echoPlaying) echoTap(note,k); });
    row.appendChild(k);
  });
}

/* ‚îÄ‚îÄ Build hard piano (white + black keys, zero labels) ‚îÄ‚îÄ */
function buildHardPiano() {
  const row = document.getElementById('echoHardRow');
  row.innerHTML='';
  const whiteEls = [];

  HARD_WHITE.forEach((note,i) => {
    const k = document.createElement('div');
    k.className='hk-w'; k.dataset.note=note;
    k.addEventListener('pointerdown', e => { e.preventDefault(); if(!echoPlaying) hardKeyTap(k, note); });
    row.appendChild(k);
    whiteEls.push(k);
  });

  HARD_BLACK.forEach(def => {
    const b = document.createElement('div');
    b.className='hk-b'; b.dataset.note=def.note;
    b.style.left=def.left+'px';
    b.addEventListener('pointerdown', e => { e.preventDefault(); if(!echoPlaying) hardKeyTap(b, def.note); });
    row.appendChild(b);
  });
}

function hardKeyTap(el, note) {
  el.classList.add('hlit');
  setTimeout(()=>el.classList.remove('hlit'),220);
  echoTap(note, el);
}

/* ‚îÄ‚îÄ Add next note and play sequence ‚îÄ‚îÄ */
function echoNextRound() {
  echoSeq.push(ECHO_NOTES[Math.floor(Math.random()*ECHO_NOTES.length)]);
  echoInput=[];
  setTimeout(()=>playEchoSequence(), 600);
}

/* ‚îÄ‚îÄ Play the sequence ‚îÄ‚îÄ */
function replayEchoSequence() {
  if (echoPlaying) return;
  echoInput = [];
  playEchoSequence();
}

function playEchoSequence() {
  echoPlaying=true;

  const showDots  = echoMode==='easy';
  const flashPads = echoMode==='easy';
  const statusMsg = echoMode==='easy' ? 'üëÄ Watch & listen!' : echoMode==='medium' ? 'üéµ Listen carefully!' : 'üëÇ Listen VERY carefully!';
  document.getElementById('echoStatus').textContent=statusMsg;

  // Clear or show dots
  if (showDots) renderEchoDots(null);
  else document.getElementById('echoSeq').innerHTML='';

  let i=0;
  const speed = echoMode==='hard' ? 850 : 700;
  const iv = setInterval(()=>{
    if (i>=echoSeq.length) {
      clearInterval(iv);
      setTimeout(()=>{
        echoPlaying=false;
        document.getElementById('echoStatus').textContent='üéπ Now YOU repeat it!';
        if (showDots) renderEchoDots(null); // reset dots (no active highlight)
      }, 500);
      return;
    }
    const note=echoSeq[i];
    const ni=ECHO_NOTES.indexOf(note);

    // Always play audio
    playNote(note, 0.55);

    // Easy only: flash dots + pads
    if (showDots) renderEchoDots(i);
    if (flashPads) {
      const kEl = document.querySelector(`#echoKeysEasy [data-note="${note}"]`);
      if (kEl) { kEl.style.opacity='0.35'; setTimeout(()=>kEl.style.opacity='1',380); }
    }

    i++;
  }, speed);
}

/* ‚îÄ‚îÄ Render coloured dots row (Easy only) ‚îÄ‚îÄ */
function renderEchoDots(activeIdx) {
  const row = document.getElementById('echoSeq');
  row.innerHTML='';
  echoSeq.forEach((n,i)=>{
    const ni=ECHO_NOTES.indexOf(n);
    const d=document.createElement('div');
    d.className='echo-note-dot'+(i===activeIdx?' flash':'');
    d.style.background=ECHO_COLORS[ni];
    d.textContent=n[0];
    row.appendChild(d);
  });
}

/* ‚îÄ‚îÄ Player taps a pad / key ‚îÄ‚îÄ */
function echoTap(note, el) {
  playNote(note, 0.65);

  // Visual feedback on pad
  if (el) {
    const orig = el.style.opacity||'1';
    el.style.opacity='0.35';
    setTimeout(()=>el.style.opacity=orig,200);
  }

  const expected = echoSeq[echoInput.length];
  if (note===expected) {
    echoInput.push(note);
    // Correct so far ‚Äî if sequence complete
    if (echoInput.length===echoSeq.length) {
      echoScore += echoLevel * (echoMode==='easy'?20 : echoMode==='medium'?35 : 55);
      echoLevel++;
      addScore(echoMode==='easy'?15 : echoMode==='medium'?25 : 40);
      document.getElementById('echoScore').textContent=echoScore;
      document.getElementById('echoLevel').textContent=echoLevel;
      document.getElementById('echoStatus').textContent='‚úÖ Correct! Well done! üéâ';
      if (echoLevel>3) unlockBadge(3);
      if (echoLevel>5 && echoMode==='hard') unlockBadge(4);
      echoInput=[];
      setTimeout(echoNextRound, 1000);
    }
  } else {
    // Wrong
    document.getElementById('echoStatus').textContent='‚ùå Wrong! Listen again...';
    echoInput=[];
    setTimeout(()=>playEchoSequence(), 1100);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚¨ÜÔ∏è‚¨áÔ∏è HIGH LOW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const HL_HIGH = ['C5','D5','E5','G5'];
const HL_LOW  = ['C3','D3','E3','G3'];
const HL_ALL  = [...HL_HIGH, ...HL_LOW];
let hlCurrent=null, hlScore=0, hlStreak=0, hlActive=false;

function initHighLow() {
  hlScore=0; hlStreak=0; hlActive=false;
  document.getElementById('hlScore').textContent='Score: 0 | Streak: 0';
  document.getElementById('hlFb').textContent='';
  document.getElementById('hlEmoji').textContent='üéµ';
  document.getElementById('hlStartBtn').style.display='block';

  // mini keys for visual
  const row = document.getElementById('hlKeys');
  row.innerHTML='';
  ['C4','D4','E4','F4','G4','A4','B4'].forEach((n,i) => {
    const k = document.createElement('div');
    k.style.cssText=`width:34px;height:80px;background:linear-gradient(180deg,#FEFEFE,#DDD0B8);border:1px solid #C8BFAA;border-radius:0 0 7px 7px;box-shadow:0 5px 0 #B0A090;`;
    row.appendChild(k);
  });
}

function hlStart() {
  document.getElementById('hlStartBtn').style.display='none';
  hlActive = true;
  nextHL();
}

function nextHL() {
  hlCurrent = HL_ALL[Math.floor(Math.random()*HL_ALL.length)];
  const isHigh = HL_HIGH.includes(hlCurrent);
  document.getElementById('hlEmoji').textContent = isHigh ? 'üéµ' : 'üé∂';
  document.getElementById('hlEmoji').style.animation='none';
  document.getElementById('hlEmoji').offsetWidth;
  document.getElementById('hlEmoji').style.animation='hlFloat 1s ease-in-out infinite alternate';
  document.getElementById('hlEmoji').style.fontSize = isHigh ? '3rem' : '6rem';
  setTimeout(() => playNote(hlCurrent, 1.0), 200);
}

function hlGuess(guess) {
  if (!hlActive || !hlCurrent) return;
  const correct = HL_HIGH.includes(hlCurrent) ? 'high' : 'low';
  const fb = document.getElementById('hlFb');
  if (guess===correct) {
    hlScore += 10 + hlStreak*3;
    hlStreak++;
    addScore(10);
    fb.textContent = ['‚úÖ Correct! üéâ','‚úÖ Amazing! ‚≠ê','‚úÖ You are too sharp! üî•'][Math.min(hlStreak-1,2)];
    fb.style.color=correct==='high'?'#FF4757':'#1E90FF';
    if (hlStreak>=5) unlockBadge(2);
  } else {
    hlStreak=0;
    fb.textContent = `‚ùå It was ${correct.toUpperCase()}! Listen again!`;
    fb.style.color='#888';
  }
  fb.style.animation='none'; fb.offsetWidth; fb.style.animation='fbPop 0.4s ease';
  document.getElementById('hlScore').textContent=`Score: ${hlScore} | Streak: ${hlStreak}`;
  setTimeout(nextHL, 1000);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üìö WEEKLY LESSON CURRICULUM
   January Week 2 ‚Üí December Week 3
   Three age tracks: 3-5 ¬∑ 5-8 ¬∑ 8-10
   Each LEVEL = a Month ¬∑ Each LESSON = a Week
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ SHARED Level 1 ¬∑ January Week 2‚Äì4 ‚îÄ‚îÄ */
const LEVEL1_SHARED = {
  id:'l1', title:'üóìÔ∏è January ‚Äî Hello Piano! (Wk 2‚Äì4)', emoji:'üëã', age:'All Ages',
  color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FF6B81)',
  lessons:[
    {
      id:'l1_w2', title:'Week 2 ¬∑ Meet the Piano', sub:'What is a piano? Let\'s explore!', emoji:'üéπ',
      steps:[
        { type:'explain', heading:'Welcome to the Piano! üéπ',
          body:`A piano is a beautiful instrument with <strong>black and white keys</strong>. When you press a key, a little hammer inside hits a string and makes a sound!<br><br>The piano can make <strong>many different sounds</strong> ‚Äî from very LOW (like a lion roaring ü¶Å) to very HIGH (like a bird singing üê¶).<br><br>Today we begin our piano journey together! üá≥üá¨üéµ`,
          visual:'üéπ' },
        { type:'explain', heading:'High Notes & Low Notes',
          body:`The keys on the <strong>LEFT side</strong> make LOW sounds ‚Äî like a big elephant üêò.<br><br>The keys on the <strong>RIGHT side</strong> make HIGH sounds ‚Äî like a little bird üê¶.<br><br>The more you go <strong>right ‚Üí the higher the sound!</strong>`,
          visual:'‚¨ÖÔ∏èüêò üê¶‚û°Ô∏è' },
        { type:'try', heading:'Try It! Press Some Keys!',
          body:`Press the keys below! Try the ones on the far <strong>LEFT</strong> ‚Äî can you hear how LOW they sound? Now try the far <strong>RIGHT</strong> ‚Äî hear how HIGH they are! üéâ`,
          interactive:'piano_explore' },
        { type:'quiz', heading:'Quick Quiz! üåü',
          body:'Which side of the piano makes LOW sounds?',
          opts:['Left side ‚¨ÖÔ∏è üéØ','Right side ‚û°Ô∏è','The middle','Both sides!'],
          answer:0 }
      ]
    },
    {
      id:'l1_w3', title:'Week 3 ¬∑ Finger Numbers', sub:'Number your fingers 1‚Äì5!', emoji:'‚úã',
      steps:[
        { type:'explain', heading:'Your Fingers Have Numbers! ‚úã',
          body:`Every finger on your hand has a special number. This helps us know <strong>which finger to use</strong> when playing piano!<br><br>Hold up your <strong>right hand</strong> üñêÔ∏è:<br>üî¥ Thumb = <strong>1</strong><br>üü† Index finger = <strong>2</strong><br>üü° Middle finger = <strong>3</strong><br>üü¢ Ring finger = <strong>4</strong><br>üîµ Pinky = <strong>5</strong>`,
          visual:'‚úã', interactive:'finger_diagram' },
        { type:'explain', heading:'Left Hand Too! ü§ö',
          body:`Your <strong>left hand</strong> fingers have the same numbers! Thumb is finger <strong>1</strong> and pinky is finger <strong>5</strong>.<br><br>Tap each finger on the table as you count: <strong>1, 2, 3, 4, 5!</strong>`,
          visual:'ü§ö' },
        { type:'try', heading:'Tap Your Fingers!',
          body:`When you see a number, tap that finger on your knee:<br><br><strong>Thumb=1 ¬∑ Index=2 ¬∑ Middle=3 ¬∑ Ring=4 ¬∑ Pinky=5</strong>`,
          interactive:'finger_quiz' },
        { type:'quiz', heading:'Which finger is number 3? üåü',
          body:'Look at your right hand. Finger number 3 is the...',
          opts:['Thumb','Index finger','Middle finger üñï üéØ','Pinky'],
          answer:2 }
      ]
    },
    {
      id:'l1_w4', title:'Week 4 ¬∑ Sitting & Hand Shape', sub:'Sit up straight & curve those fingers!', emoji:'ü™ë',
      steps:[
        { type:'explain', heading:'Sit Like a Piano Champion! ü™ë',
          body:`Good posture makes playing easy and comfortable!<br><br>‚úÖ <strong>Sit up straight</strong> ‚Äî back nice and tall<br>‚úÖ <strong>Feet flat</strong> on the floor<br>‚úÖ <strong>Elbows level</strong> with the keys<br>‚úÖ <strong>Relax your shoulders</strong> ‚Äî no tension!`,
          visual:'ü™ë' },
        { type:'explain', heading:'The Curved Hand Shape üçä',
          body:`Imagine you\'re <strong>holding a big orange</strong> üçä in your hand. Your fingers naturally curve ‚Äî that\'s the perfect piano hand shape!<br><br>Press the keys with the <strong>tips of your fingers</strong>, not the flat part. This gives you control and avoids injury!`,
          visual:'üçä' },
        { type:'try', heading:'Practice Position on the Piano!',
          body:`Place your <strong>right hand</strong> on the piano with curved fingers. Press <strong>finger 3 (middle finger)</strong> on the E key. Keep it curved like holding an orange! üçä`,
          interactive:'hand_position' },
        { type:'quiz', heading:'What shape should your hand be? üåü',
          body:'When playing piano, your hand should look like you are...',
          opts:['Holding an orange üçä üéØ','Flat like a pancake ü•û','Making a fist ‚úä','Pointing one finger ‚òùÔ∏è'],
          answer:0 }
      ]
    }
  ]
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AGES 3‚Äì5 FULL YEAR CURRICULUM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CURRICULUM_3_5 = [
  LEVEL1_SHARED,
  {
    id:'feb_35', title:'üóìÔ∏è February ‚Äî Colours & First Notes', emoji:'üåà', age:'Ages 3‚Äì5',
    color:'#FFA502', grad:'linear-gradient(135deg,#FFA502,#FFD700)',
    lessons:[
      {
        id:'feb_w1_35', title:'Week 1 ¬∑ Note Colours', sub:'Each note has a rainbow colour!', emoji:'üé®',
        steps:[
          { type:'explain', heading:'Every Note Has a Colour! üåà',
            body:`Let\'s make piano notes easy to remember with colours!<br><br>‚ù§Ô∏è <strong>C = Red</strong><br>üß° <strong>D = Orange</strong><br>üíõ <strong>E = Yellow</strong><br>üíö <strong>F = Green</strong><br>üíô <strong>G = Blue</strong><br>üíú <strong>A = Purple</strong><br>ü©∑ <strong>B = Pink</strong><br><br>Point to each colour on the piano and say the name!`,
            visual:'üåà' },
          { type:'try', heading:'Press the Red Key!',
            body:`Can you find the <strong>RED key</strong>? That\'s C! Press it and hear the sound. Now try the <strong>ORANGE key</strong> ‚Äî that\'s D! And the <strong>YELLOW key</strong> ‚Äî that\'s E!`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'What colour is C? üåü',
            body:'What colour do we use for the note C?',
            opts:['üíô Blue','‚ù§Ô∏è Red üéØ','üíõ Yellow','üíö Green'],
            answer:1 }
        ]
      },
      {
        id:'feb_w2_35', title:'Week 2 ¬∑ C D E ‚Äî My First Notes!', sub:'Press your first 3 notes!', emoji:'üéπ',
        steps:[
          { type:'explain', heading:'Meet C, D and E! üéπ',
            body:`These are your <strong>first three notes</strong>! They sit right next to each other on the piano.<br><br>‚ù§Ô∏è <strong>C</strong> ‚Äî sounds like "Doh"<br>üß° <strong>D</strong> ‚Äî sounds like "Re"<br>üíõ <strong>E</strong> ‚Äî sounds like "Mi"<br><br>Can you sing Doh Re Mi? That\'s C D E!`,
            visual:'üéµ' },
          { type:'try', heading:'Play C D E!',
            body:`Press <strong>C</strong> (red), then <strong>D</strong> (orange), then <strong>E</strong> (yellow)! Go slowly ‚Äî use finger 1, 2, 3!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'Which comes after C? üåü',
            body:'In the musical alphabet, which note comes after C?',
            opts:['E','B','D üéØ','F'],
            answer:2 }
        ]
      },
      {
        id:'feb_w3_35', title:'Week 3 ¬∑ Sing & Play!', sub:'Sing Doh Re Mi while you play!', emoji:'üé§',
        steps:[
          { type:'explain', heading:'Sing Along! üé§',
            body:`Now let\'s <strong>sing</strong> the note names while we press them!<br><br>Press <strong>C</strong> and sing <em>"Doh!"</em><br>Press <strong>D</strong> and sing <em>"Re!"</em><br>Press <strong>E</strong> and sing <em>"Mi!"</em><br><br>Singing while playing helps your brain remember the notes much faster! üß†`,
            visual:'üé§' },
          { type:'try', heading:'Sing & Play Together!',
            body:`Press each key and <strong>sing its name out loud</strong>! C = Doh, D = Re, E = Mi. Try going up: Doh Re Mi... then back down: Mi Re Doh!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'What do we sing for D? üåü',
            body:'When we press the D key, what do we sing?',
            opts:['Doh','Mi','Fa','Re üéØ'],
            answer:3 }
        ]
      },
      {
        id:'feb_w4_35', title:'Week 4 ¬∑ Black Keys Discovery', sub:'The black keys are sharps!', emoji:'‚¨õ',
        steps:[
          { type:'explain', heading:'The Black Keys! ‚¨õ',
            body:`Did you notice the <strong>black keys</strong> on the piano? They make sounds too!<br><br>They come in groups of <strong>2 black keys</strong> and <strong>3 black keys</strong>.<br><br>The black keys help us find the white keys. Look for the group of <strong>2 black keys</strong> ‚Äî the white key just to their LEFT is always <strong>C</strong>!`,
            visual:'‚¨õ‚¨õ' },
          { type:'try', heading:'Find All the C Notes!',
            body:`Look for the group of <strong>2 black keys</strong> on your piano. The white key to the LEFT of them is always C.<br><br>Press every C note you can find! They all sound the same but higher or lower.`,
            interactive:'find_cde' },
          { type:'quiz', heading:'Where is the C note? üåü',
            body:'C is always found to the LEFT of which black key group?',
            opts:['3 black keys','2 black keys üéØ','All black keys','No black keys'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'mar_35', title:'üóìÔ∏è March ‚Äî My First Songs!', emoji:'üéµ', age:'Ages 3‚Äì5',
    color:'#2ED573', grad:'linear-gradient(135deg,#2ED573,#00C853)',
    lessons:[
      {
        id:'mar_w1_35', title:'Week 1 ¬∑ Hot Cross Buns', sub:'3 notes ‚Äî your very first song!', emoji:'üçû',
        steps:[
          { type:'explain', heading:'Hot Cross Buns ‚Äî 3 Notes Only! üçû',
            body:`Your first real song uses only <strong>3 notes: E, D, C</strong>!<br><br>üéµ <strong>E D C</strong> ‚Äî "Hot cross buns"<br>üéµ <strong>E D C</strong> ‚Äî "Hot cross buns"<br>üéµ <strong>C C C C D D D D</strong> ‚Äî "One a penny, two a penny"<br>üéµ <strong>E D C</strong> ‚Äî "Hot cross buns"<br><br>That\'s a full song with only 3 notes! üåü`,
            visual:'üçû' },
          { type:'try', heading:'Let\'s Play It!',
            body:`Press <strong>E ‚Üí D ‚Üí C</strong>. Go slowly and count as you play. That\'s it ‚Äî you\'re playing a real song! üéâ`,
            interactive:'song_mary' },
          { type:'quiz', heading:'How many notes does Hot Cross Buns use? üåü',
            body:'Hot Cross Buns is special because it only uses...',
            opts:['5 notes','7 notes','3 notes üéØ','1 note'],
            answer:2 }
        ]
      },
      {
        id:'mar_w2_35', title:'Week 2 ¬∑ Twinkle Twinkle!', sub:'Everyone\'s favourite song!', emoji:'‚≠ê',
        steps:[
          { type:'explain', heading:'Twinkle Twinkle Little Star ‚≠ê',
            body:`You know this song already! Now let\'s play it on the piano.<br><br>üéµ <strong>C C G G A A G</strong> ‚Äî "Twinkle twinkle little star"<br>üéµ <strong>F F E E D D C</strong> ‚Äî "How I wonder what you are"<br><br>Let\'s try it slowly together!`,
            visual:'‚≠ê' },
          { type:'try', heading:'Follow the Lights!',
            body:`Press the keys ‚Äî start with <strong>C</strong> and sing: "Twin-kle twin-kle lit-tle star" as you play C C G G A A G. You can do it! üåü`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'What is the first note? üåü',
            body:'Twinkle Twinkle Little Star starts on which note?',
            opts:['G','A','E','C üéØ'],
            answer:3 }
        ]
      },
      {
        id:'mar_w3_35', title:'Week 3 ¬∑ Baa Baa Black Sheep', sub:'Same tune as Twinkle Twinkle!', emoji:'üêè',
        steps:[
          { type:'explain', heading:'Same Tune ‚Äî Different Words! üêè',
            body:`Did you know Baa Baa Black Sheep uses the <strong>exact same notes</strong> as Twinkle Twinkle? üòÆ<br><br>üéµ <strong>C C G G A A G</strong> ‚Äî "Baa baa black sheep, have you any wool?"<br><br>If you can play Twinkle Twinkle, you can already play this! Amazing right? üéâ`,
            visual:'üêè' },
          { type:'try', heading:'Sing & Play Baa Baa!',
            body:`Press the keys and <strong>sing the words</strong> at the same time! "Baa baa black sheep, have you any wool?" Start on C and go! üêë`,
            interactive:'song_baa' },
          { type:'quiz', heading:'Same tune as which song? üåü',
            body:'Baa Baa Black Sheep uses the same melody as...',
            opts:['Row Your Boat','Happy Birthday','Twinkle Twinkle üéØ','Amazing Grace'],
            answer:2 }
        ]
      },
      {
        id:'mar_w4_35', title:'Week 4 ¬∑ Mary Had a Little Lamb', sub:'Play with 3 fingers!', emoji:'üêë',
        steps:[
          { type:'explain', heading:'Mary Had a Little Lamb üêë',
            body:`This lovely song uses notes <strong>E, D, C, G</strong>!<br><br>üéµ <strong>E D C D E E E</strong> ‚Äî "Mary had a little lamb"<br>üéµ <strong>D D D</strong> ‚Äî "little lamb"<br>üéµ <strong>E G G</strong> ‚Äî "little lamb"<br>üéµ <strong>E D C D E E E E D D E D C</strong> ‚Äî final verse<br><br>Use fingers 3, 2, 1 for E, D, C!`,
            visual:'üêë' },
          { type:'try', heading:'Play Mary Had a Little Lamb!',
            body:`Start on <strong>E</strong> with finger 3. Then D with finger 2, C with finger 1. Try slowly and sing along! "Ma-ry had a lit-tle lamb..."`,
            interactive:'song_mary' },
          { type:'quiz', heading:'Which finger plays E? üåü',
            body:'If your thumb (finger 1) is on C, which finger plays E?',
            opts:['Finger 1','Finger 2','Finger 3 üéØ','Finger 4'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'apr_35', title:'üóìÔ∏è April ‚Äî Rhythm & More Songs', emoji:'ü•Å', age:'Ages 3‚Äì5',
    color:'#1E90FF', grad:'linear-gradient(135deg,#1E90FF,#A855F7)',
    lessons:[
      {
        id:'apr_w1_35', title:'Week 1 ¬∑ What is Rhythm?', sub:'The heartbeat of music!', emoji:'üíì',
        steps:[
          { type:'explain', heading:'Rhythm ‚Äî The Heartbeat of Music! üíì',
            body:`<strong>Rhythm</strong> is the pattern of long and short sounds in music ‚Äî it\'s what makes you want to clap and dance!<br><br>Put your hand on your heart ‚Äî can you feel it? Bump-BUMP, Bump-BUMP. That steady beat is like a <strong>musical pulse</strong>! üíì<br><br>In music, this steady pulse is called the <strong>beat</strong>.`,
            visual:'üíì' },
          { type:'try', heading:'Clap the Beat!',
            body:`Let\'s clap a steady beat together: 1, 2, 3, 4 ¬∑ 1, 2, 3, 4.<br><br>Now try tapping it on the piano ‚Äî press any key once per beat. Keep it steady! ü•Å`,
            interactive:'beat_tap' },
          { type:'quiz', heading:'What is the steady pulse in music? üåü',
            body:'The steady, regular pulse that runs through all music is called the...',
            opts:['Melody','Lyrics','Beat üéØ','Scale'],
            answer:2 }
        ]
      },
      {
        id:'apr_w2_35', title:'Week 2 ¬∑ Long & Short Sounds', sub:'Some notes are quick, some are slow!', emoji:'‚è±Ô∏è',
        steps:[
          { type:'explain', heading:'Long & Short Sounds! ‚è±Ô∏è',
            body:`Not all notes last the same time!<br><br>üê¢ <strong>Long sounds</strong> ‚Äî hold the key down for 2 counts<br>üêá <strong>Short sounds</strong> ‚Äî press and release quickly (1 count)<br><br>Clap "Hot Cross BUNS" ‚Äî hear how "BUNS" is longer? That\'s a long note! Try it: short-short-LONG!`,
            visual:'üê¢üêá' },
          { type:'try', heading:'Play Long & Short!',
            body:`Try pressing <strong>C</strong> quickly (short), then pressing <strong>C</strong> and holding it (long). Feel the difference? Now play: short C, short D, LONG E!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'Which is a LONG sound? üåü',
            body:'In "Hot Cross Buns", the word BUNS is...',
            opts:['A short quick note','A long held note üéØ','Two notes','Silence'],
            answer:1 }
        ]
      },
      {
        id:'apr_w3_35', title:'Week 3 ¬∑ Meet F, G, A, B!', sub:'Complete the musical alphabet!', emoji:'üî§',
        steps:[
          { type:'explain', heading:'Meet F, G, A, and B! üî§',
            body:`Great job learning C, D, E! Now let\'s meet the rest of the family:<br><br>üíö <strong>F</strong> ‚Äî just LEFT of the 3 black keys<br>üíô <strong>G</strong> ‚Äî next after F<br>üíú <strong>A</strong> ‚Äî next after G<br>ü©∑ <strong>B</strong> ‚Äî next after A<br><br>Then it starts again with <strong>C</strong>! The musical alphabet only goes A to G!`,
            visual:'üéµ' },
          { type:'try', heading:'Play All 7 Notes!',
            body:`Let\'s play all the notes from C to B: <strong>C D E F G A B</strong>. That\'s the full musical alphabet! Sing the letter names as you press each key. üé§`,
            interactive:'all_notes' },
          { type:'quiz', heading:'How many notes are in the musical alphabet? üåü',
            body:'The musical alphabet goes from A to...',
            opts:['A to Z (26 notes)','A to G (7 notes) üéØ','A to C (3 notes)','A to E (5 notes)'],
            answer:1 }
        ]
      },
      {
        id:'apr_w4_35', title:'Week 4 ¬∑ High or Low Game!', sub:'Can you hear the difference?', emoji:'‚¨ÜÔ∏è‚¨áÔ∏è',
        steps:[
          { type:'explain', heading:'High Sounds & Low Sounds ‚¨ÜÔ∏è‚¨áÔ∏è',
            body:`Let\'s play a game with <strong>high and low sounds</strong>!<br><br>When you hear a <strong>HIGH note</strong> ‚Äî stretch your arms UP ‚¨ÜÔ∏è<br>When you hear a <strong>LOW note</strong> ‚Äî crouch DOWN ‚¨áÔ∏è<br><br>Keys on the right of the piano are HIGH.<br>Keys on the left are LOW.`,
            visual:'‚¨ÜÔ∏è‚¨áÔ∏è' },
          { type:'try', heading:'High or Low Game!',
            body:`Press different keys on the piano. For each note, decide: is it HIGH or LOW? Jump up for HIGH, crouch for LOW!<br><br>Try the Echo Echo game in Activities for extra practice! üéÆ`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Is G4 high or low compared to C4? üåü',
            body:'G4 (G in the middle of the piano) compared to C4 is...',
            opts:['Lower','The same','Higher üéØ','Cannot tell'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'may_35', title:'üóìÔ∏è May ‚Äî Songs & Expression', emoji:'üé≠', age:'Ages 3‚Äì5',
    color:'#A855F7', grad:'linear-gradient(135deg,#A855F7,#FF4FA3)',
    lessons:[
      {
        id:'may_w1_35', title:'Week 1 ¬∑ Row, Row, Row Your Boat', sub:'A fun rowing song!', emoji:'üö£',
        steps:[
          { type:'explain', heading:'Row, Row, Row Your Boat! üö£',
            body:`This cheerful song uses notes C, D, E, F, G!<br><br>üéµ <strong>C C C</strong> ‚Äî "Row row row"<br>üéµ <strong>C D E</strong> ‚Äî "your boat"<br>üéµ <strong>E D E F G</strong> ‚Äî "Gently down the stream"<br><br>Imagine you\'re rowing a boat on Lagos lagoon! üåä`,
            visual:'üö£' },
          { type:'try', heading:'Play & Row!',
            body:`Play the notes while you pretend to row a boat! <strong>C C C ‚Äî C D E ‚Äî E D E F G</strong>. Mime rowing as you play! üö£`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Row Your Boat starts on which note? üåü',
            body:'"Row Row Row Your Boat" begins on the note...',
            opts:['G','E','D','C üéØ'],
            answer:3 }
        ]
      },
      {
        id:'may_w2_35', title:'Week 2 ¬∑ Loud & Soft', sub:'Play with feeling!', emoji:'üîä',
        steps:[
          { type:'explain', heading:'Loud & Soft Sounds! üîä',
            body:`Music is not always the same loudness! We can play:<br><br>üîä <strong>LOUD (forte)</strong> ‚Äî press the keys harder, like a storm!<br>ü§´ <strong>Soft (piano)</strong> ‚Äî press the keys gently, like a lullaby<br><br>Playing loud and soft makes music interesting and emotional! üé≠`,
            visual:'üîäü§´' },
          { type:'try', heading:'Play Loud then Soft!',
            body:`Press <strong>C, D, E</strong> as LOUD as you can! Hear the power? üîä<br><br>Now press the same notes very GENTLY. Hear the difference? ü§´<br><br>Try singing: LOUD "DOH RE MI!" then soft "doh re mi..."`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'How do we play softly? üåü',
            body:'To play a note softly (gently) on the piano, you...',
            opts:['Press very hard','Press gently üéØ','Tap with your nail','Use only pinky'],
            answer:1 }
        ]
      },
      {
        id:'may_w3_35', title:'Week 3 ¬∑ Slow & Fast', sub:'Tempo makes music exciting!', emoji:'üê¢üêá',
        steps:[
          { type:'explain', heading:'Slow & Fast ‚Äî Playing with Tempo! üê¢üêá',
            body:`<strong>Tempo</strong> means how fast or slow the music is!<br><br>üê¢ <strong>Slow</strong> ‚Äî like a gentle lullaby for baby<br>üêá <strong>Fast</strong> ‚Äî like Afrobeats music! üéµ<br><br>The same song can feel completely different when played slow or fast!`,
            visual:'üê¢üêá' },
          { type:'try', heading:'Play Twinkle Slow then Fast!',
            body:`Try playing <strong>C C G G A A G</strong> very slowly... now try it fast! In the Piano tab, use the üê¢ Slow button or try ‚ñ∂ Play for normal speed!`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'What is "tempo" in music? üåü',
            body:'In music, "tempo" means...',
            opts:['The key of the song','How loud or soft','How fast or slow üéØ','The note names'],
            answer:2 }
        ]
      },
      {
        id:'may_w4_35', title:'Week 4 ¬∑ My Favourite Song Review', sub:'Practice everything we know!', emoji:'üåü',
        steps:[
          { type:'explain', heading:'You\'ve Learned So Much! üåü',
            body:`Look at how far you\'ve come since January! You can now:<br><br>‚úÖ Name all 7 notes: <strong>C D E F G A B</strong><br>‚úÖ Play 4 songs: Hot Cross Buns, Twinkle, Baa Baa, Mary Had a Little Lamb<br>‚úÖ Use finger numbers<br>‚úÖ Play loud and soft, fast and slow<br><br>You are a real pianist! üéπüèÖ`,
            visual:'üåü' },
          { type:'try', heading:'Play Your Favourite Song!',
            body:`Pick your favourite song from the Piano tab and play it! Try it:<br>1. First time: <strong>slowly</strong><br>2. Second time: <strong>medium speed</strong><br>3. Third time: <strong>loud and proud!</strong> üéâ`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'How many notes are in the musical alphabet? üåü',
            body:'The notes C D E F G A B give us how many different notes?',
            opts:['5 notes','6 notes','7 notes üéØ','8 notes'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'jun_35', title:'üóìÔ∏è June ‚Äî Patterns & Repetition', emoji:'üîÑ', age:'Ages 3‚Äì5',
    color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FFA502)',
    lessons:[
      {
        id:'jun_w1_35', title:'Week 1 ¬∑ Musical Patterns', sub:'Music loves to repeat!', emoji:'üîÑ',
        steps:[
          { type:'explain', heading:'Patterns in Music! üîÑ',
            body:`Music is full of <strong>patterns</strong> ‚Äî groups of notes that repeat. When you recognise a pattern, you can predict what comes next!<br><br>Look at Twinkle: <strong>C C G G A A G</strong> ‚Äî then <strong>F F E E D D C</strong>. Both groups have the same rhythm pattern!`,
            visual:'üîÑ' },
          { type:'try', heading:'Find the Pattern!',
            body:`Play <strong>C D C D C D</strong>... can you feel the pattern? It goes up, down, up, down!<br><br>Now try <strong>C E C E C E</strong> ‚Äî that\'s a skip pattern! Which do you prefer? üéµ`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'What is a pattern in music? üåü',
            body:'A musical pattern is a group of notes that...',
            opts:['Never repeat','Repeat or come back üéØ','Are always loud','Go only upward'],
            answer:1 }
        ]
      },
      {
        id:'jun_w2_35', title:'Week 2 ¬∑ Steps & Skips', sub:'Notes that move by step or jump!', emoji:'ü™ú',
        steps:[
          { type:'explain', heading:'Steps & Skips! ü™ú',
            body:`When notes move on the piano, they can:<br><br>üë£ <strong>Step</strong> ‚Äî move to the very next white key (like walking: C ‚Üí D ‚Üí E)<br>ü¶ò <strong>Skip</strong> ‚Äî jump over one key (like jumping: C ‚Üí E ‚Üí G)<br><br>Steps sound smooth. Skips sound jumpy and exciting!`,
            visual:'ü™ú' },
          { type:'try', heading:'Walk & Jump on the Piano!',
            body:`Try <strong>stepping</strong>: C D E F G (walk up slowly)<br><br>Now try <strong>skipping</strong>: C E G (jump every other note!)<br><br>Which sounds smoother? Which sounds more exciting?`,
            interactive:'all_notes' },
          { type:'quiz', heading:'C then E is a... üåü',
            body:'Moving from C to E (skipping over D) is called a...',
            opts:['Step','Skip üéØ','Repeat','Rest'],
            answer:1 }
        ]
      },
      {
        id:'jun_w3_35', title:'Week 3 ¬∑ Going Up & Down', sub:'Scales sound like stairs!', emoji:'üìà',
        steps:[
          { type:'explain', heading:'Going Up & Down the Piano! üìà',
            body:`When you play notes from LOW to HIGH in order, that\'s going <strong>UP</strong> ‚Üë<br><br>When you play from HIGH to LOW, that\'s going <strong>DOWN</strong> ‚Üì<br><br>Try playing: <strong>C D E F G</strong> ‚Äî going UP!<br>Now: <strong>G F E D C</strong> ‚Äî coming DOWN!<br><br>It sounds like climbing stairs! ü™ú`,
            visual:'üìà' },
          { type:'try', heading:'Climb the Musical Stairs!',
            body:`Play going UP: <strong>C D E F G A B C</strong><br>Then come DOWN: <strong>C B A G F E D C</strong><br><br>Use finger 1 for C, 2 for D, 3 for E, then move your hand for F, G, A, B!`,
            interactive:'all_notes' },
          { type:'quiz', heading:'Playing C D E F G is going... üåü',
            body:'When you play C D E F G in order from low to high, you are going...',
            opts:['Down ‚Üì','Sideways ‚Üí','Up ‚Üë üéØ','Nowhere'],
            answer:2 }
        ]
      },
      {
        id:'jun_w4_35', title:'Week 4 ¬∑ Naija Song Special!', sub:'Play an Afrobeats style tune!', emoji:'üá≥üá¨',
        steps:[
          { type:'explain', heading:'üá≥üá¨ Naija Music Time!',
            body:`Nigeria has amazing music! From <strong>Afrobeats</strong> to <strong>Highlife</strong>, our music has a special beat and feel.<br><br>Today we\'ll play a simple Naija-style melody using our notes. The key is to feel the <strong>groove</strong> ‚Äî a steady, bouncy rhythm!<br><br>Think of artists like Burna Boy or Fela Kuti ‚Äî they all started with simple notes! üéµüá≥üá¨`,
            visual:'üá≥üá¨' },
          { type:'try', heading:'Play a Naija Groove!',
            body:`Try this funky pattern: <strong>C E G E C E G</strong> ‚Äî keep it steady and bouncy!<br><br>Now add rhythm: hold C for 2 beats, then E D C quickly. Feel the Afrobeats vibe! üé∂`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Naija music is known for its... üåü',
            body:'Nigerian Afrobeats music is famous worldwide for its...',
            opts:['Very slow tempo','Sad melodies only','Rhythmic groove and energy üéØ','No melody'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'sep_35', title:'üóìÔ∏è September ‚Äî Review & New Skills', emoji:'üîô', age:'Ages 3‚Äì5',
    color:'#2ED573', grad:'linear-gradient(135deg,#2ED573,#1E90FF)',
    lessons:[
      {
        id:'sep_w1_35', title:'Week 1 ¬∑ Back to School Review!', sub:'Remember everything from before!', emoji:'üìö',
        steps:[
          { type:'explain', heading:'Welcome Back! Let\'s Review! üìö',
            body:`After the holiday break, let\'s remember what we learned!<br><br>‚úÖ 7 notes: <strong>C D E F G A B</strong><br>‚úÖ C = Red ‚ù§Ô∏è, D = Orange üß°, E = Yellow üíõ<br>‚úÖ Songs: Twinkle, Hot Cross Buns, Baa Baa, Mary<br><br>Let\'s warm up those fingers! ü§∏`,
            visual:'üìö' },
          { type:'try', heading:'Warm-Up: Play All 7 Notes!',
            body:`Start with a warm-up. Play slowly from C to C: <strong>C D E F G A B C</strong>, then come back down. Say the note names as you go! üéµ`,
            interactive:'all_notes' },
          { type:'quiz', heading:'Quick Review! üåü',
            body:'What note comes after G in the musical alphabet?',
            opts:['H','F','A üéØ','B'],
            answer:2 }
        ]
      },
      {
        id:'sep_w2_35', title:'Week 2 ¬∑ Dynamics Review', sub:'Loud, soft, and in between!', emoji:'üîä',
        steps:[
          { type:'explain', heading:'Loud, Medium & Soft! üîä',
            body:`Remember dynamics? We can play at <strong>3 levels</strong>:<br><br>üîä <strong>Loud (Forte)</strong> ‚Äî Italian word for "strong"<br>üîâ <strong>Medium (Mezzo)</strong> ‚Äî Italian for "middle"<br>üîà <strong>Soft (Piano)</strong> ‚Äî Italian for "soft"<br><br>Yes! "Piano" actually means soft in Italian ‚Äî that\'s how the piano got its name! üéπ`,
            visual:'üîäüîâüîà' },
          { type:'try', heading:'3 Levels of Loud!',
            body:`Play Twinkle (C C G G A A G) at three different volumes:<br>1. <strong>Loud</strong> üîä ‚Äî pretend you\'re in a stadium!<br>2. <strong>Medium</strong> üîâ ‚Äî normal speaking voice<br>3. <strong>Soft</strong> üîà ‚Äî like a secret lullaby`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'Piano means... üåü',
            body:'The word "piano" in Italian music means...',
            opts:['Loud','Fast','Soft üéØ','High'],
            answer:2 }
        ]
      },
      {
        id:'sep_w3_35', title:'Week 3 ¬∑ New Song: Old MacDonald!', sub:'E-I-E-I-O on the piano!', emoji:'üêÑ',
        steps:[
          { type:'explain', heading:'Old MacDonald Had a Farm! üêÑ',
            body:`This classic song is perfect for piano! The notes are:<br><br>üéµ <strong>G G G D E E D</strong> ‚Äî "Old MacDonald had a farm"<br>üéµ <strong>B B A A G</strong> ‚Äî "E-I-E-I-O"<br><br>Fun fact: this song uses 5 different notes ‚Äî G, D, E, B, A!`,
            visual:'üêÑ' },
          { type:'try', heading:'Play Old MacDonald!',
            body:`Let\'s try: <strong>G G G D E E D</strong> (Old Mac-Don-ald had a farm)<br>Then: <strong>B B A A G</strong> (E-I-E-I-O)<br><br>Go slowly and sing along! üé§`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Old MacDonald starts on which note? üåü',
            body:'"Old MacDonald Had a Farm" begins on the note...',
            opts:['C','D','E','G üéØ'],
            answer:3 }
        ]
      },
      {
        id:'sep_w4_35', title:'Week 4 ¬∑ Finger Exercises', sub:'Train your fingers like a champion!', emoji:'üí™',
        steps:[
          { type:'explain', heading:'Finger Training Time! üí™',
            body:`Great pianists have <strong>strong, independent fingers</strong>! That means each finger can move on its own.<br><br>Today we\'ll do finger exercises ‚Äî they might feel silly but they make your fingers smarter and stronger! üèãÔ∏è<br><br>Start with: press finger 1, then finger 2, then 3, 4, 5 ‚Äî one at a time!`,
            visual:'üí™' },
          { type:'try', heading:'Five Finger Exercise!',
            body:`Place your right hand with:<br>Finger 1 (thumb) on <strong>C</strong><br>Finger 2 on <strong>D</strong><br>Finger 3 on <strong>E</strong><br>Finger 4 on <strong>F</strong><br>Finger 5 on <strong>G</strong><br><br>Now press each finger ONE AT A TIME: 1, 2, 3, 4, 5, 4, 3, 2, 1!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'Which finger is the pinky? üåü',
            body:'Your little finger (smallest finger) is finger number...',
            opts:['Finger 1','Finger 3','Finger 4','Finger 5 üéØ'],
            answer:3 }
        ]
      }
    ]
  },
  {
    id:'oct_35', title:'üóìÔ∏è October ‚Äî New Songs & Fun!', emoji:'üçÇ', age:'Ages 3‚Äì5',
    color:'#FFA502', grad:'linear-gradient(135deg,#FFA502,#FF4757)',
    lessons:[
      {
        id:'oct_w1_35', title:'Week 1 ¬∑ London Bridge!', sub:'A classic nursery rhyme!', emoji:'üåâ',
        steps:[
          { type:'explain', heading:'London Bridge is Falling Down! üåâ',
            body:`This song uses notes <strong>G, A, B, C!</strong><br><br>üéµ <strong>G A G F E F G</strong> ‚Äî "London Bridge is falling down"<br>üéµ <strong>D E F E F G</strong> ‚Äî "falling down, falling down"<br>üéµ <strong>G A G F E F G D G</strong> ‚Äî "London Bridge is falling down, my fair lady!"`,
            visual:'üåâ' },
          { type:'try', heading:'Play London Bridge!',
            body:`Start on G and follow: <strong>G A G F E F G</strong>.<br><br>Remember: use finger 1 for G or find G (the blue key!)`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'London Bridge starts on which note? üåü',
            body:'"London Bridge" begins on the note...',
            opts:['C','D','E','G üéØ'],
            answer:3 }
        ]
      },
      {
        id:'oct_w2_35', title:'Week 2 ¬∑ Two-Hand Clapping!', sub:'Learning to coordinate hands!', emoji:'üëê',
        steps:[
          { type:'explain', heading:'Getting Ready for Two Hands! üëê',
            body:`Soon we\'ll play with BOTH hands! To prepare, let\'s practise coordinating them.<br><br>üñêÔ∏è <strong>Right hand</strong> = melody (the tune you sing)<br>ü§ö <strong>Left hand</strong> = bass (the low notes that support)<br><br>First, let\'s practise each hand separately: right hand taps the table while left hand stays still, then swap!`,
            visual:'üëê' },
          { type:'try', heading:'Tap Both Hands!',
            body:`Exercise: Tap your right hand on your knee ‚Äî 1, 2, 3, 4.<br><br>Now tap your LEFT hand ‚Äî 1, 2, 3, 4.<br><br>Now alternate: Right-Left-Right-Left. Can you do it without thinking? üéØ`,
            interactive:'beat_tap' },
          { type:'quiz', heading:'Which hand plays the melody? üåü',
            body:'Usually in piano music, the melody (the tune) is played by the...',
            opts:['Left hand','Right hand üéØ','Both hands at once','Neither hand'],
            answer:1 }
        ]
      },
      {
        id:'oct_w3_35', title:'Week 3 ¬∑ Happy Birthday!', sub:'Play this for someone special!', emoji:'üéÇ',
        steps:[
          { type:'explain', heading:'Happy Birthday to You! üéÇ',
            body:`Everyone knows this song! Let\'s play it on piano!<br><br>üéµ <strong>C C D C F E</strong> ‚Äî "Hap-py birth-day to you"<br>üéµ <strong>C C D C G F</strong> ‚Äî "Hap-py birth-day to you"<br>üéµ <strong>C C C5 A F E D</strong> ‚Äî "Hap-py birth-day dear [name]"<br>üéµ <strong>A# A F G F</strong> ‚Äî "Hap-py birth-day to you!"<br><br>Now you can play it for family! üéâ`,
            visual:'üéÇ' },
          { type:'try', heading:'Play Happy Birthday!',
            body:`Start on C and go: <strong>C C D C F E</strong>. Sing "Happy Birthday to You" as you play! Then try the full song step by step!`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Happy Birthday starts with which two notes? üåü',
            body:'The song "Happy Birthday" starts with...',
            opts:['C D','G G','C C üéØ','E E'],
            answer:2 }
        ]
      },
      {
        id:'oct_w4_35', title:'Week 4 ¬∑ Practice Makes Perfect!', sub:'The secret to being great!', emoji:'üîÅ',
        steps:[
          { type:'explain', heading:'The Secret to Piano ‚Äî Practice! üîÅ',
            body:`Did you know that ALL great musicians practice EVERY day?<br><br>Even Fela Kuti, Miriam Makeba, and Yemi Alade practiced every single day! üéµ<br><br>Even just <strong>5‚Äì10 minutes</strong> of practice every day is much better than one long session once a week. Little by little, you get better!`,
            visual:'üîÅ' },
          { type:'try', heading:'Play Your 3 Favourite Songs!',
            body:`Today, pick your <strong>3 favourite songs</strong> and play each one twice:<br>1. Play it SLOWLY first üê¢<br>2. Then play it at NORMAL speed üéµ<br><br>Notice how it gets easier each time!`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'How often should you practice piano? üåü',
            body:'The best way to improve at piano is to practice...',
            opts:['Once a year','Once a month','Only on weekends','A little bit every day üéØ'],
            answer:3 }
        ]
      }
    ]
  },
  {
    id:'nov_35', title:'üóìÔ∏è November ‚Äî Putting It Together', emoji:'üéº', age:'Ages 3‚Äì5',
    color:'#A855F7', grad:'linear-gradient(135deg,#A855F7,#2ED573)',
    lessons:[
      {
        id:'nov_w1_35', title:'Week 1 ¬∑ C Major Scale!', sub:'Play the full do-re-mi scale!', emoji:'üéµ',
        steps:[
          { type:'explain', heading:'The C Major Scale! üéµ',
            body:`A <strong>scale</strong> is a ladder of notes going from low to high!<br><br>The C Major scale is: <strong>C D E F G A B C</strong><br>In solf√®ge: <strong>Doh Re Mi Fa Sol La Ti Doh!</strong><br><br>You already know all these notes! Playing them in order is called a scale. It\'s the foundation of all music! üéµ`,
            visual:'üéµ' },
          { type:'try', heading:'Play the C Major Scale!',
            body:`Start at C and play up: <strong>C D E F G A B C</strong><br>Then come back down: <strong>C B A G F E D C</strong><br><br>Sing "Doh Re Mi Fa Sol La Ti Doh" as you go up!`,
            interactive:'all_notes' },
          { type:'quiz', heading:'The C major scale has how many notes? üåü',
            body:'The C major scale (C D E F G A B C) has how many different notes?',
            opts:['5 notes','6 notes','7 notes üéØ','8 notes'],
            answer:2 }
        ]
      },
      {
        id:'nov_w2_35', title:'Week 2 ¬∑ Playing with Expression!', sub:'Make music tell a story!', emoji:'üìñ',
        steps:[
          { type:'explain', heading:'Music Tells a Story! üìñ',
            body:`The best musicians don\'t just play notes ‚Äî they tell a <strong>story</strong> with music!<br><br>Think about the song "Twinkle Twinkle Little Star." Imagine you\'re looking up at the night sky in Nigeria üåô‚≠ê...<br><br>Play it soft and slow ‚Äî doesn\'t it feel like you\'re really looking at stars? That\'s <strong>expression</strong>!`,
            visual:'üåô‚≠ê' },
          { type:'try', heading:'Tell a Story with Sound!',
            body:`Play Twinkle Twinkle and imagine:<br>- Start <strong>soft</strong> ü§´ (the star is far away)<br>- Get <strong>louder</strong> üîä in the middle (moving closer!)<br>- End <strong>soft</strong> again ü§´ (back to the night sky)<br><br>Play with feeling! üí´`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'What is "expression" in music? üåü',
            body:'Playing with expression means...',
            opts:['Playing every note the same way','Playing very fast only','Changing dynamics and feeling to tell a story üéØ','Only playing loud'],
            answer:2 }
        ]
      },
      {
        id:'nov_w3_35', title:'Week 3 ¬∑ Jingle Bells Preview!', sub:'Getting ready for Christmas!', emoji:'üîî',
        steps:[
          { type:'explain', heading:'Jingle Bells ‚Äî Early Preview! üîî',
            body:`Christmas is coming! Let\'s learn Jingle Bells early so we can impress our family!<br><br>üéµ <strong>E E E</strong> ‚Äî "Jin-gle bells"<br>üéµ <strong>E E E</strong> ‚Äî "Jin-gle bells"<br>üéµ <strong>E G C D E</strong> ‚Äî "Jin-gle all the way!"<br>üéµ <strong>F F F F F E E E</strong> ‚Äî "Oh what fun it is to ride"<br>üéµ <strong>E D D E D G</strong> ‚Äî "In a one-horse open sleigh!"`,
            visual:'üîî' },
          { type:'try', heading:'Play Jingle Bells!',
            body:`Start with the easy part: <strong>E E E ¬∑ E E E ¬∑ E G C D E</strong><br><br>Sing "Jingle Bells, Jingle Bells, Jingle all the way!" as you play! üéÑ`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Jingle Bells starts with three of which note? üåü',
            body:'The song Jingle Bells starts with three repeated notes ‚Äî which note?',
            opts:['C','D','E üéØ','G'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'dec_35', title:'üóìÔ∏è December ‚Äî End of Year Celebration! üéÑ', emoji:'üéÑ', age:'Ages 3‚Äì5',
    color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FFD700)',
    lessons:[
      {
        id:'dec_w1_35', title:'Week 1 ¬∑ Jingle Bells Full!', sub:'Play the complete Christmas song!', emoji:'üéÖ',
        steps:[
          { type:'explain', heading:'Jingle Bells ‚Äî Complete! üéÖ',
            body:`You\'ve been practising ‚Äî now let\'s play the whole thing!<br><br>üéµ <strong>E E E ¬∑ E E E ¬∑ E G C D E</strong> ‚Äî "Jingle Bells, Jingle Bells, Jingle all the way!"<br>üéµ <strong>F F F F F E E E E ¬∑ D D E D G</strong> ‚Äî "Oh what fun it is to ride in a one-horse open sleigh!"<br><br>Then repeat from the top! üéÑ`,
            visual:'üéÖ' },
          { type:'try', heading:'Full Jingle Bells!',
            body:`Play the complete Jingle Bells! If you make a mistake, just keep going ‚Äî real musicians don\'t stop! üéπ<br><br>When you finish, take a bow! üôá`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'What do musicians do when they make a mistake? üåü',
            body:'A professional musician who makes a mistake during a performance...',
            opts:['Stops and starts over','Cries and gives up','Keeps playing without stopping üéØ','Leaves the stage'],
            answer:2 }
        ]
      },
      {
        id:'dec_w2_35', title:'Week 2 ¬∑ My Year in Music!', sub:'Look how far you\'ve come!', emoji:'üèÜ',
        steps:[
          { type:'explain', heading:'What a Year! üèÜ',
            body:`From January to December ‚Äî look how much you\'ve learned!<br><br>üéπ 7 musical notes<br>üéµ 6+ songs you can play<br>‚úã All 5 finger numbers<br>üîä Loud, soft, fast, slow<br>üìä How to find C using black keys<br>üåà Note colours<br>üá≥üá¨ Nigerian musical roots<br><br>You are a <strong>PianoNaija Champion!</strong> üèÖ`,
            visual:'üèÜ' },
          { type:'try', heading:'Grand Concert ‚Äî Play Your Best!',
            body:`For your end-of-year concert, choose ONE song and play it as beautifully as you can!<br><br>Imagine your family is watching. Play with:<br>‚≠ê Good posture<br>‚≠ê Curved fingers<br>‚≠ê Expression and feeling<br>‚≠ê A smile! üòä`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'What is the most important thing in music? üåü',
            body:'The most important thing when playing piano is...',
            opts:['Playing perfectly with no mistakes','Playing as fast as possible','Enjoying the music and having fun üéØ','Playing only loud'],
            answer:2 }
        ]
      },
      {
        id:'dec_w3_35', title:'Week 3 ¬∑ Goodbye & Next Steps!', sub:'Ready for next year!', emoji:'üöÄ',
        steps:[
          { type:'explain', heading:'You\'re Ready for the Next Level! üöÄ',
            body:`Congratulations on finishing your first year of piano! üéâ<br><br>In your next year, you will:<br>üéµ Learn both hands together<br>üéµ Play more complex songs<br>üéµ Learn to read simple music<br>üéµ Discover more Nigerian and world music<br><br><strong>Keep practising every day ‚Äî even just 5 minutes! You are amazing! üåü</strong>`,
            visual:'üöÄ' },
          { type:'try', heading:'Play Your Favourite Song One More Time!',
            body:`For the very last lesson of the year, play your <strong>all-time favourite song</strong> from the Piano tab.<br><br>Play it with everything you\'ve got ‚Äî loud, expressive, and full of joy! üéâüá≥üá¨`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'Final Challenge! üåü',
            body:'What are the 7 notes of the C Major scale in order?',
            opts:['A B C D E F G','C D E F G A B üéØ','C E G B D F A','D E F G A B C'],
            answer:1 }
        ]
      }
    ]
  }
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AGES 5‚Äì8 FULL YEAR CURRICULUM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CURRICULUM_5_8 = [
  LEVEL1_SHARED,
  {
    id:'feb_58', title:'üóìÔ∏è February ‚Äî Note Names & Reading', emoji:'üìñ', age:'Ages 5‚Äì8',
    color:'#FFA502', grad:'linear-gradient(135deg,#FFA502,#FFD700)',
    lessons:[
      {
        id:'feb_w1_58', title:'Week 1 ¬∑ The Musical Alphabet', sub:'A B C D E F G ‚Äî and back to A!', emoji:'üî§',
        steps:[
          { type:'explain', heading:'The Musical Alphabet üî§',
            body:`Music uses only 7 letters: <strong>A B C D E F G</strong>.<br><br>After G, it starts again with A! These 7 letters name every note on the piano.<br><br>The piano has the same 7 notes repeated at <strong>different pitches</strong> (heights). Middle C, for example, is the C closest to the middle of the piano.`,
            visual:'üî§' },
          { type:'try', heading:'Name the Notes!',
            body:`Play each white key starting from C and say its letter name:<br><strong>C D E F G A B</strong> ‚Äî then start again with C!<br><br>Try doing this from memory without looking. Can you name them all? üåü`,
            interactive:'all_notes' },
          { type:'quiz', heading:'After G comes... üåü',
            body:'In the musical alphabet, after G the notes...',
            opts:['Continue to H','Start over at A üéØ','End at G','Go to Z'],
            answer:1 }
        ]
      },
      {
        id:'feb_w2_58', title:'Week 2 ¬∑ Finding Notes on the Piano', sub:'Use the black keys as a map!', emoji:'üó∫Ô∏è',
        steps:[
          { type:'explain', heading:'The Black Key Map! üó∫Ô∏è',
            body:`The black keys help you find any white key instantly!<br><br>‚¨õ‚¨õ <strong>2 black keys:</strong> D is BETWEEN them. C is LEFT, E is RIGHT.<br>‚¨õ‚¨õ‚¨õ <strong>3 black keys:</strong> F is LEFT, A is MIDDLE, B is RIGHT. G is between the first 2 of 3 black keys.<br><br>Memorise this pattern and you can find any note on any piano!`,
            visual:'‚¨õ‚¨õ ‚¨õ‚¨õ‚¨õ' },
          { type:'try', heading:'Find D on Every Octave!',
            body:`Using the 2-black-key trick, find <strong>D</strong> in every position on the piano. D is always BETWEEN the two black keys!<br><br>Then find <strong>F</strong> ‚Äî it\'s always to the LEFT of the 3 black keys!`,
            interactive:'find_cde' },
          { type:'quiz', heading:'D is always... üåü',
            body:'On the piano, D is always found...',
            opts:['To the left of 2 black keys','Between 2 black keys üéØ','To the right of 3 black keys','Next to no black keys'],
            answer:1 }
        ]
      },
      {
        id:'feb_w3_58', title:'Week 3 ¬∑ Introduction to Sheet Music', sub:'Reading the language of music!', emoji:'üìÑ',
        steps:[
          { type:'explain', heading:'Sheet Music ‚Äî The Language of Music! üìÑ',
            body:`<strong>Sheet music</strong> is a visual way to write down music so anyone can play it!<br><br>Music is written on a <strong>staff</strong> ‚Äî 5 horizontal lines. Notes sit ON the lines or IN the spaces between them.<br><br>üéµ <strong>Higher position</strong> on the staff = <strong>higher sound</strong><br>üéµ <strong>Lower position</strong> = <strong>lower sound</strong>`,
            visual:'üìÑ' },
          { type:'explain', heading:'Treble Clef ùÑû',
            body:`The <strong>treble clef</strong> (ùÑû) sits at the start of the staff. It tells you this is for the RIGHT HAND.<br><br>For treble clef, the lines spell <strong>E G B D F</strong> ‚Äî remember: "<strong>Every Good Boy Deserves Fanta!</strong>" üçπ<br><br>The spaces spell <strong>F A C E</strong> ‚Äî easy to remember!`,
            visual:'ùÑû' },
          { type:'try', heading:'Look at the Staff!',
            body:`Look at the staff below. Can you see the note sitting on the first line? That\'s <strong>E</strong>!<br><br>Now look at the space just below: that\'s D. The space above the first line is <strong>F</strong>!`,
            interactive:'staff_display' },
          { type:'quiz', heading:'What do the spaces in treble clef spell? üåü',
            body:'In treble clef, the four spaces (bottom to top) spell...',
            opts:['BEAD','FACE üéØ','CAGE','FADE'],
            answer:1 }
        ]
      },
      {
        id:'feb_w4_58', title:'Week 4 ¬∑ Note Values', sub:'Crotchets, minims and more!', emoji:'üïê',
        steps:[
          { type:'explain', heading:'How Long Do Notes Last? üïê',
            body:`Notes have different <strong>shapes</strong> that tell you how long to hold them:<br><br>‚ô© <strong>Crotchet</strong> (Quarter note) = 1 beat<br>ùÖóùÖ• <strong>Minim</strong> (Half note) = 2 beats<br>ùÖù <strong>Semibreve</strong> (Whole note) = 4 beats<br>‚ô™ <strong>Quaver</strong> (Eighth note) = ¬Ω beat<br><br>A filled note head with a stem = crotchet. Open note head with a stem = minim!`,
            visual:'üïê' },
          { type:'explain', heading:'Counting Beats',
            body:`In most music we count <strong>1, 2, 3, 4</strong> ‚Äî these are called <strong>beats</strong>.<br><br>‚ô© Crotchet = <strong>1 count</strong><br>ùÖóùÖ• Minim = <strong>2 counts</strong> ‚Äî hold it!<br>ùÖù Semibreve = <strong>4 counts</strong> ‚Äî hold it longer!<br>‚ô™ Quaver = <strong>¬Ω count</strong> ‚Äî two fit in one beat!`,
            visual:'‚è±Ô∏è' },
          { type:'quiz', heading:'How many beats in a minim? üåü',
            body:'A minim (half note) lasts for how many beats?',
            opts:['1 beat','2 beats üéØ','3 beats','4 beats'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'mar_58', title:'üóìÔ∏è March ‚Äî Playing Songs from Notes', emoji:'üé∂', age:'Ages 5‚Äì8',
    color:'#2ED573', grad:'linear-gradient(135deg,#2ED573,#00C853)',
    lessons:[
      {
        id:'mar_w1_58', title:'Week 1 ¬∑ Play Mary Had a Little Lamb', sub:'Read and play your first piece!', emoji:'üêë',
        steps:[
          { type:'explain', heading:'Reading & Playing Mary Had a Little Lamb! üêë',
            body:`Now we put reading into practice! Mary Had a Little Lamb uses <strong>E D C D E E E, D D D, E G G</strong>.<br><br>The melody steps mostly by step (adjacent notes) ‚Äî which is the easiest type to learn!<br><br>Play slowly at first ‚Äî speed comes with practice!`,
            visual:'üêë' },
          { type:'try', heading:'Play Mary!',
            body:`Play the full melody: <strong>E D C D E E E ¬∑ D D D ¬∑ E G G ¬∑ E D C D E E E E D D E D C</strong><br><br>Count as you go: each note is one beat. Keep it steady!`,
            interactive:'song_mary' },
          { type:'quiz', heading:'Right hand or left hand for treble clef? üåü',
            body:'The treble clef (ùÑû) tells us to use which hand?',
            opts:['Left hand ü§ö','Right hand üñêÔ∏è üéØ','Both hands','Neither hand'],
            answer:1 }
        ]
      },
      {
        id:'mar_w2_58', title:'Week 2 ¬∑ Twinkle Twinkle Full!', sub:'Play the complete song!', emoji:'‚≠ê',
        steps:[
          { type:'explain', heading:'Twinkle Twinkle ‚Äî Full Song! ‚≠ê',
            body:`Let\'s play the full song:<br><br>üéµ <strong>C C G G A A G</strong> ‚Äî "Twinkle twinkle little star"<br>üéµ <strong>F F E E D D C</strong> ‚Äî "How I wonder what you are"<br>üéµ <strong>G G F F E E D</strong> ‚Äî "Up above the world so high"<br>üéµ <strong>G G F F E E D</strong> ‚Äî "Like a diamond in the sky"<br>üéµ Then repeat first two lines!`,
            visual:'‚≠ê' },
          { type:'try', heading:'Full Twinkle Play-Along!',
            body:`Press Play Along in the Piano tab and follow each highlighted note! Try to keep a steady beat ‚Äî don\'t rush! üåü`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'What note does Twinkle start on? üåü',
            body:'Twinkle Twinkle Little Star starts on the note...',
            opts:['G','A','E','C üéØ'],
            answer:3 }
        ]
      },
      {
        id:'mar_w3_58', title:'Week 3 ¬∑ Time Signatures', sub:'4/4 and 3/4 ‚Äî understanding the bar!', emoji:'üìä',
        steps:[
          { type:'explain', heading:'Time Signatures! üìä',
            body:`A <strong>time signature</strong> appears at the start of a piece as two numbers:<br><br>The <strong>TOP number</strong> = how many beats in each bar<br>The <strong>BOTTOM number</strong> = what note type gets 1 beat<br><br><strong>4/4</strong> = 4 crotchet beats per bar (most common ‚Äî think of most pop songs!)<br><strong>3/4</strong> = 3 beats per bar (waltz feel ‚Äî count 1 2 3 | 1 2 3!)`,
            visual:'üìä' },
          { type:'try', heading:'Clap in 4/4 and 3/4!',
            body:`Clap in <strong>4/4</strong>: "1 2 3 4 | 1 2 3 4" ‚Äî accent beat 1 each time!<br><br>Now <strong>3/4</strong>: "1 2 3 | 1 2 3" ‚Äî clap LOUD soft soft | LOUD soft soft!<br><br>Which feels more like a waltz? üíÉ`,
            interactive:'beat_tap' },
          { type:'quiz', heading:'4/4 time means... üåü',
            body:'A piece in 4/4 time has how many beats in each bar?',
            opts:['4 beats üéØ','3 beats','2 beats','6 beats'],
            answer:0 }
        ]
      },
      {
        id:'mar_w4_58', title:'Week 4 ¬∑ Amazing Grace', sub:'A beautiful hymn in 3/4!', emoji:'üôè',
        steps:[
          { type:'explain', heading:'Amazing Grace üôè',
            body:`Amazing Grace is in <strong>3/4 time</strong> ‚Äî count 1 2 3 | 1 2 3.<br><br>The melody: <strong>C F A A G F D C ‚Äî C F A A G C5</strong><br><br>It flows gently ‚Äî don\'t rush! Imagine singing it in church as you play. üôè<br><br>Interesting fact: Amazing Grace is one of the most recognised songs in the world!`,
            visual:'üôè' },
          { type:'try', heading:'Play Amazing Grace!',
            body:`Select <strong>Amazing Grace</strong> in the Piano tab and press Play to hear it first. Then try Play Along and follow the notes!<br><br>Count "1 2 3 | 1 2 3" as you play to feel the waltz rhythm.`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Amazing Grace is in which time? üåü',
            body:'Amazing Grace has a "waltz" feel ‚Äî it is in...',
            opts:['4/4 time','2/4 time','3/4 time üéØ','6/8 time'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'apr_58', title:'üóìÔ∏è April ‚Äî Scales & Theory', emoji:'üìê', age:'Ages 5‚Äì8',
    color:'#1E90FF', grad:'linear-gradient(135deg,#1E90FF,#A855F7)',
    lessons:[
      {
        id:'apr_w1_58', title:'Week 1 ¬∑ The C Major Scale', sub:'Play the full musical staircase!', emoji:'ü™ú',
        steps:[
          { type:'explain', heading:'The C Major Scale ü™ú',
            body:`A <strong>scale</strong> is a set of notes in alphabetical order. The C Major scale is:<br><br><strong>C D E F G A B C</strong><br><br>It starts and ends on C but at different pitches. The second C is exactly <strong>one octave</strong> higher (8 notes up).<br><br>Most music is based on scales ‚Äî learning them unlocks all other music!`,
            visual:'ü™ú' },
          { type:'try', heading:'Play the C Major Scale!',
            body:`Right hand fingering:<br>C(1) D(2) E(3) ‚Äî then <strong>thumb tucks under</strong> ‚Äî F(1) G(2) A(3) B(4) C(5)<br><br>This "thumb under" technique is crucial! Practice it slowly.`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'How many notes are in an octave? üåü',
            body:'From C to the next C (one octave) contains how many notes?',
            opts:['5 notes','7 notes','8 notes üéØ','12 notes'],
            answer:2 }
        ]
      },
      {
        id:'apr_w2_58', title:'Week 2 ¬∑ Semitones & Tones', sub:'The smallest musical steps!', emoji:'üî¨',
        steps:[
          { type:'explain', heading:'Semitones & Tones üî¨',
            body:`A <strong>semitone</strong> is the smallest step on the piano ‚Äî from any key to the very next key (including black keys).<br><br>A <strong>tone</strong> = 2 semitones (skipping one key).<br><br>C to D = 1 TONE (2 semitones)<br>E to F = 1 SEMITONE (no black key between them!)<br>B to C = 1 SEMITONE (no black key between them!)`,
            visual:'üî¨' },
          { type:'try', heading:'Find the Semitones!',
            body:`Play from E to F ‚Äî notice there\'s NO black key between them? That\'s a semitone!<br><br>Now play E to F# (black key) ‚Äî that\'s also a semitone!<br><br>Try finding all the natural semitones: E-F and B-C.`,
            interactive:'all_notes' },
          { type:'quiz', heading:'E to F is a... üåü',
            body:'Moving from E to the very next key F is a...',
            opts:['Tone (2 semitones)','Semitone (1 step) üéØ','Third','Fifth'],
            answer:1 }
        ]
      },
      {
        id:'apr_w3_58', title:'Week 3 ¬∑ Dynamics ‚Äî Piano & Forte', sub:'Loud and soft in Italian!', emoji:'üé≠',
        steps:[
          { type:'explain', heading:'Dynamics ‚Äî The Volume of Music! üé≠',
            body:`<strong>Dynamics</strong> tell you how loud or soft to play. They use Italian words:<br><br><strong>pp</strong> = pianissimo ‚Äî very soft ü§´<br><strong>p</strong> = piano ‚Äî soft<br><strong>mp</strong> = mezzo-piano ‚Äî medium soft<br><strong>mf</strong> = mezzo-forte ‚Äî medium loud<br><strong>f</strong> = forte ‚Äî loud<br><strong>ff</strong> = fortissimo ‚Äî very loud üì¢<br><br>These markings appear in written sheet music!`,
            visual:'üé≠' },
          { type:'explain', heading:'Crescendo & Decrescendo',
            body:`Music can gradually change volume:<br><br><em>Crescendo</em> (<strong>cresc.</strong>) ‚Äî gradually get <strong>louder</strong> ‚Äî‚Äî><br><em>Decrescendo</em> (<strong>decresc.</strong>) ‚Äî gradually get <strong>softer</strong> <‚Äî‚Äî<br><br>These create emotion and drama in music. Think of Afrobeats songs that build up ‚Äî that\'s a crescendo! üî•`,
            visual:'üìàüìâ' },
          { type:'quiz', heading:'What does "forte" mean? üåü',
            body:'In music, the dynamic marking "f" (forte) means...',
            opts:['Very soft','Medium loud','Loud üéØ','Very loud (ff)'],
            answer:2 }
        ]
      },
      {
        id:'apr_w4_58', title:'Week 4 ¬∑ Row Your Boat!', sub:'Triplets and a rising melody!', emoji:'üö£',
        steps:[
          { type:'explain', heading:'Row, Row, Row Your Boat! üö£',
            body:`This cheerful song has an interesting feature ‚Äî the "Merrily" section uses <strong>triplets</strong> (3 notes fitting into 1 beat)!<br><br>The melody: <strong>C C C ¬∑ C D E ¬∑ E D E F G</strong> (Row row row your boat, Gently down the stream)<br><br>Then "Merrily" descends: <strong>C5 C5 C5 ¬∑ G4 G4 G4 ¬∑ E4 E4 E4 ¬∑ C4 C4 C4</strong>!`,
            visual:'üö£' },
          { type:'try', heading:'Play Row Your Boat!',
            body:`Select Row Your Boat in the Piano tab and listen first. Then try Play Along.<br><br>Pay special attention to the Merrily section ‚Äî those quick descending triplets are the hardest part! Keep your fingers relaxed! üéπ`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'What is a triplet? üåü',
            body:'In music, a triplet means...',
            opts:['Playing 3 songs in a row','3 notes played in the time of 2 üéØ','Playing 3 times very loudly','A group of 3 musicians'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'may_58', title:'üóìÔ∏è May ‚Äî Left Hand & Coordination', emoji:'ü§ö', age:'Ages 5‚Äì8',
    color:'#A855F7', grad:'linear-gradient(135deg,#A855F7,#FF4FA3)',
    lessons:[
      {
        id:'may_w1_58', title:'Week 1 ¬∑ Left Hand Basics', sub:'The bass clef and low notes!', emoji:'ü§ö',
        steps:[
          { type:'explain', heading:'The Left Hand ‚Äî Bass Clef! ü§ö',
            body:`Your left hand uses the <strong>bass clef</strong> (ùÑ¢) and plays lower notes.<br><br>Bass clef lines spell: <strong>G B D F A</strong> ‚Äî remember: "<strong>Good Boys Don\'t Forget Africa!</strong>" üåç<br><br>The left hand usually plays the <strong>accompaniment</strong> ‚Äî chords and bass notes that support the melody.`,
            visual:'ü§ö' },
          { type:'try', heading:'Play Low Notes with Left Hand!',
            body:`Place your LEFT hand on the lower part of the piano. Press C (thumb) then D, E, F, G.<br><br>Notice how they sound lower than your right hand? That\'s the bass range! Try keeping a steady beat with your left thumb: C C C C...`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'The bass clef is for which hand? üåü',
            body:'In standard piano music, the bass clef (ùÑ¢) is played by the...',
            opts:['Right hand','Left hand üéØ','Both hands','Neither hand'],
            answer:1 }
        ]
      },
      {
        id:'may_w2_58', title:'Week 2 ¬∑ Left Hand Patterns', sub:'Simple bass accompaniment!', emoji:'üé∏',
        steps:[
          { type:'explain', heading:'Left Hand Bass Pattern! üé∏',
            body:`The simplest left hand pattern is to play a single bass note on every beat:<br><br>While right hand plays Twinkle (C C G G A A G)...<br>Left hand holds/repeats: <strong>C C C C C C C</strong><br><br>This gives the music a <strong>full, rich sound</strong>! This is how many beginner piano songs work.`,
            visual:'üé∏' },
          { type:'try', heading:'Left Hand on C!',
            body:`Try this exercise:<br>- Left hand: press and hold low <strong>C</strong><br>- Right hand: play <strong>C D E F G</strong> slowly<br><br>Can you do both at the same time? Start very slowly ‚Äî this takes practice! üéØ`,
            interactive:'lh_gc' },
          { type:'quiz', heading:'What does the left hand usually play? üåü',
            body:'In piano music, the left hand most commonly plays...',
            opts:['The melody only','Bass notes and chords üéØ','Nothing','Exactly the same as right hand'],
            answer:1 }
        ]
      },
      {
        id:'may_w3_58', title:'Week 3 ¬∑ Two Hands Together ‚Äî Basics', sub:'Coordinate both hands!', emoji:'ü§ù',
        steps:[
          { type:'explain', heading:'Two Hands Together! ü§ù',
            body:`Playing with two hands is the biggest challenge ‚Äî but also the most rewarding!<br><br>The key is to:<br>1. <strong>Learn each hand separately first</strong><br>2. Play VERY slowly when combining<br>3. Gradually speed up only when it\'s smooth<br><br>Be patient with yourself ‚Äî even the greatest pianists had to practice this! üéπ`,
            visual:'ü§ù' },
          { type:'try', heading:'Twinkle with Both Hands!',
            body:`Right hand: <strong>C C G G A A G</strong> (Twinkle opening)<br>Left hand: press low <strong>C</strong> once, hold it<br><br>Try doing both at the same time! Go very slowly. Don\'t worry if it\'s not perfect yet.`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'The best way to learn two-hand playing is... üåü',
            body:'When learning to play with two hands, you should...',
            opts:['Jump in at full speed','Practice each hand separately first, then combine slowly üéØ','Only practice left hand','Skip practicing and just try it'],
            answer:1 }
        ]
      },
      {
        id:'may_w4_58', title:'Week 4 ¬∑ Naija Music Appreciation', sub:'Our musical heritage!', emoji:'üá≥üá¨',
        steps:[
          { type:'explain', heading:'Nigerian Musical Traditions üá≥üá¨',
            body:`Nigeria has one of the richest musical traditions in the world!<br><br>ü•Å <strong>Talking Drum (D√πnd√∫n)</strong> ‚Äî can mimic human speech!<br>üé∫ <strong>Ogene</strong> ‚Äî Igbo iron bell used in traditional music<br>ü™ó <strong>Highlife</strong> ‚Äî early Nigerian/Ghanaian jazz fusion from the 1920s<br>üéµ <strong>Afrobeats</strong> ‚Äî today\'s global Nigerian sound<br><br>Piano connects beautifully with ALL these traditions!`,
            visual:'üá≥üá¨' },
          { type:'try', heading:'Play a Highlife-Inspired Groove!',
            body:`Highlife music features a rhythmic, bouncy feel. Try this groove:<br><strong>C E G E ¬∑ C E G E</strong> (right hand)<br>Keep it light and bouncy ‚Äî imagine a Highlife guitarist! üé∏üá≥üá¨`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'The Talking Drum can do what? üåü',
            body:'Nigeria\'s talking drum (D√πnd√∫n) is famous because it can...',
            opts:['Play piano music','Mimic human speech tones üéØ','Play 100 different notes','Play only one sound'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'jun_58', title:'üóìÔ∏è June ‚Äî Chords & Harmony', emoji:'üé∏', age:'Ages 5‚Äì8',
    color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FFA502)',
    lessons:[
      {
        id:'jun_w1_58', title:'Week 1 ¬∑ What is a Chord?', sub:'3 notes played at once!', emoji:'üé∏',
        steps:[
          { type:'explain', heading:'Chords ‚Äî The Harmony of Music! üé∏',
            body:`A <strong>chord</strong> is when you press <strong>3 or more notes at the same time</strong>!<br><br>The most basic chord is a <strong>triad</strong> ‚Äî using the 1st, 3rd, and 5th notes of a scale.<br><br>The <strong>C Major chord</strong> = C + E + G played together. It sounds happy and bright!`,
            visual:'üé∏' },
          { type:'explain', heading:'The Three Main Chords in C Major',
            body:`In the key of C Major, the three most important chords are:<br><br>üéµ <strong>C chord</strong>: C + E + G (fingers 1, 3, 5)<br>üéµ <strong>F chord</strong>: F + A + C (fingers 1, 3, 5)<br>üéµ <strong>G chord</strong>: G + B + D (fingers 1, 3, 5)<br><br>Almost every song uses variations of these three chords!`,
            visual:'üéπ' },
          { type:'try', heading:'Play the C Major Chord!',
            body:`Place fingers <strong>1, 3, 5</strong> (thumb, middle, pinky) on <strong>C, E, G</strong> and press all three at the same time.<br><br>That\'s your first chord! üéâ How does it sound?`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'The C Major chord uses which notes? üåü',
            body:'The C Major triad (chord) consists of...',
            opts:['C D E','C E G üéØ','C F A','D F A'],
            answer:1 }
        ]
      },
      {
        id:'jun_w2_58', title:'Week 2 ¬∑ The F and G Chords', sub:'Complete the basic chord family!', emoji:'üé∂',
        steps:[
          { type:'explain', heading:'F and G Chords! üé∂',
            body:`Now let\'s learn the other two main chords:<br><br>üü¢ <strong>F Major chord</strong> = F + A + C<br>Place fingers 1(F), 3(A), 5(C)<br><br>üîµ <strong>G Major chord</strong> = G + B + D<br>Place fingers 1(G), 3(B), 5(D)<br><br>With C, F, and G, you can play thousands of songs!`,
            visual:'üé∂' },
          { type:'try', heading:'Practice All Three Chords!',
            body:`Try switching between chords:<br><strong>C chord</strong> ‚Üí <strong>F chord</strong> ‚Üí <strong>G chord</strong> ‚Üí <strong>C chord</strong><br><br>This is called a <strong>chord progression</strong> ‚Äî the backbone of most pop and gospel music! üôå`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'The F Major chord is... üåü',
            body:'The F Major chord (triad) consists of which three notes?',
            opts:['F G A','F A C üéØ','F B D','F A B'],
            answer:1 }
        ]
      },
      {
        id:'jun_w3_58', title:'Week 3 ¬∑ Accompaniment with Chords', sub:'Left hand chords + right hand melody!', emoji:'üéπ',
        steps:[
          { type:'explain', heading:'Chords in the Left Hand! üéπ',
            body:`Now we put it all together:<br><br>üñêÔ∏è <strong>Right hand</strong> = melody of Twinkle Twinkle<br>ü§ö <strong>Left hand</strong> = play C chord (C+E+G) every 2 beats<br><br>This creates a full, professional sound! This is how real piano music works.`,
            visual:'üéπ' },
          { type:'try', heading:'Twinkle with Left Hand Chords!',
            body:`Try playing Twinkle\'s opening line with your right hand, while your left hand presses the C chord once every 2 beats.<br><br>Go VERY slowly at first. Speed comes with practice!`,
            interactive:'song_twinkle_1' },
          { type:'quiz', heading:'What makes music sound "full"? üåü',
            body:'Adding left hand chords to a right hand melody makes the music sound...',
            opts:['Quieter and simpler','Fuller and richer üéØ','Off-key','Faster'],
            answer:1 }
        ]
      },
      {
        id:'jun_w4_58', title:'Week 4 ¬∑ Half-Year Review & Mini Concert!', sub:'Show off everything you know!', emoji:'üé≠',
        steps:[
          { type:'explain', heading:'Half-Year Celebration! üé≠',
            body:`Halfway through the year ‚Äî amazing progress! You now know:<br><br>‚úÖ Musical alphabet (A‚ÄìG)<br>‚úÖ Reading treble clef basics<br>‚úÖ Note values (‚ô© ùÖóùÖ• ùÖù)<br>‚úÖ Time signatures (4/4, 3/4)<br>‚úÖ Major scale (C D E F G A B C)<br>‚úÖ Three chords (C, F, G)<br>‚úÖ Dynamics (p, f, mf, ff)<br><br>You\'re a real musician! üèÖ`,
            visual:'üé≠' },
          { type:'try', heading:'Mini Concert ‚Äî Play Your Best!',
            body:`Choose your best song from the Piano tab and perform it with:<br>‚≠ê Correct posture<br>‚≠ê Curved fingers<br>‚≠ê Good dynamics (start soft, build up)<br>‚≠ê Expression ‚Äî tell a story!<br><br>Perform it like you\'re on stage at Eko Atlantic! üé§üá≥üá¨`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'The three main chords in C Major are... üåü',
            body:'The three most important chords in the key of C Major are...',
            opts:['A, D, E chords','C, F, G chords üéØ','D, G, A chords','B, E, F chords'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'sep_58', title:'üóìÔ∏è September ‚Äî New Term, New Skills!', emoji:'üìö', age:'Ages 5‚Äì8',
    color:'#2ED573', grad:'linear-gradient(135deg,#2ED573,#1E90FF)',
    lessons:[
      {
        id:'sep_w1_58', title:'Week 1 ¬∑ New Key ‚Äî G Major!', sub:'One sharp makes a new sound!', emoji:'üîë',
        steps:[
          { type:'explain', heading:'G Major Scale! üîë',
            body:`We\'ve been playing in C Major. Now let\'s explore <strong>G Major</strong>!<br><br>G Major = G A B C D E F# G<br><br>Notice the <strong>F#</strong> (F sharp) ‚Äî that\'s the black key next to F! It\'s higher than F by one semitone.<br><br>G Major has <strong>one sharp</strong>: F#. This means every F in the song is played as F#!`,
            visual:'üîë' },
          { type:'try', heading:'Play the G Major Scale!',
            body:`G(1) A(2) B(3) ‚Äî thumb under ‚Äî C(1) D(2) E(3) F#(4) G(5)<br><br>Remember to play <strong>F# (the black key)</strong> instead of F! How does it sound different to C Major?`,
            interactive:'all_notes' },
          { type:'quiz', heading:'G Major has how many sharps? üåü',
            body:'The key signature of G Major contains...',
            opts:['No sharps','One sharp (F#) üéØ','Two sharps','Three sharps'],
            answer:1 }
        ]
      },
      {
        id:'sep_w2_58', title:'Week 2 ¬∑ Sharps & Flats', sub:'The black keys explained!', emoji:'‚¨õ',
        steps:[
          { type:'explain', heading:'Sharps & Flats! ‚¨õ',
            body:`Every black key has two names:<br><br><strong>Sharp (#)</strong> = one semitone HIGHER than the white key to the left<br>‚Üí F# is one semitone above F<br><br><strong>Flat (‚ô≠)</strong> = one semitone LOWER than the white key to the right<br>‚Üí B‚ô≠ is one semitone below B<br><br>So F# and G‚ô≠ are the <strong>same black key</strong> with two different names!`,
            visual:'‚¨õ' },
          { type:'try', heading:'Find and Play Sharps!',
            body:`Find and press these notes:<br>- <strong>F#</strong> (black key just right of F)<br>- <strong>C#</strong> (black key just right of C)<br>- <strong>G#</strong> (black key just right of G)<br><br>These are ALL black keys!`,
            interactive:'all_notes' },
          { type:'quiz', heading:'F# is the same key as... üåü',
            body:'The black key F# is the same physical key as...',
            opts:['E‚ô≠','G‚ô≠ üéØ','A‚ô≠','D‚ô≠'],
            answer:1 }
        ]
      },
      {
        id:'sep_w3_58', title:'Week 3 ¬∑ I Just Want to Say!', sub:'A Nigerian-inspired melody!', emoji:'üá≥üá¨',
        steps:[
          { type:'explain', heading:'I Just Want to Say! üá≥üá¨',
            body:`This Naija-inspired song uses a descending melody ‚Äî very common in West African music.<br><br>The notes: <strong>E D C B A</strong> (going down!)<br><br>In many Yoruba, Igbo and Hausa songs, the melody tends to move in a <strong>flowing, step-by-step</strong> pattern like this.`,
            visual:'üá≥üá¨' },
          { type:'try', heading:'Play the Naija Melody!',
            body:`In the Piano tab, select the Nigerian song and press Play to hear it. Then try Play Along.<br><br>Notice how the melody flows DOWN smoothly ‚Äî that\'s very characteristic of Nigerian musical phrasing!`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'A descending melody means... üåü',
            body:'A melody that is "descending" means the notes are going...',
            opts:['Up higher and higher','Down lower and lower üéØ','Staying the same pitch','Playing faster'],
            answer:1 }
        ]
      },
      {
        id:'sep_w4_58', title:'Week 4 ¬∑ Rests & Silence', sub:'Silence is also music!', emoji:'ü§´',
        steps:[
          { type:'explain', heading:'Rests ‚Äî Silence in Music! ü§´',
            body:`Just like notes, <strong>rests</strong> tell you when to be SILENT. Silence is a powerful musical tool!<br><br>üéµ <strong>Semibreve rest</strong> = 4 beats of silence ‚ñ¨<br>üéµ <strong>Minim rest</strong> = 2 beats of silence ‚ñ¨<br>üéµ <strong>Crotchet rest</strong> = 1 beat of silence ùÑΩ<br>üéµ <strong>Quaver rest</strong> = ¬Ω beat of silence ùÑæ<br><br>Rests create tension, suspense, and drama in music!`,
            visual:'ü§´' },
          { type:'try', heading:'Play with Rests!',
            body:`Try this pattern: <strong>C C _ C C _</strong> (where _ = 1 beat rest)<br><br>The rest makes the notes that follow sound MORE powerful! This technique is used in all great music.`,
            interactive:'beat_tap' },
          { type:'quiz', heading:'What is a rest in music? üåü',
            body:'A rest in music notation represents...',
            opts:['A very loud note','A break or period of silence üéØ','A repeated note','A high note'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'oct_58', title:'üóìÔ∏è October ‚Äî Expression & Performance', emoji:'üé≠', age:'Ages 5‚Äì8',
    color:'#FFA502', grad:'linear-gradient(135deg,#FFA502,#FF4757)',
    lessons:[
      {
        id:'oct_w1_58', title:'Week 1 ¬∑ Legato & Staccato', sub:'Smooth or detached playing!', emoji:'üîó',
        steps:[
          { type:'explain', heading:'Legato & Staccato! üîó',
            body:`Two important ways to play notes:<br><br><strong>Legato</strong> (smooth/connected) ‚Äî hold each note until the next one starts. The notes flow together like singing. Written as a curved line (slur) over the notes!<br><br><strong>Staccato</strong> (detached/short) ‚Äî press and quickly release each note. Short and bouncy! Marked with a dot above/below the note.`,
            visual:'üîó' },
          { type:'try', heading:'Play Legato vs Staccato!',
            body:`Play <strong>C D E F G</strong> very SMOOTH (legato) ‚Äî let each note ring into the next.<br><br>Now play the same notes SHORT and BOUNCY (staccato) ‚Äî press and quickly lift!<br><br>Hear the difference? üéµ`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'Staccato means... üåü',
            body:'Staccato notes should be played...',
            opts:['Smooth and connected','Short and detached üéØ','Very slowly','Very loudly'],
            answer:1 }
        ]
      },
      {
        id:'oct_w2_58', title:'Week 2 ¬∑ Tempo Markings', sub:'Allegro, Andante, Adagio!', emoji:'‚è±Ô∏è',
        steps:[
          { type:'explain', heading:'Tempo Markings ‚Äî Italian Speed Words! ‚è±Ô∏è',
            body:`Musicians use Italian words to describe tempo (speed):<br><br>üêá <strong>Allegro</strong> ‚Äî fast and lively (~120-168 BPM)<br>üö∂ <strong>Andante</strong> ‚Äî walking pace (~76-108 BPM)<br>üê¢ <strong>Adagio</strong> ‚Äî slow (~66-76 BPM)<br>üêå <strong>Largo</strong> ‚Äî very slow (~40-60 BPM)<br><br>Most Afrobeats songs are in the Allegro range ‚Äî fast and energetic!`,
            visual:'‚è±Ô∏è' },
          { type:'try', heading:'Play at Different Tempos!',
            body:`Use the metronome (‚ô© BPM slider in the Piano tab) to practice:<br><br>1. Set to 60 BPM ‚Üí play Twinkle (Adagio)<br>2. Set to 90 BPM ‚Üí play Twinkle (Andante)<br>3. Set to 120 BPM ‚Üí play Twinkle (Allegro)<br><br>Which feels most comfortable? üéπ`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Allegro means... üåü',
            body:'The tempo marking "Allegro" means the music should be...',
            opts:['Very slow','Walking pace','Fast and lively üéØ','Getting louder'],
            answer:2 }
        ]
      },
      {
        id:'oct_w3_58', title:'Week 3 ¬∑ Playing with Both Hands', sub:'Full coordination!', emoji:'ü§ù',
        steps:[
          { type:'explain', heading:'Both Hands Mastery! ü§ù',
            body:`By now, you\'ve practiced each hand separately. Let\'s combine them properly!<br><br>Key tips:<br>1. <strong>Slow is smooth, smooth is fast</strong> ‚Äî start very slow<br>2. Count out loud: "1 and 2 and 3 and 4 and"<br>3. When you can play it smoothly at slow tempo, THEN increase speed<br>4. If you make a mistake, slow down ‚Äî don\'t stop!`,
            visual:'ü§ù' },
          { type:'try', heading:'Two-Hand Twinkle!',
            body:`Right hand: Twinkle melody (C C G G A A G...)<br>Left hand: Hold low C for 4 beats, then change to G for 4 beats<br><br>Try it VERY slowly. When it\'s smooth, try a bit faster. üéØ`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'To get faster, you should first... üåü',
            body:'The best way to increase tempo (speed) in a piece is to...',
            opts:['Immediately play at full speed','Start slow and gradually increase speed only when comfortable üéØ','Skip practice and just try fast','Play loud to compensate'],
            answer:1 }
        ]
      },
      {
        id:'oct_w4_58', title:'Week 4 ¬∑ Simple Improvisation', sub:'Make up your own music!', emoji:'‚ú®',
        steps:[
          { type:'explain', heading:'Improvisation ‚Äî Make Up Music! ‚ú®',
            body:`<strong>Improvisation</strong> means making up music on the spot!<br><br>This is a BIG part of jazz, Highlife, and many traditional African musical styles.<br><br>The secret: use the notes of a scale and the music can\'t sound "wrong"! If you only play C D E F G A B, whatever you play will sound musical!`,
            visual:'‚ú®' },
          { type:'try', heading:'Improvise on the Piano!',
            body:`Choose any keys on the piano and play whatever you feel! Use <strong>C D E G A</strong> (the pentatonic scale ‚Äî the most natural-sounding 5 notes).<br><br>Try to:<br>- Start low and go high<br>- Use long and short notes<br>- Add rests (silence)<br><br>There are no wrong notes! üéµ`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Improvisation means... üåü',
            body:'When a musician improvises, they are...',
            opts:['Playing a memorised piece perfectly','Making up music spontaneously üéØ','Reading sheet music very carefully','Playing other composers\' music'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'nov_58', title:'üóìÔ∏è November ‚Äî Advanced Topics', emoji:'üéì', age:'Ages 5‚Äì8',
    color:'#A855F7', grad:'linear-gradient(135deg,#A855F7,#2ED573)',
    lessons:[
      {
        id:'nov_w1_58', title:'Week 1 ¬∑ Minor Scales', sub:'The sadder sound!', emoji:'üò¢',
        steps:[
          { type:'explain', heading:'The Minor Scale ‚Äî Sadder Sound! üò¢',
            body:`Major scales sound <strong>happy and bright</strong>. Minor scales sound <strong>sad, mysterious, or emotional</strong>!<br><br>The <strong>A Natural Minor scale</strong> is: A B C D E F G A<br><br>Notice it uses the same notes as C Major but starts on A! This gives it a completely different character.`,
            visual:'üò¢' },
          { type:'try', heading:'Play A Minor Scale!',
            body:`Play: <strong>A B C D E F G A</strong><br><br>Now compare to C Major: <strong>C D E F G A B C</strong><br><br>Do you hear the difference in feeling? Minor has a more melancholic, mysterious sound!`,
            interactive:'all_notes' },
          { type:'quiz', heading:'Minor scales sound... üåü',
            body:'Compared to major scales, minor scales tend to sound...',
            opts:['Brighter and happier','Sadder or more mysterious üéØ','Exactly the same','Faster always'],
            answer:1 }
        ]
      },
      {
        id:'nov_w2_58', title:'Week 2 ¬∑ Gospel & Highlife Rhythms', sub:'Naija music styles!', emoji:'üéµ',
        steps:[
          { type:'explain', heading:'Gospel & Highlife Piano Rhythms! üéµ',
            body:`Two of Nigeria\'s most loved music styles use piano beautifully:<br><br>‚õ™ <strong>Nigerian Gospel</strong> ‚Äî built on strong chords (C, F, G) with a joyful, uplifting feel. Think of artists like Sinach or Nathaniel Bassey.<br><br>üé∂ <strong>Highlife</strong> ‚Äî smooth, melodic, rhythmic ‚Äî originated in the 1920s, blending African rhythms with Western harmony.`,
            visual:'üéµ' },
          { type:'try', heading:'Play a Gospel Chord Progression!',
            body:`Try this classic gospel progression:<br><strong>C chord ‚Üí F chord ‚Üí C chord ‚Üí G chord ‚Üí C chord</strong><br><br>Strum each chord 4 times (like a beat). Add some soul ‚Äî make it bounce a little! ‚õ™üéµ`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'Highlife music originated in... üåü',
            body:'Highlife music was developed primarily in...',
            opts:['North America in 1960','West Africa (Nigeria/Ghana) in the 1920s üéØ','South Africa in 1950','Europe in 1900'],
            answer:1 }
        ]
      },
      {
        id:'nov_w3_58', title:'Week 3 ¬∑ Preparing for Performance', sub:'Get ready to shine!', emoji:'üåü',
        steps:[
          { type:'explain', heading:'Preparing for Performance! üåü',
            body:`Performing in front of others is one of the most exciting experiences a musician can have!<br><br>Here\'s how to prepare:<br>1. <strong>Choose a song you know well</strong> ‚Äî not too hard!<br>2. <strong>Practice it many times</strong> until it feels automatic<br>3. <strong>Practise performing</strong> ‚Äî pretend there\'s an audience!<br>4. <strong>Breathe</strong> ‚Äî if you feel nervous, take a deep breath before starting`,
            visual:'üåü' },
          { type:'try', heading:'Performance Rehearsal!',
            body:`Choose your BEST song. Now pretend you\'re performing at the National Theatre, Lagos! üé≠<br><br>Play it from start to finish WITHOUT stopping, even if you make a mistake. Real performers never stop!`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'What should you do if you make a mistake during a performance? üåü',
            body:'During a live performance, if you make a mistake you should...',
            opts:['Stop and start over','Apologise to the audience','Keep playing without stopping üéØ','Leave the stage'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'dec_58', title:'üóìÔ∏è December ‚Äî End of Year! üéÑ', emoji:'üéÑ', age:'Ages 5‚Äì8',
    color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FFD700)',
    lessons:[
      {
        id:'dec_w1_58', title:'Week 1 ¬∑ Jingle Bells!', sub:'Christmas favourite on the piano!', emoji:'üîî',
        steps:[
          { type:'explain', heading:'Jingle Bells ‚Äî Piano Version! üîî',
            body:`The full Jingle Bells on piano:<br><br>üéµ <strong>E E E ¬∑ E E E ¬∑ E G C D E</strong> ‚Äî "Jingle Bells, Jingle Bells, Jingle all the way"<br>üéµ <strong>F F F F F E E E E ¬∑ D D E D G</strong> ‚Äî "Oh what fun it is to ride in a one-horse open sleigh!"<br><br>Then the CHORUS which is more complex ‚Äî use both hands!`,
            visual:'üîî' },
          { type:'try', heading:'Play Jingle Bells!',
            body:`Play the verse first: <strong>E E E ¬∑ E E E ¬∑ E G C D E</strong><br><br>Then try adding the left hand: hold low C while playing the right hand melody!`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Jingle Bells uses mostly... üåü',
            body:'The verse of Jingle Bells mainly uses notes from which scale?',
            opts:['G Minor','A Major','C Major üéØ','F Major'],
            answer:2 }
        ]
      },
      {
        id:'dec_w2_58', title:'Week 2 ¬∑ Year Recap ‚Äî All Skills!', sub:'Everything you\'ve mastered!', emoji:'üèÜ',
        steps:[
          { type:'explain', heading:'Your Musical Year! üèÜ',
            body:`What an incredible year of learning! You\'ve covered:<br><br>üìñ Reading treble clef notes<br>üéµ Note values (‚ô© ùÖóùÖ• ùÖù ‚ô™)<br>üìä Time signatures (4/4, 3/4)<br>üîë Two scales: C Major and G Major (one sharp!)<br>üé∏ Chords: C, F, G<br>ü§ù Two-hand coordination<br>üé≠ Dynamics, legato, staccato<br>üåç Nigerian musical heritage<br><br>You\'re a <strong>PianoNaija All-Star!</strong> üåü`,
            visual:'üèÜ' },
          { type:'try', heading:'Grand Review Performance!',
            body:`For your end-of-year showcase, play this programme:<br>1. Twinkle Twinkle (both hands if possible)<br>2. Amazing Grace (with expression)<br>3. A song of YOUR choice<br><br>Stand up and bow when you finish! üôáüéâ`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'What have you achieved this year? üåü',
            body:'After this year of PianoNaija lessons, you can now...',
            opts:['Only play one note','Read basic sheet music, play chords, and perform songs üéØ','Only sing, not play','Nothing special'],
            answer:1 }
        ]
      },
      {
        id:'dec_w3_58', title:'Week 3 ¬∑ Looking Forward!', sub:'Your musical journey continues!', emoji:'üöÄ',
        steps:[
          { type:'explain', heading:'The Journey Continues! üöÄ',
            body:`You\'ve completed a full year of piano lessons! Next year, you\'ll explore:<br><br>üéπ More complex pieces and both-hand coordination<br>üîë More keys and scales<br>üìñ Reading more advanced sheet music<br>üéµ Composing your own music<br>üåç More African and world music styles<br><br><strong>Every great musician was once a beginner. Keep going ‚Äî your music matters! üåüüá≥üá¨</strong>`,
            visual:'üöÄ' },
          { type:'try', heading:'Final Free Play ‚Äî Express Yourself!',
            body:`For the very last lesson, there are no rules! Spend 10 minutes just PLAYING ‚Äî anything you want!<br><br>Explore the piano freely. Make up melodies. Play fast, play slow, play loud, play soft.<br><br>This is YOUR piano. Enjoy it! üéπ‚ú®`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'The C scale is: üåü',
            body:'The notes of the C Major scale in order are...',
            opts:['A B C D E F G','C D E F G A B üéØ','G A B C D E F','C D F G A B C'],
            answer:1 }
        ]
      }
    ]
  }
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AGES 8‚Äì10 FULL YEAR CURRICULUM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CURRICULUM_8_10 = [
  LEVEL1_SHARED,
  {
    id:'feb_810', title:'üóìÔ∏è February ‚Äî Music Theory Foundation', emoji:'üìê', age:'Ages 8‚Äì10',
    color:'#FFA502', grad:'linear-gradient(135deg,#FFA502,#FFD700)',
    lessons:[
      {
        id:'feb_w1_810', title:'Week 1 ¬∑ Scales & Intervals', sub:'Building blocks of all music!', emoji:'üìê',
        steps:[
          { type:'explain', heading:'The Major Scale Pattern üìê',
            body:`A <strong>scale</strong> uses a specific pattern of tones (T) and semitones (S).<br><br>The Major scale pattern is: <strong>T T S T T T S</strong><br><br>For C Major: C‚ÜíD (T) D‚ÜíE (T) E‚ÜíF (S) F‚ÜíG (T) G‚ÜíA (T) A‚ÜíB (T) B‚ÜíC (S)<br><br>This same T T S T T T S pattern works for building a major scale from ANY starting note!`,
            visual:'üìê' },
          { type:'explain', heading:'Intervals ‚Äî The Space Between Notes',
            body:`An <strong>interval</strong> is the distance between two notes:<br><br>Unison (same note), 2nd, 3rd, 4th, 5th, 6th, 7th, Octave<br><br>C to E = a <strong>Major 3rd</strong> (sounds happy)<br>C to E‚ô≠ = a <strong>Minor 3rd</strong> (sounds sad)<br>C to G = a <strong>Perfect 5th</strong> (sounds stable/powerful)`,
            visual:'üìè' },
          { type:'try', heading:'Play the C Major Scale & Identify Intervals!',
            body:`Play C Major: C D E F G A B C. Use proper fingering: 1 2 3 (thumb under) 1 2 3 4 5<br><br>Now play intervals: C+E (Major 3rd), C+G (Perfect 5th), C+A (Major 6th). Hear how each has a unique character!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'The Major Scale pattern is: üåü',
            body:'Every major scale follows the interval pattern...',
            opts:['T S T T S T T','T T S T T T S üéØ','S T T S T T T','T T T S T T S'],
            answer:1 }
        ]
      },
      {
        id:'feb_w2_810', title:'Week 2 ¬∑ Key Signatures', sub:'What key is the music in?', emoji:'üîë',
        steps:[
          { type:'explain', heading:'Key Signatures üîë',
            body:`A <strong>key signature</strong> appears at the start of each staff and tells you which notes are ALWAYS sharp or flat throughout.<br><br>‚ö™ <strong>C Major</strong> ‚Äî 0 sharps/flats<br>1# <strong>G Major</strong> ‚Äî F#<br>2# <strong>D Major</strong> ‚Äî F#, C#<br>3# <strong>A Major</strong> ‚Äî F#, C#, G#<br>1‚ô≠ <strong>F Major</strong> ‚Äî B‚ô≠<br>2‚ô≠ <strong>B‚ô≠ Major</strong> ‚Äî B‚ô≠, E‚ô≠`,
            visual:'üîë' },
          { type:'explain', heading:'The Circle of Fifths',
            body:`Key signatures follow a pattern called the <strong>Circle of Fifths</strong>:<br><br>C ‚Üí G ‚Üí D ‚Üí A ‚Üí E (each adds one sharp)<br>C ‚Üí F ‚Üí B‚ô≠ ‚Üí E‚ô≠ ‚Üí A‚ô≠ (each adds one flat)<br><br>This circle is one of the most important concepts in all of music theory! Professional musicians know it by heart.`,
            visual:'üéº' },
          { type:'quiz', heading:'G Major has how many sharps? üåü',
            body:'The key of G Major has...',
            opts:['0 sharps','1 sharp (F#) üéØ','2 sharps','3 sharps'],
            answer:1 }
        ]
      },
      {
        id:'feb_w3_810', title:'Week 3 ¬∑ Triads & Chord Construction', sub:'Build any chord from scratch!', emoji:'üèóÔ∏è',
        steps:[
          { type:'explain', heading:'Chord Construction üèóÔ∏è',
            body:`A <strong>triad</strong> uses the 1st, 3rd, and 5th notes of a scale.<br><br>Types of triads:<br>üü° <strong>Major triad</strong>: Major 3rd + Minor 3rd (sounds happy) ‚Äî e.g. C+E+G<br>üîµ <strong>Minor triad</strong>: Minor 3rd + Major 3rd (sounds sad) ‚Äî e.g. A+C+E<br>üî¥ <strong>Diminished</strong>: Minor 3rd + Minor 3rd (sounds tense) ‚Äî e.g. B+D+F<br>üü¢ <strong>Augmented</strong>: Major 3rd + Major 3rd (sounds unsettling)`,
            visual:'üèóÔ∏è' },
          { type:'try', heading:'Build Chords!',
            body:`Practice these chords (both hands separately first):<br>üü° <strong>C Major</strong>: C + E + G<br>üîµ <strong>A Minor</strong>: A + C + E<br>üî¥ <strong>B Diminished</strong>: B + D + F<br><br>Play each and listen carefully to the emotional quality!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'A Minor triad consists of: üåü',
            body:'The A Minor triad uses which three notes?',
            opts:['A B C','A C E üéØ','A C# E','A B E'],
            answer:1 }
        ]
      },
      {
        id:'feb_w4_810', title:'Week 4 ¬∑ Chord Progressions', sub:'The I-IV-V-I foundation!', emoji:'üî¢',
        steps:[
          { type:'explain', heading:'Chord Progressions! üî¢',
            body:`Chords are numbered using Roman numerals based on their scale degree:<br><br>In C Major:<br><strong>I</strong> = C Major ¬∑ <strong>II</strong> = D Minor ¬∑ <strong>III</strong> = E Minor<br><strong>IV</strong> = F Major ¬∑ <strong>V</strong> = G Major ¬∑ <strong>VI</strong> = A Minor<br><br>The most important progression in Western music: <strong>I ‚Üí IV ‚Üí V ‚Üí I</strong><br>(C ‚Üí F ‚Üí G ‚Üí C)<br><br>This is used in gospel, blues, pop, Afrobeats ‚Äî everywhere!`,
            visual:'üî¢' },
          { type:'try', heading:'Play the I-IV-V-I Progression!',
            body:`Left hand chords, 4 beats each:<br><strong>C chord (I)</strong> √ó 4 beats ‚Üí <strong>F chord (IV)</strong> √ó 4 beats ‚Üí <strong>G chord (V)</strong> √ó 4 beats ‚Üí <strong>C chord (I)</strong> √ó 4 beats<br><br>Feel the tension and resolution? V‚ÜíI is the most satisfying sound in music!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'In C Major, the V chord is: üåü',
            body:'In the key of C Major, the "V chord" (five chord) is...',
            opts:['F Major','C Major','E Minor','G Major üéØ'],
            answer:3 }
        ]
      }
    ]
  },
  {
    id:'mar_810', title:'üóìÔ∏è March ‚Äî Advanced Piano Technique', emoji:'üéπ', age:'Ages 8‚Äì10',
    color:'#2ED573', grad:'linear-gradient(135deg,#2ED573,#00C853)',
    lessons:[
      {
        id:'mar_w1_810', title:'Week 1 ¬∑ Scales in All Major Keys', sub:'Explore D, G, F and more!', emoji:'üåç',
        steps:[
          { type:'explain', heading:'Scales in Multiple Keys! üåç',
            body:`Now that you know the T T S T T T S pattern, you can build a major scale from ANY note!<br><br><strong>G Major</strong>: G A B C D E F# G (1 sharp)<br><strong>D Major</strong>: D E F# G A B C# D (2 sharps)<br><strong>F Major</strong>: F G A B‚ô≠ C D E F (1 flat)<br><br>Each key has its own unique colour and feel!`,
            visual:'üåç' },
          { type:'try', heading:'Play G Major & D Major Scales!',
            body:`<strong>G Major</strong>: G(1) A(2) B(3) ‚Äî thumb under ‚Äî C(1) D(2) E(3) F#(4) G(5)<br><br><strong>D Major</strong>: D(1) E(2) F#(3) ‚Äî thumb under ‚Äî G(1) A(2) B(3) C#(4) D(5)<br><br>Go slowly and use correct fingering! üéπ`,
            interactive:'all_notes' },
          { type:'quiz', heading:'D Major has how many sharps? üåü',
            body:'The key of D Major has how many sharps and which ones?',
            opts:['1 sharp (F#)','2 sharps (F#, C#) üéØ','3 sharps','0 sharps'],
            answer:1 }
        ]
      },
      {
        id:'mar_w2_810', title:'Week 2 ¬∑ Arpeggios', sub:'Broken chords for beautiful texture!', emoji:'üåä',
        steps:[
          { type:'explain', heading:'Arpeggios ‚Äî Broken Chords! üåä',
            body:`An <strong>arpeggio</strong> is a chord played one note at a time, rolling upward or downward like a wave üåä<br><br>Instead of pressing C+E+G together (chord), play: C ‚Üí E ‚Üí G ‚Üí C (ascending arpeggio)<br><br>Arpeggios are used in:<br>üéµ Classical piano pieces<br>üéµ Ballads and love songs<br>üéµ Highlife and Afrobeats intros<br>üéµ Gospel worship music`,
            visual:'üåä' },
          { type:'try', heading:'Play C Major Arpeggio!',
            body:`Right hand: <strong>C(1) ‚Üí E(2) ‚Üí G(3) ‚Üí C(5)</strong> going UP<br>Then down: <strong>C(5) ‚Üí G(3) ‚Üí E(2) ‚Üí C(1)</strong><br><br>Keep it smooth and even ‚Äî no note should be louder than others!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'An arpeggio is: üåü',
            body:'An arpeggio is a...',
            opts:['Chord played all at once','Chord played one note at a time üéØ','A type of scale','A tempo marking'],
            answer:1 }
        ]
      },
      {
        id:'mar_w3_810', title:'Week 3 ¬∑ Two-Hand Coordination', sub:'Full independence!', emoji:'ü§ù',
        steps:[
          { type:'explain', heading:'True Two-Hand Independence! ü§ù',
            body:`Advanced two-hand playing means each hand does something <strong>completely different</strong> at the same time!<br><br>üñêÔ∏è Right hand: plays melody (Twinkle)<br>ü§ö Left hand: plays bass pattern (chord root on beat 1, 3)<br><br>This requires the brain to multi-task ‚Äî it\'s like patting your head and rubbing your stomach simultaneously!`,
            visual:'ü§ù' },
          { type:'try', heading:'Two-Hand Exercise!',
            body:`Right hand: <strong>C C G G A A G</strong> (Twinkle opening)<br>Left hand: <strong>C ¬∑ ¬∑ ¬∑ G ¬∑ ¬∑ ¬∑</strong> (press C on beat 1, G on beat 5)<br><br>Start at 60 BPM. Increase ONLY when it\'s smooth!`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'Why is two-hand piano difficult? üåü',
            body:'Two-hand piano is challenging because...',
            opts:['The piano is too big','Each hand must do different things simultaneously üéØ','You need bigger hands','The notes are hard to reach'],
            answer:1 }
        ]
      },
      {
        id:'mar_w4_810', title:'Week 4 ¬∑ Reading Rhythms', sub:'Complex rhythmic notation!', emoji:'ü•Å',
        steps:[
          { type:'explain', heading:'Advanced Rhythm Reading! ü•Å',
            body:`Beyond basic note values, music uses:<br><br>‚ô©. <strong>Dotted crotchet</strong> = 1¬Ω beats (dot adds half of the note value)<br>‚ô©‚ô©‚ô© <strong>Triplets</strong> = 3 notes in the time of 2<br>‚Å∏‚ô™ <strong>Semiquavers</strong> = ¬º beat each (4 per crotchet beat)<br>üîó <strong>Ties</strong> = hold a note across the beat<br>ùÑΩ <strong>Syncopation</strong> = accenting off-beats (key in Afrobeats!)`,
            visual:'ü•Å' },
          { type:'try', heading:'Clap Syncopated Rhythms!',
            body:`Clap this Afrobeats-style rhythm:<br>"1 AND 2 AND 3 AND 4 AND"<br>Accent the "AND" beats (off-beats): clap on 1, then on "AND" of 2, then on 3...<br><br>This syncopation is what makes Nigerian music groove! üá≥üá¨`,
            interactive:'beat_tap' },
          { type:'quiz', heading:'A dotted crotchet equals: üåü',
            body:'A dotted crotchet (‚ô©.) has a duration of...',
            opts:['1 beat','1.5 beats üéØ','2 beats','0.5 beats'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'apr_810', title:'üóìÔ∏è April ‚Äî Harmony & Advanced Chords', emoji:'üé∂', age:'Ages 8‚Äì10',
    color:'#1E90FF', grad:'linear-gradient(135deg,#1E90FF,#A855F7)',
    lessons:[
      {
        id:'apr_w1_810', title:'Week 1 ¬∑ 7th Chords', sub:'Adding richness to harmony!', emoji:'7Ô∏è‚É£',
        steps:[
          { type:'explain', heading:'7th Chords ‚Äî Rich Harmony! 7Ô∏è‚É£',
            body:`A <strong>7th chord</strong> adds a 4th note (the 7th scale degree) to a triad:<br><br>üéµ <strong>C Major 7 (Cmaj7)</strong> = C + E + G + B (beautiful, jazz-like)<br>üéµ <strong>G Dominant 7 (G7)</strong> = G + B + D + F (creates tension, resolves to C!)<br>üéµ <strong>D Minor 7 (Dm7)</strong> = D + F + A + C (smooth, jazz/gospel feel)<br><br>7th chords are used EVERYWHERE in gospel, jazz, and Afrobeats!`,
            visual:'7Ô∏è‚É£' },
          { type:'try', heading:'Play the Cmaj7 and G7!',
            body:`<strong>Cmaj7</strong>: C(1) + E(2) + G(3) + B(4) ‚Äî all four fingers!<br><br><strong>G7</strong>: G + B + D + F ‚Äî notice F is natural (not F#)!<br><br>Now try: Cmaj7 ‚Üí Dm7 ‚Üí G7 ‚Üí Cmaj7. This is the Jazz ii-V-I progression!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'G7 chord includes which extra note over G Major? üåü',
            body:'The G7 chord adds which note to the G Major triad (G B D)?',
            opts:['A','C','E','F üéØ'],
            answer:3 }
        ]
      },
      {
        id:'apr_w2_810', title:'Week 2 ¬∑ Chord Inversions', sub:'Same chord, different position!', emoji:'üîÑ',
        steps:[
          { type:'explain', heading:'Chord Inversions üîÑ',
            body:`A <strong>chord inversion</strong> rearranges the notes of a chord so a note other than the root is on the bottom.<br><br>C Major chord (Root position): C E G<br><strong>1st inversion</strong>: E G C (E on bottom)<br><strong>2nd inversion</strong>: G C E (G on bottom)<br><br>Inversions allow smooth voice leading ‚Äî instead of jumping between chords, notes move by step!`,
            visual:'üîÑ' },
          { type:'try', heading:'Practice Chord Inversions!',
            body:`Play C Major in all positions:<br>Root: <strong>C E G</strong><br>1st inversion: <strong>E G C</strong><br>2nd inversion: <strong>G C E</strong><br><br>Now move from C (root) ‚Üí F (2nd inversion = C F A) ‚Äî notice C stays in the hand! That\'s smooth voice leading.`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'In 1st inversion of C Major, the bottom note is: üåü',
            body:'The first inversion of C Major chord (C E G) has which note at the bottom?',
            opts:['C','G','E üéØ','B'],
            answer:2 }
        ]
      },
      {
        id:'apr_w3_810', title:'Week 3 ¬∑ Gospel & Afrobeats Chord Language', sub:'Nigerian harmonic style!', emoji:'üá≥üá¨',
        steps:[
          { type:'explain', heading:'Nigerian Gospel & Afrobeats Harmony! üá≥üá¨',
            body:`Nigerian music has its own harmonic flavour!<br><br>‚õ™ <strong>Gospel</strong>: heavy use of IV chord (subdominant), frequent key changes, shouting dynamics, call-and-response.<br><br>üéµ <strong>Afrobeats</strong>: often uses 2-bar or 4-bar chord loops. Common progression: <strong>I - IV - I - V</strong> (or I - VI - IV - V).<br><br>Artists like Burna Boy, Wizkid, and Davido all use variations of these chord ideas!`,
            visual:'üá≥üá¨' },
          { type:'try', heading:'Play an Afrobeats Chord Loop!',
            body:`Try this 4-bar Afrobeats loop (4 beats each):<br><strong>Am ‚Üí F ‚Üí C ‚Üí G</strong> (vi - IV - I - V)<br><br>This is one of the most common chord progressions in modern pop and Afrobeats! You\'ll recognize it in many songs.`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'The vi-IV-I-V progression in C Major is: üåü',
            body:'In C Major, the progression Am - F - C - G uses which Roman numerals?',
            opts:['I-II-III-IV','vi-IV-I-V üéØ','I-V-vi-IV','II-IV-VI-I'],
            answer:1 }
        ]
      },
      {
        id:'apr_w4_810', title:'Week 4 ¬∑ Sight-Reading Basics', sub:'Play music you\'ve never seen before!', emoji:'üëÄ',
        steps:[
          { type:'explain', heading:'Sight-Reading ‚Äî A Musician\'s Superpower! üëÄ',
            body:`<strong>Sight-reading</strong> is the ability to play music you\'ve NEVER seen before, just by looking at the notation.<br><br>Tips for good sight-reading:<br>1. <strong>Look ahead</strong> ‚Äî always read 2-3 notes ahead of what you\'re playing<br>2. <strong>Keep a steady beat</strong> ‚Äî don\'t stop for mistakes!<br>3. <strong>Identify the key signature first</strong><br>4. <strong>Note the time signature and tempo</strong><br>5. <strong>Scan for difficult passages</strong> before starting`,
            visual:'üëÄ' },
          { type:'try', heading:'Sight-Read the Sheet Display!',
            body:`Look at the staff display below. Identify:<br>1. The clef (treble!)<br>2. The note position (E is on the first line)<br>3. Now find E on the piano and play it!<br><br>This is the beginning of sight-reading! üéµ`,
            interactive:'staff_display' },
          { type:'quiz', heading:'The first rule of sight-reading is: üåü',
            body:'The most important rule when sight-reading music is...',
            opts:['Play every note perfectly','Never make mistakes','Keep the beat going ‚Äî don\'t stop for mistakes üéØ','Play very slowly always'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'may_810', title:'üóìÔ∏è May ‚Äî Performance & Expression', emoji:'üé≠', age:'Ages 8‚Äì10',
    color:'#A855F7', grad:'linear-gradient(135deg,#A855F7,#FF4FA3)',
    lessons:[
      {
        id:'may_w1_810', title:'Week 1 ¬∑ Phrasing & Musicality', sub:'Play like you\'re telling a story!', emoji:'üìñ',
        steps:[
          { type:'explain', heading:'Musical Phrasing ‚Äî Tell a Story! üìñ',
            body:`A <strong>phrase</strong> in music is like a sentence in a story ‚Äî it has a beginning, a peak, and a resolution.<br><br>Most phrases are <strong>4 or 8 bars</strong> long. Within a phrase:<br>- Start softly (mp)<br>- Build to the peak (climax)<br>- Resolve to softer (p)<br><br>This natural "breathing" shape is what makes music feel human and alive, not robotic!`,
            visual:'üìñ' },
          { type:'try', heading:'Play a Musical Phrase!',
            body:`Play Twinkle\'s opening phrase (C C G G A A G - F F E E D D C).<br><br>Apply phrasing:<br>- "Twinkle twinkle" ‚Üí medium (mp)<br>- "little STAR" ‚Üí slightly louder (mf) ‚Äî peak!<br>- "How I wonder what you are" ‚Üí softer (p) ‚Äî resolution<br><br>Feel the difference! üéµ`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'A musical phrase is like: üåü',
            body:'In music, a phrase is best compared to...',
            opts:['A single note','A sentence in a story (beginning, peak, resolution) üéØ','A very loud section','The time signature'],
            answer:1 }
        ]
      },
      {
        id:'may_w2_810', title:'Week 2 ¬∑ Ornaments & Embellishments', sub:'Grace notes, trills and more!', emoji:'‚ú®',
        steps:[
          { type:'explain', heading:'Musical Ornaments! ‚ú®',
            body:`<strong>Ornaments</strong> are decorations added to notes to make music more expressive:<br><br>üéµ <strong>Grace note</strong>: a very quick small note before the main note<br>üéµ <strong>Trill (~)</strong>: rapidly alternating between two adjacent notes<br>üéµ <strong>Mordent</strong>: quickly go to the note above and back<br>üéµ <strong>Turn</strong>: play note above, note itself, note below, note itself<br><br>Ornaments are common in Baroque, Classical, and Nigerian traditional music!`,
            visual:'‚ú®' },
          { type:'try', heading:'Try a Trill!',
            body:`A trill between E and F:<br>Play: E F E F E F E (very quickly!)<br><br>Start slowly: E-F E-F E-F...<br>Then gradually speed up until it blurs together!<br><br>Trills add excitement and sparkle to music! ‚ú®`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'A trill is: üåü',
            body:'A trill (~) in music means...',
            opts:['A very loud note','A slow held note','Rapidly alternating between two adjacent notes üéØ','A rest'],
            answer:2 }
        ]
      },
      {
        id:'may_w3_810', title:'Week 3 ¬∑ Scale Practice in Both Hands', sub:'Hands together on scales!', emoji:'ü§ù',
        steps:[
          { type:'explain', heading:'Scales with Both Hands! ü§ù',
            body:`Playing scales with both hands simultaneously is a core piano skill. Both hands play the same scale but:<br><br>- In <strong>parallel motion</strong>: both hands move in the same direction at the same time<br>- Or in <strong>contrary motion</strong>: hands move in opposite directions (one goes up while other goes down)<br><br>Contrary motion is actually EASIER to start with!`,
            visual:'ü§ù' },
          { type:'try', heading:'Contrary Motion C Scale!',
            body:`Starting with both thumbs on Middle C:<br>Right hand goes UP: C D E F G A B C<br>Left hand goes DOWN: C B A G F E D C<br><br>They mirror each other! Both thumbs start together and move apart symmetrically. Try it slowly!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'In contrary motion, the hands: üåü',
            body:'In "contrary motion" scale practice, the two hands...',
            opts:['Both go upward','Both go downward','Move in opposite directions simultaneously üéØ','Play different scales'],
            answer:2 }
        ]
      },
      {
        id:'may_w4_810', title:'Week 4 ¬∑ Repertoire Building', sub:'Build your personal piece list!', emoji:'üìã',
        steps:[
          { type:'explain', heading:'Building Your Repertoire! üìã',
            body:`A musician\'s <strong>repertoire</strong> is the collection of pieces they can perform confidently!<br><br>Good repertoire for Ages 8-10 includes:<br>‚≠ê 2-3 pieces you can play from MEMORY<br>‚≠ê Mix of styles (classical, Nigerian, gospel, pop)<br>‚≠ê A slow piece, a fast piece, an expressive piece<br><br>Building repertoire means reviewing OLD pieces while learning NEW ones!`,
            visual:'üìã' },
          { type:'try', heading:'Choose Your 3 Repertoire Pieces!',
            body:`From the Piano tab, choose 3 songs that you want to master for your repertoire.<br><br>Play each one and rate yourself: 1-5 stars. A piece is "repertoire ready" when you can play it from start to finish with no stops, good dynamics, and musical expression!`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'Repertoire means: üåü',
            body:'A musician\'s repertoire is...',
            opts:['Their collection of sheet music books','The set of pieces they can perform confidently from memory üéØ','Only classical music pieces','Their favourite songs to listen to'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'jun_810', title:'üóìÔ∏è June ‚Äî Theory Depth & Composition', emoji:'üéº', age:'Ages 8‚Äì10',
    color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FFA502)',
    lessons:[
      {
        id:'jun_w1_810', title:'Week 1 ¬∑ Minor Scales & Modes', sub:'Aeolian, Dorian, Mixolydian!', emoji:'üåë',
        steps:[
          { type:'explain', heading:'Minor Scales & Modes! üåë',
            body:`Beyond natural minor, there are two more minor scale types:<br><br>üåë <strong>Natural Minor</strong>: A B C D E F G A (relative of C Major)<br>üåí <strong>Harmonic Minor</strong>: raises the 7th (A B C D E F G# A) ‚Äî used in gospel and classical<br>üåì <strong>Melodic Minor</strong>: raises 6th and 7th going up (A B C D E F# G# A), natural minor going down<br><br>Church modes (Dorian, Mixolydian) are also important in African and jazz music!`,
            visual:'üåë' },
          { type:'try', heading:'Play A Harmonic Minor!',
            body:`A Harmonic Minor: <strong>A B C D E F G# A</strong><br><br>Notice the G# (G sharp ‚Äî play the black key)! This raised 7th creates a dramatic, tense sound commonly used in gospel and Middle Eastern-influenced music.`,
            interactive:'all_notes' },
          { type:'quiz', heading:'Harmonic minor raises the: üåü',
            body:'The harmonic minor scale differs from natural minor by raising which degree?',
            opts:['3rd degree','5th degree','6th degree','7th degree üéØ'],
            answer:3 }
        ]
      },
      {
        id:'jun_w2_810', title:'Week 2 ¬∑ Composition Basics', sub:'Write your own music!', emoji:'‚úçÔ∏è',
        steps:[
          { type:'explain', heading:'Composing Your Own Music! ‚úçÔ∏è',
            body:`Every piece of music started as someone\'s idea. You can compose too!<br><br>Steps to compose a melody:<br>1. <strong>Choose a key</strong> (let\'s use C Major)<br>2. <strong>Pick a time signature</strong> (4/4 is easiest)<br>3. <strong>Create a short 4-bar phrase</strong> using C D E F G<br>4. <strong>Repeat or vary the phrase</strong> for 4 more bars<br>5. <strong>End on C</strong> ‚Äî that\'s a musical "full stop"!`,
            visual:'‚úçÔ∏è' },
          { type:'try', heading:'Compose Your First Melody!',
            body:`Using only <strong>C D E F G</strong>, make up a 4-bar tune!<br><br>Rules:<br>- 4 beats per bar<br>- Use some long and some short notes<br>- End your tune on C<br><br>Press the record button üî¥ in the Piano tab to capture it! Play it back and listen. You\'re a composer! üéº`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'A good melody usually ends on: üåü',
            body:'To create a sense of "rest" or "completion", a melody usually ends on the...',
            opts:['5th degree (G in C Major)','7th degree','1st degree / root note üéØ','Any random note'],
            answer:2 }
        ]
      },
      {
        id:'jun_w3_810', title:'Week 3 ¬∑ Song Analysis', sub:'Understand the music you play!', emoji:'üîç',
        steps:[
          { type:'explain', heading:'Music Analysis! üîç',
            body:`Understanding WHY music works makes you a better musician!<br><br>When you listen to or play a song, identify:<br>üîç <strong>Key</strong> ‚Äî what key is it in?<br>üïê <strong>Time signature</strong> ‚Äî 4/4? 3/4?<br>üé∏ <strong>Chord progression</strong> ‚Äî I-IV-V? vi-IV-I-V?<br>üìä <strong>Form</strong> ‚Äî verse/chorus? AABA? ABAB?<br>üîä <strong>Dynamics</strong> ‚Äî how does the volume change?`,
            visual:'üîç' },
          { type:'try', heading:'Analyse Twinkle Twinkle!',
            body:`Let\'s analyse Twinkle Twinkle Little Star:<br>‚úÖ Key: C Major (no sharps/flats)<br>‚úÖ Time signature: 4/4<br>‚úÖ Main chords used: C, F, G (I, IV, V)<br>‚úÖ Form: AABB (two sections, each repeated)<br>‚úÖ Range: C4 to G4<br><br>Now play it again with this knowledge ‚Äî do you hear it differently?`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'Twinkle Twinkle is in which key? üåü',
            body:'Based on its notes (C D E F G A), Twinkle Twinkle is primarily in the key of...',
            opts:['G Major','F Major','C Major üéØ','A Minor'],
            answer:2 }
        ]
      },
      {
        id:'jun_w4_810', title:'Week 4 ¬∑ Mid-Year Recital!', sub:'Performance showcase!', emoji:'üé≠',
        steps:[
          { type:'explain', heading:'Mid-Year Recital! üé≠',
            body:`You\'ve covered so much ‚Äî theory, technique, harmony, and expression! Time to show it off!<br><br>For your mid-year recital, plan:<br>üìã 3 pieces (slow, medium, fast)<br>üé§ Brief introduction for each piece<br>üôá A bow at the end<br><br>A recital is a formal performance ‚Äî it builds confidence and shows your progress!`,
            visual:'üé≠' },
          { type:'try', heading:'Final Rehearsal!',
            body:`Play your 3 recital pieces back to back without stopping between them.<br><br>Pretend there\'s an audience at Terra Kulture in Lagos watching! üé≠üá≥üá¨<br><br>Remember: posture, curved fingers, dynamics, expression, and ‚Äî most importantly ‚Äî ENJOY it!`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'A recital is: üåü',
            body:'A music recital is...',
            opts:['A private practice session','A formal public performance to showcase learning üéØ','Only for professional musicians','A theory test'],
            answer:1 }
        ]
      }
    ]
  },
  {
    id:'sep_810', title:'üóìÔ∏è September ‚Äî Advanced Pieces', emoji:'üéì', age:'Ages 8‚Äì10',
    color:'#2ED573', grad:'linear-gradient(135deg,#2ED573,#1E90FF)',
    lessons:[
      {
        id:'sep_w1_810', title:'Week 1 ¬∑ Baroque Style', sub:'Bach and the classical masters!', emoji:'üëë',
        steps:[
          { type:'explain', heading:'Baroque Music! üëë',
            body:`The <strong>Baroque period</strong> (1600‚Äì1750) produced some of the most famous music ever written!<br><br>Key features of Baroque style:<br>üéπ <strong>Polyphony</strong> ‚Äî multiple independent melodic lines<br>üìè <strong>Strict rhythm</strong> ‚Äî steady, clock-like beat<br>‚ú® <strong>Ornaments</strong> ‚Äî trills, mordents everywhere<br>üéπ <strong>Harpsichord</strong> ‚Äî the main keyboard instrument (piano wasn\'t invented yet!)<br><br>Johann Sebastian Bach is the greatest Baroque composer!`,
            visual:'üëë' },
          { type:'try', heading:'Play Bach-Style Sequence!',
            body:`A sequence (pattern that repeats at different pitches) in Bach\'s style:<br><strong>C E G - D F A - E G B - F A C</strong><br><br>This ascending sequence sounds very Baroque! Repeat it at different speeds.`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'The Baroque period lasted from: üåü',
            body:'The Baroque musical period is approximately...',
            opts:['1400-1550','1600-1750 üéØ','1750-1820','1820-1900'],
            answer:1 }
        ]
      },
      {
        id:'sep_w2_810', title:'Week 2 ¬∑ Pentatonic & African Scales', sub:'The global musical language!', emoji:'üåç',
        steps:[
          { type:'explain', heading:'Pentatonic Scale ‚Äî Universal Music! üåç',
            body:`The <strong>pentatonic scale</strong> has only 5 notes and is found in music from EVERY culture worldwide ‚Äî including Nigeria!<br><br><strong>Major pentatonic</strong> (C D E G A) = C Major without F and B<br><br>Why is it universal? It contains no "avoid" notes ‚Äî everything harmonizes beautifully! Used in:<br>üåç African traditional music<br>üéµ Blues and jazz<br>üéπ Pop and Afrobeats<br>üéé Chinese, Indian music`,
            visual:'üåç' },
          { type:'try', heading:'Play the Major Pentatonic!',
            body:`C Major Pentatonic: <strong>C D E G A</strong> (skip F and B!)<br><br>Improvise using ONLY these 5 notes. You cannot make it sound "wrong"!<br><br>This is the scale used in many African melodies ‚Äî feel the groove! üåç`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'The major pentatonic scale has: üåü',
            body:'The major pentatonic scale consists of how many different notes?',
            opts:['7 notes','8 notes','5 notes üéØ','12 notes'],
            answer:2 }
        ]
      },
      {
        id:'sep_w3_810', title:'Week 3 ¬∑ Amazing Grace ‚Äî Advanced Version', sub:'Full performance with dynamics!', emoji:'üôè',
        steps:[
          { type:'explain', heading:'Amazing Grace ‚Äî Advanced! üôè',
            body:`Amazing Grace is in <strong>F Major</strong> (one flat: B‚ô≠) and <strong>3/4 time</strong>.<br><br>Advanced performance elements:<br>üîä Start with <strong>p</strong> (soft)<br>üìà Build with <strong>cresc.</strong> to "the hour I first believed"<br>üîâ Return to <strong>mp</strong> for second verse<br>‚úã Left hand: alternating bass (bass note on beat 1, chord on 2-3)<br>üéµ Right hand: expressive legato melody`,
            visual:'üôè' },
          { type:'try', heading:'Play Amazing Grace with Full Expression!',
            body:`Select Amazing Grace in the Piano tab. Play it with:<br>- <strong>Soft, singing tone</strong> (p-mp)<br>- <strong>Gradual crescendo</strong> to the end of each phrase<br>- <strong>Slowing down</strong> (ritardando) at the very end<br><br>Imagine you\'re playing in a big church! üôè`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Amazing Grace is in which key? üåü',
            body:'Amazing Grace (using notes C F A B‚ô≠) is primarily in the key of...',
            opts:['C Major','G Major','F Major üéØ','D Minor'],
            answer:2 }
        ]
      },
      {
        id:'sep_w4_810', title:'Week 4 ¬∑ Chord Chart Reading', sub:'Read chord charts like a pro!', emoji:'üìä',
        steps:[
          { type:'explain', heading:'Chord Charts ‚Äî The Musician\'s Shorthand! üìä',
            body:`<strong>Chord charts</strong> are simplified notation showing just the chord names and rhythm. Widely used in pop, gospel, and Afrobeats!<br><br>How to read them:<br>üéµ Each chord name = one bar (or specified number of beats)<br>üéµ / = repeat previous chord for another beat<br>üéµ | = bar line<br><br>Example: <strong>| C / / / | F / / / | G / / / | C / / / |</strong><br>= I - IV - V - I progression!`,
            visual:'üìä' },
          { type:'try', heading:'Play from a Chord Chart!',
            body:`Read and play this chart (4 beats per chord):<br><strong>Am - F - C - G</strong> (vi - IV - I - V)<br><br>Left hand: bass note of each chord (A, F, C, G)<br>Right hand: full chord or melody over it<br><br>This is how session musicians in Lagos work! üéµüá≥üá¨`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'In a chord chart, "/" means: üåü',
            body:'In chord chart notation, a "/" (slash) means...',
            opts:['Rest for one beat','Play a different chord','Repeat the previous chord for one beat üéØ','End of the song'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'oct_810', title:'üóìÔ∏è October ‚Äî Musicianship Skills', emoji:'üéì', age:'Ages 8‚Äì10',
    color:'#FFA502', grad:'linear-gradient(135deg,#FFA502,#FF4757)',
    lessons:[
      {
        id:'oct_w1_810', title:'Week 1 ¬∑ Ear Training', sub:'Train your musical ear!', emoji:'üëÇ',
        steps:[
          { type:'explain', heading:'Ear Training ‚Äî The Most Important Skill! üëÇ',
            body:`A trained musical ear can:<br><br>üéµ Identify notes and chords by sound alone<br>üéµ Recognise intervals (Major 3rd, Perfect 5th, etc.)<br>üéµ Tell if music is in a major or minor key<br>üéµ Hear rhythms and reproduce them<br><br>This is called <strong>aural training</strong>. The best musicians have exceptional ears ‚Äî they can transcribe (write down) music just by listening!`,
            visual:'üëÇ' },
          { type:'try', heading:'Interval Recognition!',
            body:`Listen to these interval patterns and try to identify them:<br><br>Play C then E (Major 3rd) ‚Äî sounds like "Doh Mi" ‚Äî happy!<br>Play C then E‚ô≠ (Minor 3rd) ‚Äî sounds like "Doh Me" ‚Äî sadder<br>Play C then G (Perfect 5th) ‚Äî sounds like "Twinkle Twinkle"<br><br>Can you hear the difference? üëÇ`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Perfect 5th interval sounds like: üåü',
            body:'The interval of a Perfect 5th (C to G) is famously the opening of...',
            opts:['Happy Birthday','Mary Had a Little Lamb','Twinkle Twinkle Little Star üéØ','Amazing Grace'],
            answer:2 }
        ]
      },
      {
        id:'oct_w2_810', title:'Week 2 ¬∑ Music History ‚Äî African Music', sub:'Our rich musical heritage!', emoji:'üåç',
        steps:[
          { type:'explain', heading:'African Music History! üåç',
            body:`African music is one of the oldest and most influential in the world!<br><br>ü•Å <strong>Rhythm is central</strong> ‚Äî polyrhythm (multiple rhythms at once) is distinctly African<br>üé∫ <strong>Call and response</strong> ‚Äî leader sings, group responds ‚Äî found in church, work songs, and griot traditions<br>üéµ <strong>Griot tradition</strong> ‚Äî West African storyteller-musicians who preserve oral history<br>üåç African music influenced jazz, blues, reggae, Afrobeats, and more!`,
            visual:'üåç' },
          { type:'explain', heading:'Nigerian Music Timeline',
            body:`üå∫ Pre-colonial: Traditional drum ensembles, talking drum (D√πnd√∫n), Ogene bell<br>üé∑ 1920s-60s: Highlife emerges ‚Äî fusion of African rhythms + Western harmony<br>üé§ 1970s-80s: Fela Kuti creates Afrobeat (with jazz, funk, African roots)<br>üéµ 2000s-today: Afrobeats global explosion ‚Äî Wizkid, Burna Boy, Davido on world stages<br>üéπ Piano plays a key role in modern Nigerian studio production!`,
            visual:'üá≥üá¨' },
          { type:'quiz', heading:'Polyrhythm is characteristic of: üåü',
            body:'Polyrhythm (multiple simultaneous rhythms) is a defining feature of...',
            opts:['European classical music only','African music traditions üéØ','Modern electronic music only','Only jazz'],
            answer:1 }
        ]
      },
      {
        id:'oct_w3_810', title:'Week 3 ¬∑ Transposition', sub:'Play any song in any key!', emoji:'üîÑ',
        steps:[
          { type:'explain', heading:'Transposition ‚Äî Move to Any Key! üîÑ',
            body:`<strong>Transposition</strong> means playing a song in a DIFFERENT key from its original.<br><br>Why transpose?<br>üé§ To suit a singer\'s vocal range<br>üéµ To make a piece easier (or harder)<br>üéπ To practice in all keys<br><br>Method: identify all intervals in the original melody, then apply the same intervals from the new starting note!`,
            visual:'üîÑ' },
          { type:'try', heading:'Transpose Hot Cross Buns!',
            body:`Hot Cross Buns in C Major: <strong>E D C ¬∑ E D C ¬∑ CCCC DDDD ¬∑ E D C</strong><br><br>Now transpose to G Major (move everything up a Perfect 5th):<br><strong>B A G ¬∑ B A G ¬∑ GGGG AAAA ¬∑ B A G</strong><br><br>Same melody pattern, different starting point!`,
            interactive:'all_notes' },
          { type:'quiz', heading:'Transposition means: üåü',
            body:'Transposing a piece of music means...',
            opts:['Playing it faster','Playing it in a different key while keeping the same melody pattern üéØ','Playing it softer','Changing the rhythm'],
            answer:1 }
        ]
      },
      {
        id:'oct_w4_810', title:'Week 4 ¬∑ Piano Care & Professionalism', sub:'Respect your instrument!', emoji:'üèõÔ∏è',
        steps:[
          { type:'explain', heading:'Piano Care & Professionalism! üèõÔ∏è',
            body:`A pianist\'s relationship with their instrument is important!<br><br>Piano care tips:<br>üéπ <strong>Keep it clean</strong> ‚Äî dust keyboard regularly, wipe keys gently<br>üå°Ô∏è <strong>Temperature & humidity</strong> ‚Äî avoid direct sunlight and moisture<br>üîß <strong>Tuning</strong> ‚Äî acoustic pianos need tuning 1-2x per year<br>‚úã <strong>Wash hands</strong> before playing ‚Äî oils damage ivory/synthetic keys<br>‚ö° <strong>Digital pianos</strong> ‚Äî keep away from liquids, use correctly rated power supply`,
            visual:'üèõÔ∏è' },
          { type:'try', heading:'Professional Practice Session!',
            body:`Let\'s have a professional practice session today:<br>1. <strong>Warm-up</strong> (2 min): C Major scale, hands separately then together<br>2. <strong>Technique</strong> (5 min): Chord inversions C-F-G<br>3. <strong>Repertoire</strong> (10 min): Your best piece with full expression<br>4. <strong>Cool down</strong> (2 min): Slow improvisation<br><br>This is how professional pianists practice! üéπ`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'How often should an acoustic piano be tuned? üåü',
            body:'An acoustic piano should typically be professionally tuned...',
            opts:['Every 10 years','Only when it sounds bad','1-2 times per year üéØ','Every week'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'nov_810', title:'üóìÔ∏è November ‚Äî Composition & Creativity', emoji:'üéº', age:'Ages 8‚Äì10',
    color:'#A855F7', grad:'linear-gradient(135deg,#A855F7,#2ED573)',
    lessons:[
      {
        id:'nov_w1_810', title:'Week 1 ¬∑ Composing with Chords', sub:'Harmony-first composition!', emoji:'üé∏',
        steps:[
          { type:'explain', heading:'Compose Using Chords First! üé∏',
            body:`Professional songwriters often start with a <strong>chord progression</strong>, then write the melody on top!<br><br>Method:<br>1. Choose a 4-chord progression (e.g. <strong>C - Am - F - G</strong>)<br>2. Play the chords with your left hand<br>3. Improvise a melody with your right hand using C Major scale notes<br>4. When you find something you like ‚Äî remember it!`,
            visual:'üé∏' },
          { type:'try', heading:'Compose Your Own Song!',
            body:`Left hand progression: <strong>C ‚Üí Am ‚Üí F ‚Üí G</strong> (4 beats each)<br><br>Right hand: improvise using C D E F G A B<br><br>Try 3-4 different melody ideas. Record your favourite using the Record button! üî¥<br><br>You\'re writing a real song! üéº`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'Many songwriters start composition with: üåü',
            body:'A common professional approach to songwriting is to first establish the...',
            opts:['Lyrics (words)','Chord progression then write melody over it üéØ','Tempo only','The key signature'],
            answer:1 }
        ]
      },
      {
        id:'nov_w2_810', title:'Week 2 ¬∑ Advanced Notation', sub:'Write your music down!', emoji:'üìù',
        steps:[
          { type:'explain', heading:'Writing Music Down! üìù',
            body:`<strong>Music notation</strong> lets you preserve and share your compositions!<br><br>Key symbols to know:<br>üéº <strong>Bar lines</strong> divide music into equal bars<br>üéµ <strong>Ledger lines</strong> extend the staff above/below<br>‚úèÔ∏è <strong>Accidentals</strong> (# ‚ô≠ ‚ôÆ) change note pitch within a bar<br>üîÑ <strong>Repeat signs</strong> ||: :|| tell you to repeat a section<br>üìñ <strong>Da Capo (D.C.)</strong> = go back to the beginning<br>üéØ <strong>Fine</strong> = the end`,
            visual:'üìù' },
          { type:'try', heading:'Read and Play a Notation Example!',
            body:`Look at the staff display below. Identify:<br>1. The clef: Treble (ùÑû)<br>2. The note on the first line: E<br>3. The spaces from bottom: F A C E<br>4. The lines from bottom: E G B D F<br><br>Using this knowledge, find and play the note shown!`,
            interactive:'staff_display' },
          { type:'quiz', heading:'Da Capo (D.C.) means: üåü',
            body:'The musical direction "Da Capo" or "D.C." means...',
            opts:['End of the piece','Return to the beginning and play again üéØ','Skip this section','Gradually get louder'],
            answer:1 }
        ]
      },
      {
        id:'nov_w3_810', title:'Week 3 ¬∑ Preparing for Year-End Concert', sub:'Your grand performance!', emoji:'üé™',
        steps:[
          { type:'explain', heading:'Year-End Concert Preparation! üé™',
            body:`The year-end concert is your chance to shine! üåü<br><br>Programme planning:<br>1. <strong>Opening piece</strong>: Something upbeat and confident<br>2. <strong>Featured piece</strong>: Your most impressive ‚Äî practised the most!<br>3. <strong>Closing piece</strong>: Something emotional or meaningful<br><br>Stage tips:<br>üßò Breathe before starting<br>üéπ Feel the first note before pressing<br>üôá Bow gracefully at the end<br>üòä SMILE ‚Äî you\'ve worked hard for this!`,
            visual:'üé™' },
          { type:'try', heading:'Full Run-Through!',
            body:`Play your entire concert programme from start to finish:<br>- Opening piece (upbeat)<br>- Featured piece (your best!)<br>- Closing piece (meaningful)<br><br>No stopping! Even if you make a mistake ‚Äî keep going. That\'s professionalism! üé≠üá≥üá¨`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'The most professional response to a stage mistake is: üåü',
            body:'During a live concert performance, the best response to making a mistake is...',
            opts:['Stop and apologise','Restart the piece from the beginning','Keep playing without breaking ‚Äî the audience often won\'t notice üéØ','Walk off stage'],
            answer:2 }
        ]
      }
    ]
  },
  {
    id:'dec_810', title:'üóìÔ∏è December ‚Äî Year in Review & Next Steps üéÑ', emoji:'üéÑ', age:'Ages 8‚Äì10',
    color:'#FF4757', grad:'linear-gradient(135deg,#FF4757,#FFD700)',
    lessons:[
      {
        id:'dec_w1_810', title:'Week 1 ¬∑ Year-End Recital!', sub:'Perform your full programme!', emoji:'üé≠',
        steps:[
          { type:'explain', heading:'Year-End Recital! üé≠',
            body:`This is the moment you\'ve been working towards all year! Your full recital programme should demonstrate everything you\'ve learned:<br><br>üéπ Technical skill (clean notes, correct fingering)<br>üéµ Musical knowledge (keys, time signatures, dynamics)<br>üé≠ Expression and artistry<br>üá≥üá¨ Your Nigerian musical identity<br><br>Remember: the goal is to communicate through music ‚Äî to make people FEEL something!`,
            visual:'üé≠' },
          { type:'try', heading:'Give Your Recital!',
            body:`Perform your full programme right now!<br><br>Begin with a bow. Introduce each piece if you like. Play with full commitment. End with a bow.<br><br>You\'ve earned this moment. The stage is yours! üéπüåüüá≥üá¨`,
            interactive:'song_twinkle_full' },
          { type:'quiz', heading:'The purpose of a musical performance is: üåü',
            body:'The ultimate goal of performing music for an audience is...',
            opts:['To play every note perfectly with no mistakes','To show off technical skills','To communicate emotion and stories through sound üéØ','To finish as quickly as possible'],
            answer:2 }
        ]
      },
      {
        id:'dec_w2_810', title:'Week 2 ¬∑ Your Musical Year ‚Äî Everything Covered!', sub:'A full year of achievement!', emoji:'üèÜ',
        steps:[
          { type:'explain', heading:'Your Incredible Musical Year! üèÜ',
            body:`What you\'ve accomplished this year (Ages 8-10 track):<br><br>üìê Scales in C, G, D, F Major and A Minor<br>üîë Key signatures and Circle of Fifths<br>üé∏ Triads, 7th chords, and inversions<br>üî¢ I-IV-V and vi-IV-I-V progressions<br>ü§ù True two-hand independence<br>üåä Arpeggios and ornaments<br>üìä Time signatures, dotted notes, triplets, syncopation<br>üëÇ Ear training and interval recognition<br>‚úçÔ∏è Basic composition<br>üìñ Music history (Baroque, African, Nigerian)<br>üåç Pentatonic scale and modal music<br>üé≠ Professional performance skills<br><br><strong>You are now an Intermediate Pianist! üåü</strong>`,
            visual:'üèÜ' },
          { type:'try', heading:'Showcase Everything!',
            body:`Final challenge: play one thing that shows EACH of these skills:<br><br>1. A scale (C Major or G Major)<br>2. A chord progression (I-IV-V-I)<br>3. An arpeggio (C Major up and down)<br>4. A full song with dynamics and expression<br><br>Record it if you can ‚Äî this is your musical portfolio!`,
            interactive:'cde_practice' },
          { type:'quiz', heading:'An intermediate pianist can: üåü',
            body:'After this year of advanced study, you should be able to...',
            opts:['Only play one song','Read basic notation, play chords, understand theory, and perform expressively üéØ','Only play scales','Nothing more than a beginner'],
            answer:1 }
        ]
      },
      {
        id:'dec_w3_810', title:'Week 3 ¬∑ Next Year & Beyond!', sub:'Your musical journey continues!', emoji:'üöÄ',
        steps:[
          { type:'explain', heading:'Your Musical Future! üöÄ',
            body:`You\'ve completed a comprehensive year of piano study! What comes next:<br><br>üéπ <strong>Intermediate repertoire</strong>: Beethoven\'s F√ºr Elise, Bach Minuets, Chopin preludes (simplified)<br>üåç <strong>African composers</strong>: explore Akin Euba, John Gyimah Labi, and other African art music composers<br>üéµ <strong>Genre specialisation</strong>: jazz, gospel, Afrobeats production, classical<br>üìñ <strong>Advanced theory</strong>: modulation, secondary dominants, extended chords<br>üé§ <strong>Collaboration</strong>: play with other musicians, form a band, join a choir<br><br><strong>Music is a lifelong journey. You have just begun. Keep going! üåüüéπüá≥üá¨</strong>`,
            visual:'üöÄ' },
          { type:'try', heading:'Final Free Exploration!',
            body:`For your very last session, play FREELY for 10-15 minutes. No rules. No structure.<br><br>Try:<br>- Improvising over Am - F - C - G progression<br>- Making up a piece inspired by a Nigerian story or celebration<br>- Playing your absolute favourite moment from any song you learned this year<br><br>This is YOUR music. Keep making it! üéπ‚ú®üá≥üá¨`,
            interactive:'piano_explore' },
          { type:'quiz', heading:'The most important thing about music is: üåü',
            body:'After a year of study, the most important lesson about music is that...',
            opts:['Only professionally trained people can truly enjoy it','Music is a lifelong journey of expression, connection and joy ‚Äî available to everyone üéØ','You must practice 8 hours a day to be good','Mistakes are unacceptable'],
            answer:1 }
        ]
      }
    ]
  }
];


/* ‚îÄ‚îÄ Active curriculum based on age group ‚îÄ‚îÄ */
let selectedAgeGroup = null;
let CURRICULUM = [];

function getCurriculumForAge(age) {
  if (age === '3-5') return CURRICULUM_3_5;
  if (age === '5-8') return CURRICULUM_5_8;
  if (age === '8-10') return CURRICULUM_8_10;
  return [];
}

function selectAgeGroup(age) {
  selectedAgeGroup = age;
  try { localStorage.setItem('pn_ageGroup', age); } catch(e){}
  CURRICULUM = getCurriculumForAge(age);

  const labels = { '3-5':'üê£ Ages 3‚Äì5', '5-8':'üå± Ages 5‚Äì8', '8-10':'üåü Ages 8‚Äì10' };
  document.getElementById('ageGroupLabel').textContent = labels[age] + ' ‚Äî Track selected!';
  document.getElementById('agePickerWrap').style.display = 'none';
  document.getElementById('ageGroupBanner').style.display = 'block';
  document.getElementById('lessonSubtitle').style.display = 'block';

  setBubble(`${labels[age]} track selected! Let\'s learn! üéπ`);
  buildLevelRoad();
}

function changeAgeGroup() {
  document.getElementById('agePickerWrap').style.display = 'block';
  document.getElementById('ageGroupBanner').style.display = 'none';
  document.getElementById('levelRoad').innerHTML = '';
  document.getElementById('lessonSubtitle').style.display = 'none';
}

function initLessonsSection() {
  const saved = localStorage.getItem('pn_ageGroup');
  if (saved) {
    selectAgeGroup(saved);
  } else {
    document.getElementById('agePickerWrap').style.display = 'block';
    document.getElementById('ageGroupBanner').style.display = 'none';
    document.getElementById('lessonSubtitle').style.display = 'none';
  }
}
/* ‚îÄ‚îÄ State ‚îÄ‚îÄ */
/* Progress is saved to localStorage so it persists across sessions */
function saveProgress() {
  try { localStorage.setItem('pn_progress', JSON.stringify(lessonProgress));
        localStorage.setItem('pn_score', JSON.stringify({totalScore,totalStars,totalSongs,badgeState})); } catch(e){}
}
function loadProgress() {
  try {
    const p = localStorage.getItem('pn_progress');
    if (p) lessonProgress = JSON.parse(p);
    const s = localStorage.getItem('pn_score');
    if (s) {
      const d = JSON.parse(s);
      totalScore = d.totalScore||0; totalStars = d.totalStars||0; totalSongs = d.totalSongs||0;
      if (d.badgeState) {
        // Merge saved earned states into current BADGES template
        d.badgeState.forEach((saved, i) => {
          if (badgeState[i] && saved.earned) badgeState[i].earned = true;
        });
      }
    }
  } catch(e){}
}
let lessonProgress = {};
let currentLesson  = null;
let currentStep    = 0;
let quizAnswered   = false;
let lpPracticeNotes = []; // for lesson piano tracking

/* ‚îÄ‚îÄ Build the level road ‚îÄ‚îÄ */
let openLevelId = null; // tracks which level panel is open

function buildLevelRoad() {
  if (!CURRICULUM || CURRICULUM.length === 0) return;
  const road = document.getElementById('levelRoad');

  // Remember which levels are currently open before re-render
  const currentlyOpen = new Set();
  document.querySelectorAll('.level-block.open').forEach(b => currentlyOpen.add(b.dataset.levelId));

  // If nothing is open yet, auto-open the first incomplete level
  if (currentlyOpen.size === 0 && openLevelId === null) {
    const firstIncomplete = CURRICULUM.find(lv => !lv.lessons.every(l => lessonProgress[l.id]));
    const firstUnlocked   = CURRICULUM.find((lv, li) => li === 0 || CURRICULUM[li-1].lessons.every(l => lessonProgress[l.id]));
    const toOpen = firstIncomplete || firstUnlocked;
    if (toOpen) currentlyOpen.add(toOpen.id);
  }
  // If we have a remembered open level, keep it
  if (openLevelId) currentlyOpen.add(openLevelId);

  road.innerHTML = '';

  CURRICULUM.forEach((level, li) => {
    const prevLevelDone = li === 0 || CURRICULUM[li-1].lessons.every(l => lessonProgress[l.id]);
    const isLocked = !prevLevelDone;
    const doneLessons = level.lessons.filter(l => lessonProgress[l.id]).length;
    const pct = Math.round((doneLessons / level.lessons.length) * 100);
    const shouldBeOpen = !isLocked && currentlyOpen.has(level.id);

    const block = document.createElement('div');
    block.className = 'level-block' + (isLocked ? ' locked' : ' unlocked') + (shouldBeOpen ? ' open' : '');
    block.dataset.levelId = level.id;

    block.innerHTML = `
      <div class="level-header" onclick="${isLocked ? 'lockedTap()' : `toggleLevel('${level.id}')`}">
        <div class="level-badge" style="background:${level.grad}">${isLocked ? 'üîí' : level.emoji}</div>
        <div class="level-info">
          <div class="level-title">${level.title}</div>
          <div class="level-meta">${level.age} ¬∑ ${level.lessons.length} lessons ¬∑ ${doneLessons}/${level.lessons.length} done</div>
        </div>
        <div class="level-arrow">${isLocked ? '' : '‚ñ∂'}</div>
      </div>
      <div class="level-prog" style="${isLocked ? 'display:none' : ''}">
        <div class="level-prog-fill" style="width:${pct}%;background:${level.grad}"></div>
      </div>
      <div class="lesson-list" id="ll-${level.id}">
        ${level.lessons.map((lesson, i) => {
          const prevDone = i === 0 || lessonProgress[level.lessons[i-1].id];
          const done = lessonProgress[lesson.id];
          const locked = !prevDone && !done;
          return `
            <div class="lesson-row${done?' done':''}${locked?' locked-lesson':''}"
              onclick="${locked ? '' : `openLesson('${level.id}','${lesson.id}')`}">
              <div class="lesson-dot" style="background:${done ? 'rgba(46,213,115,0.3)' : locked ? 'rgba(255,255,255,0.05)' : level.grad}">
                ${done ? '‚úÖ' : locked ? 'üîí' : lesson.emoji}
              </div>
              <div class="lesson-row-info">
                <div class="lesson-row-title">${lesson.title}</div>
                <div class="lesson-row-sub">${lesson.sub} ¬∑ ${lesson.steps.length} steps</div>
              </div>
              <div class="lesson-status">${done ? '‚≠ê' : locked ? '' : '‚ñ∂'}</div>
            </div>`;
        }).join('')}
      </div>`;
    road.appendChild(block);
  });
}

function toggleLevel(levelId) {
  const block = document.querySelector('[data-level-id="' + levelId + '"]');
  const wasOpen = block.classList.contains('open');
  block.classList.toggle('open');
  openLevelId = wasOpen ? null : levelId;
}

function lockedTap() {
  showBanner('üîí Finish the previous level first!');
  setBubble('Complete all lessons in the level above first! ü¶Å');
}

/* ‚îÄ‚îÄ Open a lesson ‚îÄ‚îÄ */
function openLesson(levelId, lessonId) {
  const level  = CURRICULUM.find(l => l.id === levelId);
  const lesson = level.lessons.find(l => l.id === lessonId);
  currentLesson = { level, lesson };
  currentStep   = 0;
  quizAnswered  = false;

  document.getElementById('lessonOverlay').classList.add('on');
  document.getElementById('lessonOverlayTitle').textContent = lesson.title;
  renderLessonStep();
}

function closeLessonViewer() {
  document.getElementById('lessonOverlay').classList.remove('on');
  buildLevelRoad();
}

function renderLessonStep() {
  const { level, lesson } = currentLesson;
  const step = lesson.steps[currentStep];
  const total = lesson.steps.length;
  quizAnswered = false;

  document.getElementById('lessonStepInd').textContent = `${currentStep+1}/${total}`;
  document.getElementById('lessonOverlayTitle').textContent = lesson.title;

  const content = document.getElementById('lessonContent');
  const typeLabel = { explain:'üìñ Learn', try:'üéπ Practice', quiz:'üåü Quiz' };
  const typeCls   = { explain:'badge-explain', try:'badge-try', quiz:'badge-quiz' };

  let html = `<div class="step-card">
    <span class="step-type-badge ${typeCls[step.type]}">${typeLabel[step.type]}</span>
    <div class="step-heading">${step.heading}</div>
    <div class="step-body">${step.body}</div>`;

  // Visual emoji
  if (step.visual && !step.interactive) {
    html += `<div class="step-visual">${step.visual}</div>`;
  }

  // Interactive content
  if (step.interactive) html += buildInteractive(step.interactive, step, level);

  // Quiz options
  if (step.type === 'quiz') {
    html += `<div class="quiz-opts" id="quizOpts">
      ${step.opts.map((o,i) => `<button class="quiz-opt" onclick="answerQuiz(${i},${step.answer})">${o}</button>`).join('')}
    </div>
    <div class="fb-bar" id="quizFb"></div>`;
  }

  html += `</div>`;
  content.innerHTML = html;

  // Build nav
  buildLessonNav(total);

  // Attach lesson piano listeners after render
  setTimeout(() => attachLessonPiano(), 50);
}

function buildInteractive(type, step, level) {
  const EMOJIS = ['‚ù§Ô∏è','üß°','üíõ','üíö','üíô','üíú','ü©∑'];
  const NOTES_DEF = ['C4','D4','E4','F4','G4','A4','B4'];
  const COLORS = ['#FF4757','#FFA502','#FFD700','#2ED573','#1E90FF','#A855F7','#FF4FA3'];

  const pianoHTML = (showLabel=true) => {
    const wkeys = ['C4','D4','E4','F4','G4','A4','B4'];
    const bkeys = [{n:'Cs4',l:32},{n:'Ds4',l:88},{n:'Fs4',l:200},{n:'Gs4',l:256},{n:'As4',l:312}];
    let khtml = wkeys.map((n,i) => `<div class="lp-wk ln${i}" data-note="${n}" data-idx="${i}">
      ${showLabel ? `<span class="lp-emoji">${EMOJIS[i]}</span><span class="lp-label">${n[0]}</span>` : ''}
    </div>`).join('');
    bkeys.forEach(b => { khtml += `<div class="lp-bk" data-note="${b.n}" style="left:${b.l}px"></div>`; });
    return `<div class="lesson-piano-wrap"><div class="lesson-piano-3d"><div class="lp-keys" id="lpKeys">${khtml}</div></div></div>`;
  };

  switch(type) {
    case 'piano_explore':
    case 'cde_practice':
    case 'all_notes':
    case 'hand_position':
    case 'rh_cde':
    case 'lh_gc':
    case 'song_mary':
    case 'song_mary_full':
    case 'song_twinkle_1':
    case 'song_twinkle_full':
    case 'song_baa':
      return pianoHTML(true);

    case 'finger_diagram':
      const fingers = [
        {n:'1',name:'Thumb',color:'#FF4757'},{n:'2',name:'Index',color:'#FFA502'},
        {n:'3',name:'Middle',color:'#FFD700'},{n:'4',name:'Ring',color:'#2ED573'},
        {n:'5',name:'Pinky',color:'#1E90FF'}
      ];
      return `<div class="finger-diagram">${fingers.map(f=>`
        <div class="finger-bubble" style="background:${f.color}" onclick="fingerTap('${f.n}','${f.name}')">
          <span class="fnum">${f.n}</span><span class="fname">${f.name}</span>
        </div>`).join('')}</div>
        <div class="fb-bar" id="fingerFb"></div>`;

    case 'finger_quiz':
      return `<div class="finger-diagram">${[1,2,3,4,5].map(n=>`
        <div class="finger-bubble" style="background:${COLORS[n-1]}" onclick="fingerTap('${n}','F${n}')">
          <span class="fnum">${n}</span>
        </div>`).join('')}</div>
        <div class="key-instruction" id="fingerTask">Tap finger <strong>1</strong> (thumb)!</div>
        <div class="fb-bar" id="fingerFb"></div>`;

    case 'find_cde':
      return `<div class="key-instruction">Look for the group of <strong>2 black keys</strong> ‚¨õ‚¨õ ‚Äî C is the white key just to the LEFT!</div>` + pianoHTML(true);

    case 'beat_tap':
      return `<div class="rhythm-grid">${[1,2,3,4].map(b=>`
        <div class="beat-box" id="beat${b}" onclick="tapBeat(${b})">‚ô©</div>`).join('')}</div>
        <div class="key-instruction" id="beatInstr">Tap 1 ‚Üí 2 ‚Üí 3 ‚Üí 4 in order!</div>`;

    case 'staff_display':
    case 'staff_match':
      return `<div class="staff-wrap">
        <svg class="staff-svg" width="320" height="100" viewBox="0 0 320 100">
          ${[20,35,50,65,80].map(y=>`<line x1="10" y1="${y}" x2="310" y2="${y}" stroke="rgba(255,255,255,0.3)" stroke-width="1.5"/>`).join('')}
          <text x="14" y="88" font-size="72" fill="rgba(255,255,255,0.8)">ùÑû</text>
          <ellipse cx="180" cy="50" rx="12" ry="9" fill="#FFD700" transform="rotate(-15,180,50)"/>
          <text x="158" y="22" font-size="12" fill="#FFD700" font-family="Baloo 2,cursive" font-weight="800">E</text>
          <text x="155" y="95" font-size="11" fill="rgba(255,255,255,0.4)" font-family="Baloo 2,cursive">Middle E</text>
        </svg>
        <div style="font-size:0.8rem;color:rgba(255,255,255,0.4);margin-top:8px">Notes sit on lines or in spaces ‚Äî higher position = higher sound!</div>
      </div>` + pianoHTML(true);

    case 'colour_match_lesson':
      const randNote = NOTES_DEF[Math.floor(Math.random()*7)];
      const ni = NOTES_DEF.indexOf(randNote);
      return `<div style="text-align:center">
        <div style="width:100px;height:100px;border-radius:20px;background:${COLORS[ni]};margin:0 auto 12px;display:flex;align-items:center;justify-content:center;font-size:3rem;box-shadow:0 8px 30px rgba(0,0,0,0.4)">${EMOJIS[ni]}</div>
        <div style="font-family:'Baloo 2',cursive;color:var(--gold);margin-bottom:12px">Press the matching key!</div>
      </div>` + pianoHTML(true);

    default:
      return pianoHTML(true);
  }
}

let beatSeq = 1;
function tapBeat(n) {
  const box = document.getElementById('beat'+n);
  if (n === beatSeq) {
    box.classList.add('active');
    playNote(['C4','E4','G4','C5'][n-1], 0.4);
    beatSeq++;
    if (beatSeq > 4) {
      document.getElementById('beatInstr').textContent = 'üéâ Perfect rhythm! You did it!';
      setTimeout(() => { beatSeq=1; document.querySelectorAll('.beat-box').forEach(b=>b.classList.remove('active')); }, 1200);
    }
  } else {
    box.style.borderColor='#FF4757';
    setTimeout(()=>box.style.borderColor='',500);
  }
}

let fingerTarget = 1;
function fingerTap(num, name) {
  const fb = document.getElementById('fingerFb');
  if (!fb) {
    setBubble(`Finger ${num} ‚Äî ${name}! ‚úã`);
    return;
  }
  if (parseInt(num) === fingerTarget) {
    fb.textContent = `‚úÖ Correct! That's finger ${num} ‚Äî ${name}!`;
    fb.style.color = '#2ED573';
    fingerTarget++;
    const task = document.getElementById('fingerTask');
    if (task && fingerTarget <= 5) task.innerHTML = `Tap finger <strong>${fingerTarget}</strong>!`;
    if (fingerTarget > 5) { if(task) task.textContent = 'üéâ Amazing! You know all 5 fingers!'; fingerTarget=1; }
  } else {
    fb.textContent = `‚ùå That's finger ${num}. Try finger ${fingerTarget}!`;
    fb.style.color = '#FF4757';
  }
  fb.style.animation='none'; fb.offsetWidth; fb.style.animation='fbPop 0.4s ease';
}

function attachLessonPiano() {
  document.querySelectorAll('#lpKeys .lp-wk, #lpKeys .lp-bk').forEach(k => {
    k.addEventListener('pointerdown', e => {
      e.preventDefault();
      const note = k.dataset.note;
      const idx  = parseInt(k.dataset.idx ?? '-1');
      k.classList.add('lplit');
      setTimeout(()=>k.classList.remove('lplit'),240);
      playNote(note, 0.8);
      spawnFloatFromEl(k);
      addScore(3);
      setBubble(bubblePhrases[Math.floor(Math.random()*bubblePhrases.length)]);
    });
  });
}

function spawnFloatFromEl(el) {
  const r = el.getBoundingClientRect();
  const fn = document.createElement('div');
  fn.className = 'fnote';
  fn.textContent = FNOTES[Math.floor(Math.random()*FNOTES.length)];
  fn.style.left = (r.left + r.width/2 - 16) + 'px';
  fn.style.top  = (r.top - 10) + 'px';
  document.body.appendChild(fn);
  setTimeout(() => fn.remove(), 1700);
}

function answerQuiz(chosen, correct) {
  if (quizAnswered) return;
  quizAnswered = true;
  const opts = document.querySelectorAll('.quiz-opt');
  opts.forEach((o,i) => {
    if (i === correct) o.classList.add('correct');
    else if (i === chosen) o.classList.add('wrong');
    o.style.cursor = 'default';
  });
  const fb = document.getElementById('quizFb');
  if (chosen === correct) {
    fb.textContent = '‚úÖ Correct! Well done! üåü';
    fb.style.color = '#2ED573';
    addScore(25);
    confetti();
  } else {
    fb.textContent = `‚ùå Not quite! The answer was: ${document.querySelectorAll('.quiz-opt')[correct].textContent}`;
    fb.style.color = '#FF4757';
  }
  fb.style.animation='none'; fb.offsetWidth; fb.style.animation='fbPop 0.4s ease';
  buildLessonNav(currentLesson.lesson.steps.length);
}

function buildLessonNav(total) {
  const nav = document.getElementById('lessonNav');
  const step = currentLesson.lesson.steps[currentStep];
  const isLast = currentStep === total - 1;
  const isQuiz = step.type === 'quiz';

  let html = '';
  if (currentStep > 0) html += `<button class="lnav-btn lnav-prev" onclick="lessonGo(-1)">‚Üê Back</button>`;

  if (isLast) {
    if (!isQuiz || quizAnswered) {
      html += `<button class="lnav-btn lnav-done" onclick="completeLesson()">üèÜ Complete Lesson!</button>`;
    }
  } else {
    if (!isQuiz || quizAnswered) {
      html += `<button class="lnav-btn lnav-next" onclick="lessonGo(1)">Next Step ‚Üí</button>`;
    }
  }

  nav.innerHTML = html;
}

function lessonGo(dir) {
  currentStep += dir;
  quizAnswered = false;
  renderLessonStep();
  document.getElementById('lessonOverlay').scrollTo({top:0,behavior:'smooth'});
}

function completeLesson() {
  const { lesson, level } = currentLesson;
  lessonProgress[lesson.id] = true;
  addScore(100);
  confetti();
  showBanner(`üèÜ Lesson Complete! "${lesson.title}" ‚úÖ +100 pts!`, 4000);
  setBubble('You finished the lesson! You are a champion! ü¶Åüåü');

  // Check badges
  const totalDone = Object.keys(lessonProgress).length;
  if (totalDone >= 1)  unlockBadge(1);
  if (totalDone >= 4)  unlockBadge(3);
  if (totalDone >= 9)  unlockBadge(6);
  if (totalDone >= 12) unlockBadge(4);

  saveProgress();
  closeLessonViewer();
}
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   METRONOME
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let metroRunning = false;
let metroBpm = 90;
let metroSig = 4;       // beats per bar
let metroBeat = 0;
let metroTimerId = null;
let metroNextTime = 0;
let metroAudioCtx = null;

function getMetroCtx() {
  if (!metroAudioCtx) metroAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return metroAudioCtx;
}

function metroBpmChange(val) {
  metroBpm = parseInt(val);
  document.getElementById('metroBpmLabel').textContent = `‚ô© ${metroBpm} BPM`;
  document.documentElement.style.setProperty('--metro-dur', (60/metroBpm) + 's');
  if (metroRunning) { metroClear(); metroSchedule(); }
}

function metroSetSig(n) {
  metroSig = n;
  metroBeat = 0;
  document.querySelectorAll('.metro-sig-btn').forEach(b => b.classList.remove('on'));
  document.getElementById('msig'+n).classList.add('on');
  buildMetroDots();
  if (metroRunning) { metroClear(); metroSchedule(); }
}

function buildMetroDots() {
  const row = document.getElementById('metroDots');
  row.innerHTML = '';
  for (let i=0; i<metroSig; i++) {
    const d = document.createElement('div');
    d.className = 'metro-beat-dot' + (i===0 ? ' accent' : '');
    d.id = 'md-' + i;
    row.appendChild(d);
  }
}

function metroToggle() {
  if (metroRunning) {
    metroStop();
  } else {
    metroStart();
  }
}

function metroStart() {
  metroRunning = true;
  metroBeat = 0;
  document.getElementById('metroToggleBtn').textContent = '‚èπ Stop';
  document.getElementById('metroToggleBtn').classList.replace('metro-start','metro-stop');
  document.documentElement.style.setProperty('--metro-dur', (60/metroBpm) + 's');
  metroSchedule();
}

function metroStop() {
  metroRunning = false;
  metroClear();
  document.getElementById('metroToggleBtn').textContent = '‚ñ∂ Metronome';
  document.getElementById('metroToggleBtn').classList.replace('metro-stop','metro-start');
  // Reset dots
  document.querySelectorAll('.metro-beat-dot').forEach(d => d.classList.remove('on'));
}

function metroClear() {
  if (metroTimerId) clearInterval(metroTimerId);
  metroTimerId = null;
}

function metroTick() {
  if (!metroRunning) return;
  const ctx = getMetroCtx();
  const isAccent = (metroBeat % metroSig === 0);

  // Audio click
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain); gain.connect(ctx.destination);
  osc.frequency.value = isAccent ? 1000 : 750;
  gain.gain.setValueAtTime(0.3, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.04);
  osc.start(ctx.currentTime);
  osc.stop(ctx.currentTime + 0.05);

  // Visual dots
  const bi = metroBeat % metroSig;
  document.querySelectorAll('.metro-beat-dot').forEach((d,i) => d.classList.toggle('on', i===bi));

  // Pendulum swing
  const pend = document.getElementById('metroPendulum');
  pend.classList.remove('tick');
  void pend.offsetWidth; // reflow
  pend.classList.add('tick');

  metroBeat++;
}

function metroSchedule() {
  metroTick(); // immediate first tick
  metroTimerId = setInterval(metroTick, (60 / metroBpm) * 1000);
}

// Init dots on load
buildMetroDots();
document.documentElement.style.setProperty('--metro-dur', (60/metroBpm) + 's');

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RECORDER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let recState = 'idle'; // idle | recording | stopped
let recEvents = [];    // [{note, time}]
let recStartTime = 0;
let recTimerInterval = null;
let recPlayTimeouts = [];

function recStart() {
  if (recState === 'recording') return;
  recState = 'recording';
  recEvents = [];
  recStartTime = performance.now();

  document.getElementById('recIndicator').className = 'rec-indicator recording';
  document.getElementById('recLabel').textContent = 'Recording... play keys!';
  document.getElementById('recRecordBtn').style.display = 'none';
  document.getElementById('recStopBtn').style.display = '';
  document.getElementById('recPlayBtn').style.display = 'none';
  document.getElementById('recClearBtn').style.display = 'none';
  document.getElementById('recTime').textContent = '0:00';

  // Animated wave bars
  const wave = document.getElementById('recWave');
  wave.innerHTML = '';
  wave.style.display = 'flex';
  for (let i=0; i<8; i++) {
    const b = document.createElement('div');
    b.className = 'rec-wave-bar';
    b.style.setProperty('--d', (0.3 + Math.random()*0.5).toFixed(2) + 's');
    wave.appendChild(b);
  }

  // Timer display
  recTimerInterval = setInterval(() => {
    const elapsed = (performance.now() - recStartTime) / 1000;
    const m = Math.floor(elapsed/60);
    const s = Math.floor(elapsed % 60).toString().padStart(2,'0');
    document.getElementById('recTime').textContent = `${m}:${s}`;
  }, 200);
}

// Called from playNote ‚Äî we hook into it
function recNoteEvent(note) {
  if (recState !== 'recording') return;
  recEvents.push({ note, time: performance.now() - recStartTime });
}

function recStop() {
  if (recState !== 'recording') return;
  recState = 'stopped';
  clearInterval(recTimerInterval);

  document.getElementById('recIndicator').className = 'rec-indicator has-data';
  document.getElementById('recLabel').textContent = `Recorded ${recEvents.length} notes ‚úÖ`;
  document.getElementById('recStopBtn').style.display = 'none';
  document.getElementById('recRecordBtn').style.display = '';
  document.getElementById('recPlayBtn').style.display = recEvents.length > 0 ? '' : 'none';
  document.getElementById('recClearBtn').style.display = recEvents.length > 0 ? '' : 'none';
  document.getElementById('recWave').style.display = 'none';
}

function recPlay() {
  if (recState === 'recording' || recEvents.length === 0) return;
  // Cancel any in-progress playback
  recPlayTimeouts.forEach(clearTimeout);
  recPlayTimeouts = [];

  document.getElementById('recLabel').textContent = '‚ñ∂ Playing back...';

  recEvents.forEach(ev => {
    const tid = setTimeout(() => {
      playNote(ev.note, 0.5);
      // Light up key
      const kEl = document.querySelector(`#keysRow [data-note="${ev.note}"]`);
      if (kEl) { kEl.classList.add('lit'); setTimeout(() => kEl.classList.remove('lit'), 250); }
      // Waterfall
      spawnWaterfallNote(ev.note);
    }, ev.time);
    recPlayTimeouts.push(tid);
  });

  const totalTime = recEvents[recEvents.length-1]?.time || 0;
  const tid = setTimeout(() => {
    document.getElementById('recLabel').textContent = `Recorded ${recEvents.length} notes ‚úÖ`;
  }, totalTime + 600);
  recPlayTimeouts.push(tid);
}

function recClear() {
  recState = 'idle';
  recEvents = [];
  recPlayTimeouts.forEach(clearTimeout);
  recPlayTimeouts = [];
  clearInterval(recTimerInterval);

  document.getElementById('recIndicator').className = 'rec-indicator';
  document.getElementById('recLabel').textContent = 'Ready to record';
  document.getElementById('recRecordBtn').style.display = '';
  document.getElementById('recStopBtn').style.display = 'none';
  document.getElementById('recPlayBtn').style.display = 'none';
  document.getElementById('recClearBtn').style.display = 'none';
  document.getElementById('recTime').textContent = '';
  document.getElementById('recWave').style.display = 'none';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WATERFALL NOTE VISUALISER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const NOTE_COLORS_MAP = {
  C4:'#FF4757',D4:'#FFA502',E4:'#FFD700',F4:'#2ED573',
  G4:'#1E90FF',A4:'#A855F7',B4:'#FF4FA3',C5:'#FF4757',
  Cs4:'#888',Ds4:'#888',Fs4:'#888',Gs4:'#888',As4:'#888'
};
const WATERFALL_POSITIONS = {
  C4:4,D4:42,E4:80,F4:118,G4:156,A4:194,B4:232,C5:270,
  Cs4:23,Ds4:61,Fs4:137,Gs4:175,As4:213
};

function spawnWaterfallNote(note) {
  const wrap = document.getElementById('waterfall');
  const el = document.createElement('div');
  el.className = 'waterfall-note';
  el.textContent = note[0] + (note.includes('s') ? '#' : '') + (note.includes('5') ? '‚Åµ' : '');
  el.style.background = NOTE_COLORS_MAP[note] || '#888';
  const xPct = ((WATERFALL_POSITIONS[note] || 140) / 320) * 100;
  el.style.left = Math.max(1, Math.min(90, xPct)) + '%';
  wrap.appendChild(el);
  setTimeout(() => el.remove(), 850);
}

/* ‚ïê‚ïê THEME ‚ïê‚ïê */
let isDark = true;
function toggleTheme() {
  isDark = !isDark;
  document.documentElement.classList.toggle('light', !isDark);
  document.getElementById('themeToggle').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
  try { localStorage.setItem('pn_theme', isDark ? 'dark' : 'light'); } catch(e){}
}
function loadTheme() {
  try {
    const t = localStorage.getItem('pn_theme');
    if (t === 'light') {
      isDark = false;
      document.documentElement.classList.add('light');
      document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
    }
  } catch(e){}
}
document.getElementById('themeToggle').addEventListener('click', toggleTheme);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PIANO KEYS BUILD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const WHITE_DEFS = [
  {note:'C4', idx:0, emoji:'‚ù§Ô∏è', label:'C'},
  {note:'D4', idx:1, emoji:'üß°', label:'D'},
  {note:'E4', idx:2, emoji:'üíõ', label:'E'},
  {note:'F4', idx:3, emoji:'üíö', label:'F'},
  {note:'G4', idx:4, emoji:'üíô', label:'G'},
  {note:'A4', idx:5, emoji:'üíú', label:'A'},
  {note:'B4', idx:6, emoji:'ü©∑', label:'B'},
  {note:'C5', idx:7, emoji:'‚ù§Ô∏è', label:'C'},
];
const BLACK_DEFS = [
  {note:'Cs4', left:40},
  {note:'Ds4', left:96},
  {note:'Fs4', left:208},
  {note:'Gs4', left:264},
  {note:'As4', left:320},
];

function buildPianoKeys() {
  const row = document.getElementById('keysRow');
  row.innerHTML = '';

  // White keys
  WHITE_DEFS.forEach(def => {
    const k = document.createElement('div');
    k.className = 'wk n' + def.idx;
    k.dataset.note = def.note;
    k.innerHTML = `<span class="kemoji">${def.emoji}</span><span class="klabel">${def.label}</span>`;
    k.addEventListener('pointerdown', e => {
      e.preventDefault();
      isInteractiveTap = true;
      playNote(def.note, 0.7);
      isInteractiveTap = false;
      k.classList.add('lit');
      setTimeout(() => k.classList.remove('lit'), 280);
      spawnFloatFromEl(k);
      addScore(1);
      if (playAlong) checkAlong(def.note);
      setBubble(bubblePhrases[Math.floor(Math.random()*bubblePhrases.length)]);
    });
    row.appendChild(k);
  });

  // Black keys
  BLACK_DEFS.forEach(def => {
    const k = document.createElement('div');
    k.className = 'bk';
    k.dataset.note = def.note;
    k.style.left = def.left + 'px';
    k.addEventListener('pointerdown', e => {
      e.preventDefault();
      isInteractiveTap = true;
      playNote(def.note, 0.7);
      isInteractiveTap = false;
      k.classList.add('lit');
      setTimeout(() => k.classList.remove('lit'), 280);
      addScore(1);
      spawnWaterfallNote(def.note);
    });
    row.appendChild(k);
  });
}

/* ‚îÄ‚îÄ Keyboard shortcuts ‚îÄ‚îÄ */
const KEY_MAP = {
  'a':'C4','s':'D4','d':'E4','f':'F4','g':'G4','h':'A4','j':'B4','k':'C5',
  'w':'Cs4','e':'Ds4','t':'Fs4','y':'Gs4','u':'As4'
};
const pressedKeys = new Set();
document.addEventListener('keydown', e => {
  if (e.repeat || pressedKeys.has(e.key)) return;
  const note = KEY_MAP[e.key.toLowerCase()];
  if (!note) return;
  pressedKeys.add(e.key);
  isInteractiveTap = true;
  playNote(note, 0.7);
  isInteractiveTap = false;
  const kEl = document.querySelector(`#keysRow [data-note="${note}"]`);
  if (kEl) { kEl.classList.add('lit'); if (kEl.classList.contains('wk')) spawnFloatFromEl(kEl); }
  if (playAlong) checkAlong(note);
});
document.addEventListener('keyup', e => {
  pressedKeys.delete(e.key);
  const note = KEY_MAP[e.key.toLowerCase()];
  if (!note) return;
  const kEl = document.querySelector(`#keysRow [data-note="${note}"]`);
  if (kEl) kEl.classList.remove('lit');
});

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
loadTheme();
loadProgress();
buildPianoKeys();
buildSongPicker();
renderSheet();
buildBadges();

// Restore score display after loading
document.getElementById('scoreVal').textContent = totalScore;
document.getElementById('starsVal').textContent = totalStars;
document.getElementById('songsVal').textContent = totalSongs;
document.getElementById('progFill').style.width = Math.min(100, totalScore/10) + '%';

setTimeout(() => showBanner('üëã Welcome back to PianoNaija! üéπ'), 800);

// Rotate mascot bubble every 6s
setInterval(() => {
  const phrases = [
    'Touch the piano keys! üéπ','Which song shall we play? üéµ',
    'You dey do well! Keep playing! üí™','Practice every day and you go be a star! ‚≠ê',
    'Try the activities! They are so fun! üéÆ','Every musician started as a beginner! üåü',
    'Oya! One more song! üá≥üá¨'
  ];
  setBubble(phrases[Math.floor(Math.random()*phrases.length)]);
}, 6000);
</script>
</body>
</html>
